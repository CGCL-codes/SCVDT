From b6f758241f3fdd57b48c527a695512f33e26eb74 Mon Sep 17 00:00:00 2001
From: Greg Thomas <greg.d.thomas@gmail.com>
Date: Tue, 31 Dec 2019 14:39:08 +0000
Subject: [PATCH] Fix issues identified by CSW

---
 .../jivesoftware/admin/servlet/SystemCacheDetailsServlet.java  | 2 +-
 xmppserver/src/main/webapp/import-truststore-certificate.jsp   | 2 +-
 xmppserver/src/main/webapp/security-certificate-details.jsp    | 2 +-
 xmppserver/src/main/webapp/system-cache-details.jsp            | 3 ++-
 xmppserver/src/main/webapp/user-groups.jsp                     | 2 +-
 5 files changed, 6 insertions(+), 5 deletions(-)

diff --git a/xmppserver/src/main/java/org/jivesoftware/admin/servlet/SystemCacheDetailsServlet.java b/xmppserver/src/main/java/org/jivesoftware/admin/servlet/SystemCacheDetailsServlet.java
index 0d4a0eaba8..a2b3dd6bac 100644
--- a/xmppserver/src/main/java/org/jivesoftware/admin/servlet/SystemCacheDetailsServlet.java
+++ b/xmppserver/src/main/java/org/jivesoftware/admin/servlet/SystemCacheDetailsServlet.java
@@ -45,7 +45,7 @@ protected void doGet(final HttpServletRequest request, final HttpServletResponse
             .map(cache -> (Cache<?, ?>) cache);
 
         if (!optionalCache.isPresent()) {
-            request.setAttribute("warningMessage", LocaleUtils.getLocalizedString("system.cache-details.cache_not_found", Collections.singletonList(cacheName)));
+            request.setAttribute("warningMessage", LocaleUtils.getLocalizedString("system.cache-details.cache_not_found", Collections.singletonList(StringUtils.escapeHTMLTags(cacheName))));
         }
 
         final boolean secretKey = optionalCache.map(Cache::isKeySecret).orElse(Boolean.FALSE);
diff --git a/xmppserver/src/main/webapp/import-truststore-certificate.jsp b/xmppserver/src/main/webapp/import-truststore-certificate.jsp
index fe856f0422..0338b4d62c 100644
--- a/xmppserver/src/main/webapp/import-truststore-certificate.jsp
+++ b/xmppserver/src/main/webapp/import-truststore-certificate.jsp
@@ -150,7 +150,7 @@
                         <label for="alias"><fmt:message key="ssl.signing-request.alias"/></label>
                     </td>
                     <td width="99%">
-                        <input type="text" size="30" maxlength="100" name="alias" id="alias" value="${param.alias}">
+                        <input type="text" size="30" maxlength="100" name="alias" id="alias" value="<c:out value='${param.alias}'/>"">
                     </td>
                 </tr>
                 <tr valign="top">
diff --git a/xmppserver/src/main/webapp/security-certificate-details.jsp b/xmppserver/src/main/webapp/security-certificate-details.jsp
index cb77eed9b2..2e06f036d8 100644
--- a/xmppserver/src/main/webapp/security-certificate-details.jsp
+++ b/xmppserver/src/main/webapp/security-certificate-details.jsp
@@ -490,7 +490,7 @@
 
     <form action="security-certificate-details.jsp">
         <input type="hidden" name="connectionType" value="${connectionType}"/>
-        <input type="hidden" name="isTrustStore" value="${param.isTrustStore}"/>
+        <input type="hidden" name="isTrustStore" value="<c:out value='${param.isTrustStore}'/>"/>
         <div style="text-align: center;">
             <input type="submit" name="back" value="<fmt:message key="session.details.back_button"/>">
         </div>
diff --git a/xmppserver/src/main/webapp/system-cache-details.jsp b/xmppserver/src/main/webapp/system-cache-details.jsp
index 3e1c80bf2b..9d73b9d9ea 100644
--- a/xmppserver/src/main/webapp/system-cache-details.jsp
+++ b/xmppserver/src/main/webapp/system-cache-details.jsp
@@ -9,7 +9,8 @@
 <jsp:useBean scope="request" id="search" type="org.jivesoftware.admin.servlet.SystemCacheDetailsServlet.Search"/>
 <%@ page contentType="text/html; charset=UTF-8" %>
 <head>
-    <title><fmt:message key="system.cache-details.title"><fmt:param value="${cacheName}"/></fmt:message></title>
+    <fmt:message key="system.cache-details.title" var="title"><fmt:param value="${cacheName}"/></fmt:message>
+    <title><c:out value="${title}"/></title>
     <meta name="pageID" content="system-cache"/>
     <style type="text/css">
         img.clickable {
diff --git a/xmppserver/src/main/webapp/user-groups.jsp b/xmppserver/src/main/webapp/user-groups.jsp
index f1434ba4c4..1e6af009b4 100644
--- a/xmppserver/src/main/webapp/user-groups.jsp
+++ b/xmppserver/src/main/webapp/user-groups.jsp
@@ -235,7 +235,7 @@
                 <td align="right" valign="bottom"><fmt:message
                         key="group.summary.search" />: <input type="text" size="30"
                     maxlength="150" name="search"
-                    value="<%=((search!=null) ? search : "")%>"></td>
+                    value="<c:out value='${param.search}'/>"></td>
             </tr>
         </table>
         <input type="hidden" name="username"