 lucene/ivy-versions.properties                     |  1 +
 solr/CHANGES.txt                                   |  3 ++-
 solr/NOTICE.txt                                    |  3 +++
 solr/contrib/extraction/ivy.xml                    |  1 +
 .../extraction/ExtractingRequestHandler.java       |  7 ++++++
 .../solr/morphlines/cell/SolrCellBuilder.java      | 10 ++++++++
 solr/licenses/jmatio-1.2.jar.sha1                  |  1 +
 solr/licenses/jmatio-LICENSE-BSD.txt               | 28 ++++++++++++++++++++++
 solr/licenses/jmatio-NOTICE.txt                    |  8 +++++++
 9 files changed, 61 insertions(+), 1 deletion(-)

diff --git a/lucene/ivy-versions.properties b/lucene/ivy-versions.properties
index afd7fea..17dba82 100644
--- a/lucene/ivy-versions.properties
+++ b/lucene/ivy-versions.properties
@@ -290,6 +290,7 @@ org.slf4j.version = 1.7.7
 /org.slf4j/slf4j-api = ${org.slf4j.version}
 /org.slf4j/slf4j-log4j12 = ${org.slf4j.version}
 
+/org.tallison/jmatio = 1.2
 /org.tukaani/xz = 1.5
 /org.xerial.snappy/snappy-java = 1.0.5
 /rome/rome = 1.0
diff --git a/solr/CHANGES.txt b/solr/CHANGES.txt
index f5f4653..ce7ac25 100644
--- a/solr/CHANGES.txt
+++ b/solr/CHANGES.txt
@@ -44,7 +44,8 @@ Bug Fixes
 Other
 ----------------------
 
-* SOLR-11486: Remove Matlab MAT file support from extraction contrib. (Steve Rowe)
+* SOLR-11486: Update jmatio to 1.2 and prevent deserialization inside Matlab files.
+  (Uwe Schindler, Steve Rowe)
 
 ======================= 5.5.4 =======================
 
diff --git a/solr/NOTICE.txt b/solr/NOTICE.txt
index 59d0bb5..25e2aa3 100644
--- a/solr/NOTICE.txt
+++ b/solr/NOTICE.txt
@@ -393,6 +393,9 @@ Lasse Collin and others, XZ for Java (http://tukaani.org/xz/java.html)
 java-libpst is a pure java library for the reading of Outlook PST and OST files.
 https://github.com/rjohnsondev/java-libpst
 
+JMatIO is a JAVA library to read/write/manipulate with Matlab binary MAT-files.
+http://www.sourceforge.net/projects/jmatio
+
 =========================================================================
 ==  Language Detection Notices                                         ==
 =========================================================================
diff --git a/solr/contrib/extraction/ivy.xml b/solr/contrib/extraction/ivy.xml
index 7fbb2fc..787b5d6 100644
--- a/solr/contrib/extraction/ivy.xml
+++ b/solr/contrib/extraction/ivy.xml
@@ -58,6 +58,7 @@
     <dependency org="org.tukaani" name="xz" rev="${/org.tukaani/xz}" conf="compile"/>
     <dependency org="com.adobe.xmp" name="xmpcore" rev="${/com.adobe.xmp/xmpcore}" conf="compile"/>
     <dependency org="com.pff" name="java-libpst" rev="${/com.pff/java-libpst}" conf="compile"/>
+    <dependency org="org.tallison" name="jmatio" rev="${/org.tallison/jmatio}" conf="compile"/>
 
     <!-- Other ExtractingRequestHandler dependencies -->
     <dependency org="com.ibm.icu" name="icu4j" rev="${/com.ibm.icu/icu4j}" conf="compile"/>
diff --git a/solr/contrib/extraction/src/java/org/apache/solr/handler/extraction/ExtractingRequestHandler.java b/solr/contrib/extraction/src/java/org/apache/solr/handler/extraction/ExtractingRequestHandler.java
index d1bd4c7..632abd6 100644
--- a/solr/contrib/extraction/src/java/org/apache/solr/handler/extraction/ExtractingRequestHandler.java
+++ b/solr/contrib/extraction/src/java/org/apache/solr/handler/extraction/ExtractingRequestHandler.java
@@ -17,6 +17,7 @@
 package org.apache.solr.handler.extraction;
 
 
+import com.jmatio.io.MatFileReader;
 import org.apache.solr.common.SolrException;
 import org.apache.solr.common.SolrException.ErrorCode;
 import org.apache.solr.common.util.DateUtil;
@@ -64,6 +65,12 @@ public class ExtractingRequestHandler extends ContentStreamHandlerBase implement
   @Override
   public void init(NamedList args) {
     super.init(args);
+    try {
+      // SOLR-11486: Make sure that this is set to false!
+      MatFileReader.setAllowObjectDeserialization(false);
+    } catch (NoClassDefFoundError e) {
+      // Matlab parser was disabled, ignore
+    }
   }
 
   @Override
diff --git a/solr/contrib/morphlines-cell/src/java/org/apache/solr/morphlines/cell/SolrCellBuilder.java b/solr/contrib/morphlines-cell/src/java/org/apache/solr/morphlines/cell/SolrCellBuilder.java
index a5c73bc..870780d 100644
--- a/solr/contrib/morphlines-cell/src/java/org/apache/solr/morphlines/cell/SolrCellBuilder.java
+++ b/solr/contrib/morphlines-cell/src/java/org/apache/solr/morphlines/cell/SolrCellBuilder.java
@@ -63,6 +63,7 @@ import org.kitesdk.morphline.stdio.AbstractParser;
 import org.xml.sax.ContentHandler;
 import org.xml.sax.SAXException;
 
+import com.jmatio.io.MatFileReader;
 import com.google.common.base.Joiner;
 import com.google.common.base.Preconditions;
 import com.google.common.collect.ArrayListMultimap;
@@ -80,6 +81,15 @@ import com.typesafe.config.Config;
  */
 public final class SolrCellBuilder implements CommandBuilder {
 
+  static {
+    try {
+      // SOLR-11486: Make sure that this is set to false!
+      MatFileReader.setAllowObjectDeserialization(false);
+    } catch (NoClassDefFoundError e) {
+      // Matlab parser was disabled, ignore
+    }
+  }
+
   @Override
   public Collection<String> getNames() {
     return Collections.singletonList("solrCell");
diff --git a/solr/licenses/jmatio-1.2.jar.sha1 b/solr/licenses/jmatio-1.2.jar.sha1
new file mode 100644
index 0000000..5941dc9
--- /dev/null
+++ b/solr/licenses/jmatio-1.2.jar.sha1
@@ -0,0 +1 @@
+69d8f2f49c1503f9b15b0eb50b1905a734a025e2
diff --git a/solr/licenses/jmatio-LICENSE-BSD.txt b/solr/licenses/jmatio-LICENSE-BSD.txt
new file mode 100644
index 0000000..753fa5c
--- /dev/null
+++ b/solr/licenses/jmatio-LICENSE-BSD.txt
@@ -0,0 +1,28 @@
+Copyright (c) 2006, Wojciech Gradkowski
+All rights reserved.
+
+Redistribution and use in source and binary forms, with or without 
+modification, are permitted provided that the following conditions 
+are met:
+
+    * Redistributions of source code must retain the above copyright 
+      notice, this list of conditions and the following disclaimer.
+    * Redistributions in binary form must reproduce the above copyright 
+      notice, this list of conditions and the following disclaimer in 
+      the documentation and/or other materials provided with the 
+      distribution.
+    * Neither the name of the JMatIO nor the names of its 
+      contributors may be used to endorse or promote products derived 
+      from this software without specific prior written permission.
+
+THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS AND CONTRIBUTORS 
+"AS IS" AND ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT 
+LIMITED TO, THE IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR 
+A PARTICULAR PURPOSE ARE DISCLAIMED. IN NO EVENT SHALL THE COPYRIGHT 
+OWNER OR CONTRIBUTORS BE LIABLE FOR ANY DIRECT, INDIRECT, INCIDENTAL, 
+SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT NOT 
+LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF USE, 
+DATA, OR PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND ON ANY 
+THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT 
+(INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE 
+OF THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.
diff --git a/solr/licenses/jmatio-NOTICE.txt b/solr/licenses/jmatio-NOTICE.txt
new file mode 100644
index 0000000..4c5fce7
--- /dev/null
+++ b/solr/licenses/jmatio-NOTICE.txt
@@ -0,0 +1,8 @@
+JMatIO is a JAVA library to read/write/manipulate with Matlab binary
+MAT-files.
+
+If you would like to comment, improve, critisize the project please 
+email me: wgradkowski@gmail.com 
+
+or visit JMatIO project page at Sourceforge:
+http://www.sourceforge.net/projects/jmatio