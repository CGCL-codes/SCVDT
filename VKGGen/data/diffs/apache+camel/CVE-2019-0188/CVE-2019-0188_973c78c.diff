From 973c78cbecd1c0c5eb61c8e16d60979574c9b751 Mon Sep 17 00:00:00 2001
From: =?UTF-8?q?Jean-Baptiste=20Onofr=C3=A9?= <jbonofre@apache.org>
Date: Sun, 11 Aug 2019 07:59:10 +0200
Subject: [PATCH] [AMQ-7249] Upgrade to Jetty 9.4.19.v20190610

---
 activemq-amqp/pom.xml                                          | 1 +
 activemq-http/pom.xml                                          | 1 +
 .../activemq/transport/SecureSocketConnectorFactory.java       | 2 +-
 .../activemq/transport/wss/WSSTransportNeedClientAuthTest.java | 3 ---
 activemq-osgi/pom.xml                                          | 3 ++-
 activemq-unit-tests/pom.xml                                    | 1 +
 activemq-web-console/pom.xml                                   | 1 +
 activemq-web-demo/pom.xml                                      | 1 +
 activemq-web/pom.xml                                           | 1 +
 assembly/pom.xml                                               | 1 +
 pom.xml                                                        | 3 ++-
 11 files changed, 12 insertions(+), 6 deletions(-)

diff --git a/activemq-amqp/pom.xml b/activemq-amqp/pom.xml
index cc2da5204c..a0f49c4ec0 100644
--- a/activemq-amqp/pom.xml
+++ b/activemq-amqp/pom.xml
@@ -80,6 +80,7 @@
       <!-- using it for Jetty's JNDI context to work /w Joram tests. -->
       <groupId>org.eclipse.jetty.aggregate</groupId>
       <artifactId>jetty-all</artifactId>
+      <classifier>uber</classifier>
       <scope>test</scope>
     </dependency>
     <dependency>
diff --git a/activemq-http/pom.xml b/activemq-http/pom.xml
index 345df41dd1..86198265da 100644
--- a/activemq-http/pom.xml
+++ b/activemq-http/pom.xml
@@ -58,6 +58,7 @@
     <dependency>
       <groupId>org.eclipse.jetty.aggregate</groupId>
       <artifactId>jetty-all</artifactId>
+      <classifier>uber</classifier>
     </dependency>
     <dependency>
       <groupId>org.apache.httpcomponents</groupId>
diff --git a/activemq-http/src/main/java/org/apache/activemq/transport/SecureSocketConnectorFactory.java b/activemq-http/src/main/java/org/apache/activemq/transport/SecureSocketConnectorFactory.java
index 3fd27f1015..1999c8fe7b 100644
--- a/activemq-http/src/main/java/org/apache/activemq/transport/SecureSocketConnectorFactory.java
+++ b/activemq-http/src/main/java/org/apache/activemq/transport/SecureSocketConnectorFactory.java
@@ -92,7 +92,7 @@ public Connector createConnector(Server server) throws Exception {
                     factory.setSecureRandomAlgorithm(secureRandomCertficateAlgorithm);
                 }
                 if (keyCertificateAlgorithm != null) {
-                    factory.setSslKeyManagerFactoryAlgorithm(keyCertificateAlgorithm);
+                    factory.setKeyManagerFactoryAlgorithm(keyCertificateAlgorithm);
                 }
                 if (trustCertificateAlgorithm != null) {
                     factory.setTrustManagerFactoryAlgorithm(trustCertificateAlgorithm);
diff --git a/activemq-http/src/test/java/org/apache/activemq/transport/wss/WSSTransportNeedClientAuthTest.java b/activemq-http/src/test/java/org/apache/activemq/transport/wss/WSSTransportNeedClientAuthTest.java
index 0849361bd7..793edd5b40 100644
--- a/activemq-http/src/test/java/org/apache/activemq/transport/wss/WSSTransportNeedClientAuthTest.java
+++ b/activemq-http/src/test/java/org/apache/activemq/transport/wss/WSSTransportNeedClientAuthTest.java
@@ -16,19 +16,16 @@
  */
 package org.apache.activemq.transport.wss;
 
-import junit.framework.Assert;
 import org.apache.activemq.broker.BrokerFactory;
 import org.apache.activemq.broker.BrokerService;
 import org.apache.activemq.transport.stomp.Stomp;
 import org.apache.activemq.transport.stomp.StompFrame;
 import org.apache.activemq.transport.ws.MQTTWSConnection;
 import org.apache.activemq.transport.ws.StompWSConnection;
-import org.apache.activemq.util.Wait;
 import org.eclipse.jetty.util.ssl.SslContextFactory;
 import org.eclipse.jetty.websocket.api.Session;
 import org.eclipse.jetty.websocket.client.ClientUpgradeRequest;
 import org.eclipse.jetty.websocket.client.WebSocketClient;
-import org.eclipse.jetty.websocket.client.io.ConnectPromise;
 import org.junit.After;
 import org.junit.Before;
 import org.junit.Test;
diff --git a/activemq-osgi/pom.xml b/activemq-osgi/pom.xml
index 9f8bd8a6b9..cfffe38221 100644
--- a/activemq-osgi/pom.xml
+++ b/activemq-osgi/pom.xml
@@ -71,7 +71,7 @@
       org.apache.commons.logging;version="[1.2,2)";resolution:=optional,
       javax.jms*;version="[1.1,3)",
       javax.management*,
-      javax.transaction*,
+      javax.transaction*;version="[1,3)",
       javax.naming*;resolution:=optional,
       org.apache.commons.pool*;resolution:=optional,
       org.apache.commons.net*;resolution:=optional,
@@ -83,6 +83,7 @@
       org.apache.tools.ant*;resolution:=optional,
       org.apache.log4j*;resolution:=optional,
       org.json*;resolution:=optional,
+      org.objectweb.asm;version="[5,8)";resolution:=optional,
         *
     </activemq.osgi.import.pkg>
     <activemq.osgi.export>
diff --git a/activemq-unit-tests/pom.xml b/activemq-unit-tests/pom.xml
index d63fed8d5e..c83a0a7452 100644
--- a/activemq-unit-tests/pom.xml
+++ b/activemq-unit-tests/pom.xml
@@ -265,6 +265,7 @@
       <!-- using it for Jetty's JNDI context to work /w Joram tests. -->
       <groupId>org.eclipse.jetty.aggregate</groupId>
       <artifactId>jetty-all</artifactId>
+      <classifier>uber</classifier>
       <scope>test</scope>
     </dependency>
 
diff --git a/activemq-web-console/pom.xml b/activemq-web-console/pom.xml
index 5255bea5e4..ed3c3f3259 100644
--- a/activemq-web-console/pom.xml
+++ b/activemq-web-console/pom.xml
@@ -247,6 +247,7 @@
     <dependency>
       <groupId>org.eclipse.jetty.aggregate</groupId>
       <artifactId>jetty-all</artifactId>
+      <classifier>uber</classifier>
       <scope>test</scope>
     </dependency>
      <dependency>
diff --git a/activemq-web-demo/pom.xml b/activemq-web-demo/pom.xml
index 9599eb1577..51ceb82b76 100644
--- a/activemq-web-demo/pom.xml
+++ b/activemq-web-demo/pom.xml
@@ -194,6 +194,7 @@
     <dependency>
       <groupId>org.eclipse.jetty.aggregate</groupId>
       <artifactId>jetty-all</artifactId>
+      <classifier>uber</classifier>
       <scope>test</scope>
     </dependency>
 
diff --git a/activemq-web/pom.xml b/activemq-web/pom.xml
index 5380de8a68..c59d98fa37 100644
--- a/activemq-web/pom.xml
+++ b/activemq-web/pom.xml
@@ -76,6 +76,7 @@
     <dependency>
       <groupId>org.eclipse.jetty.aggregate</groupId>
       <artifactId>jetty-all</artifactId>
+      <classifier>uber</classifier>
       <scope>provided</scope>
     </dependency>
     <dependency>
diff --git a/assembly/pom.xml b/assembly/pom.xml
index 6ca2f28a04..d4546babf2 100644
--- a/assembly/pom.xml
+++ b/assembly/pom.xml
@@ -329,6 +329,7 @@
     <dependency>
       <groupId>org.eclipse.jetty.aggregate</groupId>
       <artifactId>jetty-all</artifactId>
+      <classifier>uber</classifier>
     </dependency>
     <dependency>
       <groupId>org.eclipse.jdt</groupId>
diff --git a/pom.xml b/pom.xml
index 7a3e65ba38..467cb6e6e5 100644
--- a/pom.xml
+++ b/pom.xml
@@ -76,7 +76,7 @@
     <jackson-databind-version>2.9.9.3</jackson-databind-version>
     <jasypt-version>1.9.2</jasypt-version>
     <jaxb-bundle-version>2.2.11_1</jaxb-bundle-version>
-    <jetty9-version>9.2.26.v20180806</jetty9-version>
+    <jetty9-version>9.4.19.v20190610</jetty9-version>
     <jetty-version>${jetty9-version}</jetty-version>
     <jmdns-version>3.4.1</jmdns-version>
     <tomcat-api-version>8.0.53</tomcat-api-version>
@@ -950,6 +950,7 @@
         <groupId>org.eclipse.jetty.aggregate</groupId>
         <artifactId>jetty-all</artifactId>
         <version>${jetty-version}</version>
+        <classifier>uber</classifier>
         <exclusions>
           <exclusion>
             <groupId>javax.servlet</groupId>
