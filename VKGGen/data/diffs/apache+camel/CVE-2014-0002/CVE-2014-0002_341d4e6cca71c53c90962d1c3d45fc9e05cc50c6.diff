From 341d4e6cca71c53c90962d1c3d45fc9e05cc50c6 Mon Sep 17 00:00:00 2001
From: Willem Jiang <willem.jiang@gmail.com>
Date: Mon, 13 Jan 2014 11:02:48 +0800
Subject: [PATCH] CAMEL-7129: Remove the CamelXsltResourceUri header from xslt
 component

---
 .../camel/component/xslt/XsltConstants.java       |  3 +++
 .../apache/camel/component/xslt/XsltEndpoint.java | 15 ++++-----------
 .../XsltFromHeaderOverrideEndpointUriTest.java    |  5 ++---
 3 files changed, 9 insertions(+), 14 deletions(-)

diff --git a/camel-core/src/main/java/org/apache/camel/component/xslt/XsltConstants.java b/camel-core/src/main/java/org/apache/camel/component/xslt/XsltConstants.java
index f5b12bc889a..1c76b416d8a 100644
--- a/camel-core/src/main/java/org/apache/camel/component/xslt/XsltConstants.java
+++ b/camel-core/src/main/java/org/apache/camel/component/xslt/XsltConstants.java
@@ -21,6 +21,9 @@
  */
 public final class XsltConstants {
 
+    @Deprecated 
+    // XsltComponent don't support this message any more
+    // Please create the XsltEndpoint directly from the URI
     public static final String XSLT_RESOURCE_URI = "CamelXsltResourceUri";
 
     private XsltConstants() {
diff --git a/camel-core/src/main/java/org/apache/camel/component/xslt/XsltEndpoint.java b/camel-core/src/main/java/org/apache/camel/component/xslt/XsltEndpoint.java
index f6f505c5eef..2ea7f606d9d 100644
--- a/camel-core/src/main/java/org/apache/camel/component/xslt/XsltEndpoint.java
+++ b/camel-core/src/main/java/org/apache/camel/component/xslt/XsltEndpoint.java
@@ -81,19 +81,12 @@ public XsltEndpoint findOrCreateEndpoint(String uri, String newResourceUri) {
 
     @Override
     protected void onExchange(Exchange exchange) throws Exception {
-        String newResourceUri = exchange.getIn().getHeader(XsltConstants.XSLT_RESOURCE_URI, String.class);
-        if (newResourceUri != null) {
-            exchange.getIn().removeHeader(XsltConstants.XSLT_RESOURCE_URI);
 
-            LOG.trace("{} set to {} creating new endpoint to handle exchange", XsltConstants.XSLT_RESOURCE_URI, newResourceUri);
-            XsltEndpoint newEndpoint = findOrCreateEndpoint(getEndpointUri(), newResourceUri);
-            newEndpoint.onExchange(exchange);
-        } else {
-            if (!cacheStylesheet || cacheCleared) {
-                loadResource(resourceUri);
-            }
-            super.onExchange(exchange);
+        if (!cacheStylesheet || cacheCleared) {
+            loadResource(resourceUri);
         }
+        super.onExchange(exchange);
+
     }
 
     /**
diff --git a/camel-core/src/test/java/org/apache/camel/component/xslt/XsltFromHeaderOverrideEndpointUriTest.java b/camel-core/src/test/java/org/apache/camel/component/xslt/XsltFromHeaderOverrideEndpointUriTest.java
index 84668b3943b..0eb6c262369 100644
--- a/camel-core/src/test/java/org/apache/camel/component/xslt/XsltFromHeaderOverrideEndpointUriTest.java
+++ b/camel-core/src/test/java/org/apache/camel/component/xslt/XsltFromHeaderOverrideEndpointUriTest.java
@@ -23,10 +23,9 @@
 import org.apache.camel.builder.RouteBuilder;
 import org.apache.camel.component.mock.MockEndpoint;
 import org.apache.camel.impl.JndiRegistry;
+import org.junit.Ignore;
 
-/**
- *
- */
+@Ignore("CamelXsltComponent don't support XSLT_RESOURCE_URI header anymore")
 public class XsltFromHeaderOverrideEndpointUriTest extends ContextTestSupport {
 
     public void testSendMessageAndHaveItTransformed() throws Exception {
