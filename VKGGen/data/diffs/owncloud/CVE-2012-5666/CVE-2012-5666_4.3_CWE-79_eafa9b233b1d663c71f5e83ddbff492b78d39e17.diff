From eafa9b233b1d663c71f5e83ddbff492b78d39e17 Mon Sep 17 00:00:00 2001
From: Lukas Reschke <lukas@statuscode.ch>
Date: Sun, 16 Dec 2012 11:09:17 +0100
Subject: [PATCH] Encode the URI properly

---
 bookmarks/js/bookmarks.js | 2 +-
 1 file changed, 1 insertion(+), 1 deletion(-)

diff --git a/bookmarks/js/bookmarks.js b/bookmarks/js/bookmarks.js
index 7f3104e812..8d1a8aa62f 100644
--- a/bookmarks/js/bookmarks.js
+++ b/bookmarks/js/bookmarks.js
@@ -141,7 +141,7 @@ function updateBookmarksList(bookmark) {
 	var taglist = '';
 	for ( var i=0, len=tags.length; i<len; ++i ){
 		if(tags[i] != '')
-			taglist = taglist + '<a class="bookmark_tag" href="'+replaceQueryString( String(window.location), 'tag', encodeURIComponent(tags[i])) + '">' + tags[i] + '</a> ';
+			taglist = taglist + '<a class="bookmark_tag" href="'+replaceQueryString(escapeHTML(String(window.location)), 'tag', encodeURIComponent(tags[i])) + '">' + tags[i] + '</a> ';
 	}
 	if(!hasProtocol(bookmark.url)) {
 		bookmark.url = 'http://' + bookmark.url;
