commit 709049bc63a0c198a782a2f3fba1bbb24ae062d3
Author:     Jacques Le Roux <jleroux@apache.org>
AuthorDate: Thu Sep 22 18:13:56 2016 +0000
Commit:     Jacques Le Roux <jleroux@apache.org>
CommitDate: Thu Sep 22 18:13:56 2016 +0000

    Oops this should not have been removed at r1761986
    
    [CVE-2016-4462] OFBiz template remote code vulnerability
    By manipulating the URL parameter externalLoginKey, a malicious, logged in
    user could pass valid Freemarker directives to the Template Engine that are
    reflected on the webpage; a specially crafted Freemarker template could be
    used for remote code execution.
    
    
    
    git-svn-id: https://svn.apache.org/repos/asf/ofbiz/branches/release13.07@1761987 13f79535-47bb-0310-9956-ffa450edef68

diff --git a/framework/widget/src/org/ofbiz/widget/form/MacroFormRenderer.java b/framework/widget/src/org/ofbiz/widget/form/MacroFormRenderer.java
index 40f1f69225..661b71b955 100644
--- a/framework/widget/src/org/ofbiz/widget/form/MacroFormRenderer.java
+++ b/framework/widget/src/org/ofbiz/widget/form/MacroFormRenderer.java
@@ -2760,6 +2760,7 @@ public class MacroFormRenderer implements FormStringRenderer {
             }
             String newQueryString = sb.toString();
             String urlPath = UtilHttp.removeQueryStringFromTarget(paginateTarget);
+            linkUrl = rh.makeLink(this.request, this.response, urlPath.concat(newQueryString));
         }
         StringWriter sr = new StringWriter();
         sr.append("<@renderSortField ");
