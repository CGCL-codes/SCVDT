commit d2d458d69c36053836d451700b1b07746852c4e1
Author:     Jacques Le Roux <jleroux@apache.org>
AuthorDate: Sun Aug 26 08:36:58 2012 +0000
Commit:     Jacques Le Roux <jleroux@apache.org>
CommitDate: Sun Aug 26 08:36:58 2012 +0000

    "Applied fix from trunk for revision: 1377388"
    ------------------------------------------------------------------------
    r1377388 | jleroux | 2012-08-26 10:35:34 +0200 (dim., 26 ao√ªt 2012) | 1 line
    
    CVE-2012-3506: Unlike descriptions and values, tooltips were not encoded, thanks to Scott for spotting it (r1377382 was flawed)
    ------------------------------------------------------------------------
    
    
    git-svn-id: https://svn.apache.org/repos/asf/ofbiz/branches/release12.04@1377389 13f79535-47bb-0310-9956-ffa450edef68

diff --git a/framework/widget/src/org/ofbiz/widget/form/ModelFormField.java b/framework/widget/src/org/ofbiz/widget/form/ModelFormField.java
index 7f8805963a..5d9e97f4e5 100644
--- a/framework/widget/src/org/ofbiz/widget/form/ModelFormField.java
+++ b/framework/widget/src/org/ofbiz/widget/form/ModelFormField.java
@@ -953,10 +953,14 @@ public class ModelFormField {
     }
 
     public String getTooltip(Map<String, Object> context) {
-        if (UtilValidate.isNotEmpty(tooltip)) return tooltip.expandString(context);
-            return "";
+        String tooltipString = "";
+        if (UtilValidate.isNotEmpty(tooltip)) tooltipString = tooltip.expandString(context);
+        if (this.getEncodeOutput()) {            
+            StringUtil.SimpleEncoder simpleEncoder = (StringUtil.SimpleEncoder) context.get("simpleEncoder");
+            if (simpleEncoder != null) tooltipString = simpleEncoder.encode(tooltipString);
         }
-
+        return tooltipString;        
+    }
     
     public String getUseWhen(Map<String, Object> context) {
         if (UtilValidate.isNotEmpty(this.useWhen)) return this.useWhen.expandString(context);
