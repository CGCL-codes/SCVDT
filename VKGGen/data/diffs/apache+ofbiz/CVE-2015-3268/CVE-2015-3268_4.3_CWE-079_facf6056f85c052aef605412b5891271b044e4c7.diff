commit facf6056f85c052aef605412b5891271b044e4c7
Author:     Jacques Le Roux <jleroux@apache.org>
AuthorDate: Thu Jul 23 08:38:24 2015 +0000
Commit:     Jacques Le Roux <jleroux@apache.org>
CommitDate: Thu Jul 23 08:38:24 2015 +0000

    "Applied fix from trunk for revision: 1692357  "
    ------------------------------------------------------------------------
    r1692357 | jleroux | 2015-07-23 10:36:36 +0200 (jeu. 23 juil. 2015) | 2 lignes
    
    The description attribute of the display-entity element is now escaped to prevent the risk of an XSS attack.
    [CVE-2015-3268] Stored Cross-Site Scripting Vulnerability affecting the description attribute of the display-entity element because it was not escaped.
    
    ------------------------------------------------------------------------
    
    
    git-svn-id: https://svn.apache.org/repos/asf/ofbiz/branches/release14.12@1692358 13f79535-47bb-0310-9956-ffa450edef68

diff --git a/framework/widget/src/org/ofbiz/widget/model/ModelFormField.java b/framework/widget/src/org/ofbiz/widget/model/ModelFormField.java
index ffb320f65a..e2d7394983 100644
--- a/framework/widget/src/org/ofbiz/widget/model/ModelFormField.java
+++ b/framework/widget/src/org/ofbiz/widget/model/ModelFormField.java
@@ -1301,10 +1301,17 @@ public class ModelFormField {
                 retVal = this.getDescription().expandString(localContext, locale);
             }
             // try to get the entry for the field if description doesn't expand to anything
-            if (UtilValidate.isEmpty(retVal))
+            if (UtilValidate.isEmpty(retVal)) {
                 retVal = fieldValue;
-            if (UtilValidate.isEmpty(retVal))
+            } 
+            if (UtilValidate.isEmpty(retVal)) {
                 retVal = "";
+            } else if (this.getModelFormField().getEncodeOutput()) {
+                UtilCodec.SimpleEncoder simpleEncoder = (UtilCodec.SimpleEncoder) context.get("simpleEncoder");
+                if (simpleEncoder != null) {
+                    retVal = simpleEncoder.encode(retVal);
+                }
+            }
             return retVal;
         }
 
