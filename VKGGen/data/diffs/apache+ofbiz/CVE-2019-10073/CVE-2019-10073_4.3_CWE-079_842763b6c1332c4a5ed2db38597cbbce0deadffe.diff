commit 842763b6c1332c4a5ed2db38597cbbce0deadffe
Author:     Jacopo Cappellato <jacopoc@apache.org>
AuthorDate: Tue Apr 30 14:56:41 2019 +0000
Commit:     Jacopo Cappellato <jacopoc@apache.org>
CommitDate: Tue Apr 30 14:56:41 2019 +0000

    Applied fix from trunk for revision: 1858432
    ===
    
    [Fixed]: Added permission checks to three blog/forum services; improved the
    configuration for the "add article forum" form (the source tab is not needed in
    the ecommerce application).
    
    Fixes CVE-2019-10073
    
    git-svn-id: https://svn.apache.org/repos/asf/ofbiz/branches/release16.11@1858438 13f79535-47bb-0310-9956-ffa450edef68

diff --git a/applications/content/servicedef/services.xml b/applications/content/servicedef/services.xml
index ae027a5383..fb2c6b02f6 100644
--- a/applications/content/servicedef/services.xml
+++ b/applications/content/servicedef/services.xml
@@ -426,6 +426,7 @@
     <service name="createArticleContent" engine="simple" transaction-timeout="300" auth="true"
             location="component://content/minilang/content/ContentServices.xml" invoke="createArticleContent">
         <description>Creates content records for a blog entry</description>
+        <permission-service service-name="genericContentPermission" main-action="CREATE"/>
         <implements service="createContentFromUploadedFile" optional="true"/>
         <implements service="createTextContent" optional="true"/>
         <attribute name="contentIdFrom" type="String" mode="IN" optional="false"/>
@@ -820,6 +821,7 @@
     <service name="createBlogEntry" engine="simple" auth="true"
         location="component://content/minilang/blog/BlogServices.xml" invoke="createBlogEntry">
         <description>Creates content records for a blog entry</description>
+        <permission-service service-name="genericContentPermission" main-action="CREATE"/>
         <implements service="uploadFileInterface" optional="true"/>
         <attribute name="blogContentId" type="String" mode="INOUT" optional="false"/>
         <attribute name="contentId" type="String" mode="OUT" optional="false"/>
@@ -833,6 +835,7 @@
     <service name="updateBlogEntry" engine="simple" auth="true"
         location="component://content/minilang/blog/BlogServices.xml" invoke="updateBlogEntry">
         <description>Updates content records for a blog entry</description>
+        <permission-service service-name="genericContentPermission" main-action="CREATE"/>
         <implements service="uploadFileInterface" optional="true"/>
         <attribute name="blogContentId" type="String" mode="INOUT" optional="false"/>
         <attribute name="contentId" type="String" mode="INOUT" optional="false"/>
diff --git a/applications/content/widget/forum/BlogForms.xml b/applications/content/widget/forum/BlogForms.xml
index 596199c402..7b14d32e5b 100644
--- a/applications/content/widget/forum/BlogForms.xml
+++ b/applications/content/widget/forum/BlogForms.xml
@@ -71,7 +71,7 @@ under the License.
         <field name="contentName" title="${uiLabelMap.ContentArticleName}"><text size="40"/></field>
         <field name="description"><textarea cols="60" rows="2"/></field>
         <field name="summaryData" title="${uiLabelMap.ContentSummary}" widget-style="inputBox"><textarea cols="60" rows="4"/></field>
-        <field name="articleData" title="${uiLabelMap.ContentBlogArticle}" widget-style="inputBox"><textarea cols="100" rows="20" visual-editor-enable="true"/></field>
+        <field name="articleData" title="${uiLabelMap.ContentBlogArticle}" widget-style="inputBox"><textarea cols="100" rows="20" visual-editor-enable="false"/></field>
         <field name="uploadedFile" title="${uiLabelMap.ContentImage}"><file size="25"/></field>
         <field name="templateDataResourceId" title="${uiLabelMap.ContentTemplate}">
             <drop-down>
diff --git a/specialpurpose/ecommerce/widget/ForumForms.xml b/specialpurpose/ecommerce/widget/ForumForms.xml
index b06bf948f1..22320df5fd 100644
--- a/specialpurpose/ecommerce/widget/ForumForms.xml
+++ b/specialpurpose/ecommerce/widget/ForumForms.xml
@@ -33,7 +33,7 @@ under the License.
         <field name="pubPtContentId"><hidden value="${parameters.forumId}"/></field>
         <field name="contentAssocTypeId"><hidden value="${contentAssoc.contentAssocTypeId}"/></field>
         <field name="textData" map-name="dummy">
-        <textarea  rows="10" visual-editor-enable="true" visual-editor-buttons="compact"/>
+        <textarea  rows="10" visual-editor-enable="false" visual-editor-buttons="compact"/>
         </field>
         <field name="addButton" title="${uiLabelMap.CommonAdd}" widget-style="smallSubmit"><submit button-type="button"/></field>
     </form>
