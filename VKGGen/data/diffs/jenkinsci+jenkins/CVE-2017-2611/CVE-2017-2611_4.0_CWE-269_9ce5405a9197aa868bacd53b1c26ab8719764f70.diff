From 9ce5405a9197aa868bacd53b1c26ab8719764f70 Mon Sep 17 00:00:00 2001
From: Jesse Glick <jglick@cloudbees.com>
Date: Fri, 6 Jan 2017 14:50:12 -0500
Subject: [PATCH] [SECURITY-389] Check ADMINISTER on /fingerprintCleanup and
 /workspaceCleanup.

---
 core/src/main/java/jenkins/model/Jenkins.java | 2 ++
 1 file changed, 2 insertions(+)

diff --git a/core/src/main/java/jenkins/model/Jenkins.java b/core/src/main/java/jenkins/model/Jenkins.java
index 65a5c9ebcfa..5d453270075 100644
--- a/core/src/main/java/jenkins/model/Jenkins.java
+++ b/core/src/main/java/jenkins/model/Jenkins.java
@@ -3620,6 +3620,7 @@ public void doIconSize( StaplerRequest req, StaplerResponse rsp ) throws IOExcep
 
     @RequirePOST
     public void doFingerprintCleanup(StaplerResponse rsp) throws IOException {
+        checkPermission(ADMINISTER);
         FingerprintCleanupThread.invoke();
         rsp.setStatus(HttpServletResponse.SC_OK);
         rsp.setContentType("text/plain");
@@ -3628,6 +3629,7 @@ public void doFingerprintCleanup(StaplerResponse rsp) throws IOException {
 
     @RequirePOST
     public void doWorkspaceCleanup(StaplerResponse rsp) throws IOException {
+        checkPermission(ADMINISTER);
         WorkspaceCleanupThread.invoke();
         rsp.setStatus(HttpServletResponse.SC_OK);
         rsp.setContentType("text/plain");
