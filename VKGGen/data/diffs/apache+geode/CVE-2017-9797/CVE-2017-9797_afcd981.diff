From afcd9817bc28069453861c935f428e89b8c7ff5d Mon Sep 17 00:00:00 2001
From: Bruce Schuchardt <bschuchardt@pivotal.io>
Date: Wed, 30 Aug 2017 13:50:48 -0700
Subject: [PATCH] GEODE-3249 Validate internal client/server messages

The addition of USER_CREDENTIAL_MESSAGE in ServerConnection.isInternalMessage
caused problems for the c++ client.  This message class does require
credentials and shouldn't be included in the set of internal messages.

(cherry picked from commit f2492bf0abdc662cc080f1e2c0f17257e05604a3)
---
 .../geode/internal/cache/tier/sockets/ServerConnection.java      | 1 -
 1 file changed, 1 deletion(-)

diff --git a/geode-core/src/main/java/org/apache/geode/internal/cache/tier/sockets/ServerConnection.java b/geode-core/src/main/java/org/apache/geode/internal/cache/tier/sockets/ServerConnection.java
index 80b5b4467c7..ad06dec5d5b 100644
--- a/geode-core/src/main/java/org/apache/geode/internal/cache/tier/sockets/ServerConnection.java
+++ b/geode-core/src/main/java/org/apache/geode/internal/cache/tier/sockets/ServerConnection.java
@@ -1108,7 +1108,6 @@ public Part updateAndGetSecurityPart() {
   public boolean isInternalMessage(Message message, boolean allowOldInternalMessages) {
     int messageType = message.getMessageType();
     boolean isInternalMessage = messageType == MessageType.PING
-        || messageType == MessageType.USER_CREDENTIAL_MESSAGE
         || messageType == MessageType.REQUEST_EVENT_VALUE || messageType == MessageType.MAKE_PRIMARY
         || messageType == MessageType.REMOVE_USER_AUTH || messageType == MessageType.CLIENT_READY
         || messageType == MessageType.SIZE || messageType == MessageType.TX_FAILOVER
