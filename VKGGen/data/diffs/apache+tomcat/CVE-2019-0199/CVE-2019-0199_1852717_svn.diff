Index: tc8.5.x/trunk/java/org/apache/coyote/http2/LocalStrings.properties
===================================================================
--- tc8.5.x/trunk/java/org/apache/coyote/http2/LocalStrings.properties	(revision 1852716)
+++ tc8.5.x/trunk/java/org/apache/coyote/http2/LocalStrings.properties	(revision 1852717)
@@ -98,6 +98,7 @@
 stream.inputBuffer.dispatch=Data added to inBuffer when read interest is registered. Triggering a read dispatch
 stream.inputBuffer.empty=The Stream input buffer is empty. Waiting for more data
 stream.inputBuffer.readTimeout=Timeout waiting to read data from client
+stream.inputBuffer.reset=Stream reset
 stream.inputBuffer.signal=Data added to inBuffer when read thread is waiting. Signalling that thread to continue
 
 stream.outputBuffer.flush.debug=Connection [{0}], Stream [{1}], flushing output with buffer at position [{2}], writeInProgress [{3}] and closed [{4}]
Index: tc8.5.x/trunk/java/org/apache/coyote/http2/Stream.java
===================================================================
--- tc8.5.x/trunk/java/org/apache/coyote/http2/Stream.java	(revision 1852716)
+++ tc8.5.x/trunk/java/org/apache/coyote/http2/Stream.java	(revision 1852717)
@@ -602,6 +602,10 @@
         } else {
             handler.closeConnection(http2Exception);
         }
+        // Reads wait internally so need to call a method to break the wait()
+        if (inputBuffer != null) {
+            inputBuffer.receiveReset();
+        }
     }
 
 
@@ -986,8 +990,7 @@
                         inBuffer.wait(handler.getProtocol().getStreamReadTimeout());
 
                         if (resetReceived) {
-                            // TODO: i18n
-                            throw new IOException("HTTP/2 Stream reset");
+                            throw new IOException(sm.getString("stream.inputBuffer.reset"));
                         }
 
                         if (inBuffer.position() == 0) {
Index: tc8.5.x/trunk
===================================================================
--- tc8.5.x/trunk	(revision 1852716)
+++ tc8.5.x/trunk	(revision 1852717)

Property changes on: tc8.5.x/trunk
___________________________________________________________________
Modified: svn:mergeinfo
## -0,0 +0,1 ##
   Merged /tomcat/trunk:r1785820
