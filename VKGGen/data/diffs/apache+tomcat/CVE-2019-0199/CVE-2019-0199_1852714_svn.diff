Index: tc8.5.x/trunk/java/org/apache/coyote/http2/Http2Protocol.java
===================================================================
--- tc8.5.x/trunk/java/org/apache/coyote/http2/Http2Protocol.java	(revision 1852713)
+++ tc8.5.x/trunk/java/org/apache/coyote/http2/Http2Protocol.java	(revision 1852714)
@@ -41,9 +41,9 @@
 
 public class Http2Protocol implements UpgradeProtocol {
 
-    static final long DEFAULT_READ_TIMEOUT = 10000;
-    static final long DEFAULT_WRITE_TIMEOUT = 10000;
-    static final long DEFAULT_KEEP_ALIVE_TIMEOUT = -1;
+    static final long DEFAULT_READ_TIMEOUT = 5000;
+    static final long DEFAULT_WRITE_TIMEOUT = 5000;
+    static final long DEFAULT_KEEP_ALIVE_TIMEOUT = 20000;
     static final long DEFAULT_STREAM_READ_TIMEOUT = 20000;
     static final long DEFAULT_STREAM_WRITE_TIMEOUT = 20000;
     // The HTTP/2 specification recommends a minimum default of 100
Index: tc8.5.x/trunk/java/org/apache/coyote/http2/Http2UpgradeHandler.java
===================================================================
--- tc8.5.x/trunk/java/org/apache/coyote/http2/Http2UpgradeHandler.java	(revision 1852713)
+++ tc8.5.x/trunk/java/org/apache/coyote/http2/Http2UpgradeHandler.java	(revision 1852714)
@@ -350,9 +350,16 @@
                             }
                         }
                     }
-                    // No more frames to read so switch to the keep-alive
-                    // timeout.
-                    socketWrapper.setReadTimeout(getKeepAliveTimeout());
+
+                    if (activeRemoteStreamCount.get() == 0) {
+                        // No streams currently active. Use the keep-alive
+                        // timeout for the connection.
+                        socketWrapper.setReadTimeout(getKeepAliveTimeout());
+                    } else {
+                        // Streams currently active. Individual streams have
+                        // timeouts so keep the connection open.
+                        socketWrapper.setReadTimeout(-1);
+                    }
                 } catch (Http2Exception ce) {
                     // Really ConnectionException
                     if (log.isDebugEnabled()) {
Index: tc8.5.x/trunk
===================================================================
--- tc8.5.x/trunk	(revision 1852713)
+++ tc8.5.x/trunk	(revision 1852714)

Property changes on: tc8.5.x/trunk
___________________________________________________________________
Modified: svn:mergeinfo
## -0,0 +0,1 ##
   Merged /tomcat/trunk:r1852701
