Index: tc8.5.x/trunk/java/org/apache/coyote/http2/Stream.java
===================================================================
--- tc8.5.x/trunk/java/org/apache/coyote/http2/Stream.java	(revision 1852721)
+++ tc8.5.x/trunk/java/org/apache/coyote/http2/Stream.java	(revision 1852722)
@@ -218,7 +218,12 @@
             }
             try {
                 if (block) {
-                    wait(handler.getProtocol().getStreamWriteTimeout());
+                    long writeTimeout = handler.getProtocol().getStreamWriteTimeout();
+                    if (writeTimeout < 0) {
+                        wait();
+                    } else {
+                        wait(writeTimeout);
+                    }
                     windowSize = getWindowSize();
                     if (windowSize == 0) {
                         String msg = sm.getString("stream.writeTimeout");
@@ -987,7 +992,12 @@
                             log.debug(sm.getString("stream.inputBuffer.empty"));
                         }
 
-                        inBuffer.wait(handler.getProtocol().getStreamReadTimeout());
+                        long readTimeout = handler.getProtocol().getStreamReadTimeout();
+                        if (readTimeout < 0) {
+                            inBuffer.wait();
+                        } else {
+                            inBuffer.wait(readTimeout);
+                        }
 
                         if (resetReceived) {
                             throw new IOException(sm.getString("stream.inputBuffer.reset"));
@@ -1055,11 +1065,15 @@
                             log.debug(sm.getString("stream.inputBuffer.empty"));
                         }
 
-                        inBuffer.wait(handler.getProtocol().getStreamReadTimeout());
+                        long readTimeout = handler.getProtocol().getStreamReadTimeout();
+                        if (readTimeout < 0) {
+                            inBuffer.wait();
+                        } else {
+                            inBuffer.wait(readTimeout);
+                        }
 
                         if (resetReceived) {
-                            // TODO: i18n
-                            throw new IOException("HTTP/2 Stream reset");
+                            throw new IOException(sm.getString("stream.inputBuffer.reset"));
                         }
 
                         if (inBuffer.position() == 0) {
Index: tc8.5.x/trunk
===================================================================
--- tc8.5.x/trunk	(revision 1852721)
+++ tc8.5.x/trunk	(revision 1852722)

Property changes on: tc8.5.x/trunk
___________________________________________________________________
Modified: svn:mergeinfo
## -0,0 +0,1 ##
   Merged /tomcat/trunk:r1852703-1852704
