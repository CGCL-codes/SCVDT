commit 8d14c6f21d29768a39be4b6b9517060dc6606758
Author:     Mark Thomas <markt@apache.org>
AuthorDate: Fri May 3 21:52:41 2019 +0100
Commit:     Mark Thomas <markt@apache.org>
CommitDate: Fri May 3 21:53:49 2019 +0100

    Fix test failures. Handle full allocation case.

diff --git a/java/org/apache/coyote/http2/Http2UpgradeHandler.java b/java/org/apache/coyote/http2/Http2UpgradeHandler.java
index e5ae91f679..a9ab68def9 100644
--- a/java/org/apache/coyote/http2/Http2UpgradeHandler.java
+++ b/java/org/apache/coyote/http2/Http2UpgradeHandler.java
@@ -815,8 +815,10 @@ public class Http2UpgradeHandler extends AbstractStream implements InternalHttpU
                                 stream.wait(writeTimeout);
                             }
                             // Has this stream been granted an allocation
+                            // Note: If the stream in not in this Map then the
+                            //       requested write has been fully allocated
                             int[] value = backLogStreams.get(stream);
-                            if (value[1] == 0) {
+                            if (value != null && value[1] == 0) {
                                 // No allocation
                                 // Close the connection. Do this first since
                                 // closing the stream will raise an exception
