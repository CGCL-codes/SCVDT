Index: trunk/java/org/apache/coyote/http11/Http11InputBuffer.java
===================================================================
--- trunk/java/org/apache/coyote/http11/Http11InputBuffer.java	(revision 1774160)
+++ trunk/java/org/apache/coyote/http11/Http11InputBuffer.java	(revision 1774161)
@@ -284,6 +284,7 @@
         // Copy leftover bytes to the beginning of the buffer
         if (byteBuffer.remaining() > 0 && byteBuffer.position() > 0) {
             byteBuffer.compact();
+            byteBuffer.flip();
         }
         // Always reset pos to zero
         byteBuffer.limit(byteBuffer.limit() - byteBuffer.position()).position(0);
Index: trunk/webapps/docs/changelog.xml
===================================================================
--- trunk/webapps/docs/changelog.xml	(revision 1774160)
+++ trunk/webapps/docs/changelog.xml	(revision 1774161)
@@ -87,6 +87,11 @@
         when configured with an address of <code>0.0.0.0</code> or
         <code>::</code>. (markt)
       </fix>
+      <fix>
+        Correct a regression in the refactoring to make wider use of
+        <code>ByteBuffer</code> that caused an intermittent failure in the unit
+        tests. (markt)
+      </fix>
     </changelog>
   </subsection>
   <subsection name="Web Applications">
