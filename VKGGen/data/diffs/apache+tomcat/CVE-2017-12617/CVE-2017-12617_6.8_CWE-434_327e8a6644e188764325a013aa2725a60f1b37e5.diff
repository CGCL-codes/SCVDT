commit 327e8a6644e188764325a013aa2725a60f1b37e5
Author:     Mark Thomas <markt@apache.org>
AuthorDate: Fri Sep 22 10:18:29 2017 +0000
Commit:     Mark Thomas <markt@apache.org>
CommitDate: Fri Sep 22 10:18:29 2017 +0000

    Fix https://bz.apache.org/bugzilla/show_bug.cgi?id=61542
    Remainder of fix for CVE-2017-12617
    This ensures that a path specified for creation of a file does not end in '/' since that is dropped by the File API.
    
    git-svn-id: https://svn.apache.org/repos/asf/tomcat/tc7.0.x/trunk@1809293 13f79535-47bb-0310-9956-ffa450edef68

diff --git a/java/org/apache/naming/resources/FileDirContext.java b/java/org/apache/naming/resources/FileDirContext.java
index 2c94a80bd4..b7dc1080da 100644
--- a/java/org/apache/naming/resources/FileDirContext.java
+++ b/java/org/apache/naming/resources/FileDirContext.java
@@ -476,11 +476,16 @@ public class FileDirContext extends BaseDirContext {
      * @exception NamingException if a naming exception is encountered
      */
     @Override
-    public void bind(String name, Object obj, Attributes attrs)
-        throws NamingException {
+    public void bind(String name, Object obj, Attributes attrs) throws NamingException {
 
         // Note: No custom attributes allowed
 
+        // bind() is meant to create a file so ensure that the path doesn't end
+        // in '/'
+        if (name.endsWith("/")) {
+            throw new NamingException(sm.getString("resources.bindFailed", name));
+        }
+
         File file = file(name, false);
         if (file == null) {
             throw new NamingException(sm.getString("resources.bindFailed", name));
diff --git a/webapps/docs/changelog.xml b/webapps/docs/changelog.xml
index 2db8b6205a..5361d73bc2 100644
--- a/webapps/docs/changelog.xml
+++ b/webapps/docs/changelog.xml
@@ -90,6 +90,11 @@
         <code>DirContext</code> that represented the web application in a
         <code>ProxyDirContext</code> twice rather than just once. (markt)
       </fix>
+      <fix>
+        <bug>61542</bug>: Fix CVE-2017-12617 and prevent JSPs from being
+        uploaded via a specially crafted request when HTTP PUT was enabled.
+        (markt)
+      </fix>
     </changelog>
   </subsection>
   <subsection name="Coyote">
