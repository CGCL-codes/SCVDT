Index: jk/trunk/native/apache-2.0/mod_jk.c
===================================================================
--- jk/trunk/native/apache-2.0/mod_jk.c	(revision 1840448)
+++ jk/trunk/native/apache-2.0/mod_jk.c	(revision 1840449)
@@ -2729,6 +2729,14 @@
         return DECLINED;
     }
 
+    rconf = (jk_request_conf_t *)ap_get_module_config(r->request_config, &jk_module);
+    if (rconf == NULL) {
+        rconf = apr_palloc(r->pool, sizeof(jk_request_conf_t));
+        rconf->jk_handled = JK_FALSE;
+        rconf->rule_extensions = NULL;
+        ap_set_module_config(r->request_config, &jk_module, rconf);
+    }
+
     worker_name = apr_table_get(r->notes, JK_NOTE_WORKER_NAME);
 
     if (worker_name == NULL) {
@@ -2752,8 +2760,6 @@
                 worker_name_extension = JK_TRUE;
                 parse_rule_extensions(w, e, xconf->log);
                 worker_name = w;
-                rconf = (jk_request_conf_t *)ap_get_module_config(r->request_config,
-                                                                  &jk_module);
                 rconf->rule_extensions = e;
             }
         }
@@ -2787,9 +2793,9 @@
 
                 worker_name = map_uri_to_worker_ext(xconf->uw_map, clean_uri,
                                                     NULL, &e, NULL, xconf->log);
-                rconf = (jk_request_conf_t *)ap_get_module_config(r->request_config,
-                                                                  &jk_module);
-                rconf->rule_extensions = e;
+                if (worker_name) {
+                    rconf->rule_extensions = e;
+                }
             }
 
             if (worker_name == NULL && worker_env.num_of_workers) {
@@ -2809,8 +2815,6 @@
               " r->proxyreq=%d",
               r->handler, STRNULL_FOR_NULL(worker_name), r->proxyreq);
 
-    rconf = (jk_request_conf_t *)ap_get_module_config(r->request_config,
-                                                      &jk_module);
     rconf->jk_handled = JK_TRUE;
 
     /* If this is a proxy request, we'll notify an error */
@@ -3845,8 +3849,9 @@
                 rule_extension_t *e;
                 worker = map_uri_to_worker_ext(conf->uw_map, clean_uri,
                                                NULL, &e, NULL, conf->log);
-                rconf->rule_extensions = e;
-                ap_set_module_config(r->request_config, &jk_module, rconf);
+                if (worker) {
+                    rconf->rule_extensions = e;
+                }
             }
 
             if (worker) {
@@ -4021,8 +4026,9 @@
                 rule_extension_t *e;
                 worker = map_uri_to_worker_ext(conf->uw_map, clean_uri,
                                                NULL, &e, NULL, conf->log);
-                rconf->rule_extensions = e;
-                ap_set_module_config(r->request_config, &jk_module, rconf);
+                if (worker) {
+                    rconf->rule_extensions = e;
+                }
             }
 
             if (worker) {
