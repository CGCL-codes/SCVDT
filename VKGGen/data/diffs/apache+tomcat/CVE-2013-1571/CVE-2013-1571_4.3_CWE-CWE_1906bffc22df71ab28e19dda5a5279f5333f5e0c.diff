commit 1906bffc22df71ab28e19dda5a5279f5333f5e0c
Author:     Konstantin Kolinko <kkolinko@apache.org>
AuthorDate: Sun Oct 26 14:47:11 2014 +0000
Commit:     Konstantin Kolinko <kkolinko@apache.org>
CommitDate: Sun Oct 26 14:47:11 2014 +0000

    Remove patch-javadoc macros.
    It is not used, because another solution has been applier: all javadoc is generated with Java 7 JDK.
    Java 7.0.25+ is not vulnerable to CVE-2013-1571 that is fixed by this patch macro.
    
    git-svn-id: https://svn.apache.org/repos/asf/tomcat/tc7.0.x/trunk@1634342 13f79535-47bb-0310-9956-ffa450edef68

diff --git a/build.xml b/build.xml
index 5129bc4c92..e51b284680 100644
--- a/build.xml
+++ b/build.xml
@@ -1931,74 +1931,6 @@ Apache Tomcat ${version} native binaries for Win64 AMD64/EMT64 platform.
     </javadoc>
   </target>
 
-  <!--
-    Patch frame injection bugs in javadoc generated files - see CVE-2013-1571,
-    http://www.kb.cert.org/vuls/id/225657
-
-    This macro works together with the javadoc task on Ant and should be invoked
-    directly after its execution to patch broken javadocs, e.g.:
-    <patch-javadoc dir="..." docencoding="UTF-8"/>
-    Please make sure that the docencoding parameter uses the same charset as
-    javadoc's docencoding. Default is the platform default encoding (like the
-    javadoc task).
-    The specified dir is the destination directory of the javadoc task.
-  -->
-  <macrodef name="patch-javadoc">
-    <attribute name="dir"/>
-    <attribute name="docencoding" default="${file.encoding}"/>
-    <sequential>
-      <replace encoding="@{docencoding}" summary="true" taskname="patch-javadoc">
-        <restrict>
-          <fileset dir="@{dir}" casesensitive="false"
-              includes="**/index.html,**/index.htm,**/toc.html,**/toc.htm"/>
-          <!-- TODO: add encoding="@{docencoding}" to contains check, when we
-               are on ANT 1.9.0: -->
-          <not>
-            <contains text="function validURL(url) {" casesensitive="true" />
-          </not>
-        </restrict>
-        <replacetoken><![CDATA[function loadFrames() {]]></replacetoken>
-        <replacevalue expandProperties="false"><![CDATA[if (targetPage != "" && !validURL(targetPage))
-        targetPage = "undefined";
-    function validURL(url) {
-        var pos = url.indexOf(".html");
-        if (pos == -1 || pos != url.length - 5)
-            return false;
-        var allowNumber = false;
-        var allowSep = false;
-        var seenDot = false;
-        for (var i = 0; i < url.length - 5; i++) {
-            var ch = url.charAt(i);
-            if ('a' <= ch && ch <= 'z' ||
-                    'A' <= ch && ch <= 'Z' ||
-                    ch == '$' ||
-                    ch == '_') {
-                allowNumber = true;
-                allowSep = true;
-            } else if ('0' <= ch && ch <= '9'
-                    || ch == '-') {
-                if (!allowNumber)
-                     return false;
-            } else if (ch == '/' || ch == '.') {
-                if (!allowSep)
-                    return false;
-                allowNumber = false;
-                allowSep = false;
-                if (ch == '.')
-                     seenDot = true;
-                if (ch == '/' && seenDot)
-                     return false;
-            } else {
-                return false;
-            }
-        }
-        return true;
-    }
-    function loadFrames() {]]></replacevalue>
-      </replace>
-    </sequential>
-  </macrodef>
-
   <target name="dist-deployer" depends="dist-prepare,deploy"
     description="Create the Tomcat deployer binary">
 
