Index: tc7.0.x/trunk/java/org/apache/catalina/startup/ContextConfig.java
===================================================================
--- tc7.0.x/trunk/java/org/apache/catalina/startup/ContextConfig.java	(revision 1824359)
+++ tc7.0.x/trunk/java/org/apache/catalina/startup/ContextConfig.java	(revision 1824360)
@@ -431,19 +431,10 @@
     protected void authenticatorConfig() {
 
         LoginConfig loginConfig = context.getLoginConfig();
-
-        SecurityConstraint constraints[] = context.findConstraints();
-        if ((constraints == null || constraints.length ==0) &&
-                !context.getPreemptiveAuthentication())  {
-            // No need for an authenticator
-            return;
-        } else {
-            if (loginConfig == null) {
-                // Security constraints present. Need an authenticator to
-                // support them.
-                loginConfig = DUMMY_LOGIN_CONFIG;
-                context.setLoginConfig(loginConfig);
-            }
+        if (loginConfig == null) {
+            // Need an authenticator to support HttpServletRequest.login()
+            loginConfig = DUMMY_LOGIN_CONFIG;
+            context.setLoginConfig(loginConfig);
         }
 
         // Has an authenticator been configured already?
Index: tc7.0.x/trunk/webapps/docs/changelog.xml
===================================================================
--- tc7.0.x/trunk/webapps/docs/changelog.xml	(revision 1824359)
+++ tc7.0.x/trunk/webapps/docs/changelog.xml	(revision 1824360)
@@ -65,6 +65,11 @@
         compressed with brotli compression. Based on a patch provided by burka.
         (markt)
       </fix>
+      <fix>
+        <bug>62104</bug>: Fix programmatic login regression as the
+        NonLoginAuthenticator has to be set for it to work (if no login method
+        is specified). (remm)
+      </fix>
     </changelog>
   </subsection>
 </section>
Index: tc7.0.x/trunk
===================================================================
--- tc7.0.x/trunk	(revision 1824359)
+++ tc7.0.x/trunk	(revision 1824360)

Property changes on: tc7.0.x/trunk
___________________________________________________________________
Modified: svn:mergeinfo
## -0,0 +0,2 ##
   Merged /tomcat/trunk:r1824323,1824357
   Merged /tomcat/tc8.5.x/trunk:r1824358
