Index: tc8.5.x/trunk/java/org/apache/catalina/startup/ContextConfig.java
===================================================================
--- tc8.5.x/trunk/java/org/apache/catalina/startup/ContextConfig.java	(revision 1824357)
+++ tc8.5.x/trunk/java/org/apache/catalina/startup/ContextConfig.java	(revision 1824358)
@@ -342,19 +342,10 @@
     protected void authenticatorConfig() {
 
         LoginConfig loginConfig = context.getLoginConfig();
-
-        SecurityConstraint constraints[] = context.findConstraints();
-        if ((constraints == null || constraints.length ==0) &&
-                !context.getPreemptiveAuthentication())  {
-            // No need for an authenticator
-            return;
-        } else {
-            if (loginConfig == null) {
-                // Security constraints present. Need an authenticator to
-                // support them.
-                loginConfig = DUMMY_LOGIN_CONFIG;
-                context.setLoginConfig(loginConfig);
-            }
+        if (loginConfig == null) {
+            // Need an authenticator to support HttpServletRequest.login()
+            loginConfig = DUMMY_LOGIN_CONFIG;
+            context.setLoginConfig(loginConfig);
         }
 
         // Has an authenticator been configured already?
Index: tc8.5.x/trunk/webapps/docs/changelog.xml
===================================================================
--- tc8.5.x/trunk/webapps/docs/changelog.xml	(revision 1824357)
+++ tc8.5.x/trunk/webapps/docs/changelog.xml	(revision 1824358)
@@ -55,6 +55,11 @@
         compressed with brotli compression. Based on a patch provided by burka.
         (markt)
       </fix>
+      <fix>
+        <bug>62104</bug>: Fix programmatic login regression as the
+        NonLoginAuthenticator has to be set for it to work (if no login method
+        is specified). (remm)
+      </fix>
     </changelog>
   </subsection>
   <subsection name="Coyote">
Index: tc8.5.x/trunk
===================================================================
--- tc8.5.x/trunk	(revision 1824357)
+++ tc8.5.x/trunk	(revision 1824358)

Property changes on: tc8.5.x/trunk
___________________________________________________________________
Modified: svn:mergeinfo
## -0,0 +0,1 ##
   Merged /tomcat/trunk:r1824323,1824357
