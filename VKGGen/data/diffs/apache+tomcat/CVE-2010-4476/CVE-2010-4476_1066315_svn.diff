Index: tc6.0.x/trunk/java/org/apache/catalina/connector/Request.java
===================================================================
--- tc6.0.x/trunk/java/org/apache/catalina/connector/Request.java	(revision 1066314)
+++ tc6.0.x/trunk/java/org/apache/catalina/connector/Request.java	(revision 1066315)
@@ -2740,7 +2740,12 @@
             int semi = entry.indexOf(";q=");
             if (semi >= 0) {
                 try {
-                    quality = Double.parseDouble(entry.substring(semi + 3));
+                    String strQuality = entry.substring(semi + 3);
+                    if (strQuality.length() <= 5) {
+                        quality = Double.parseDouble(strQuality);
+                    } else {
+                        quality = 0.0;
+                    }
                 } catch (NumberFormatException e) {
                     quality = 0.0;
                 }
Index: tc6.0.x/trunk/webapps/docs/changelog.xml
===================================================================
--- tc6.0.x/trunk/webapps/docs/changelog.xml	(revision 1066314)
+++ tc6.0.x/trunk/webapps/docs/changelog.xml	(revision 1066315)
@@ -55,6 +55,10 @@
         during FORM authentication if client indicates that they are expected.
         (kkolinko)
       </fix>
+      <fix>
+        Improve HTTP specification compliance in support of
+        <code>Accept-Language</code> header. (kkolinko)
+      </fix>
     </changelog>
   </subsection>
   <subsection name="Coyote">
Index: tc6.0.x/trunk/STATUS.txt
===================================================================
--- tc6.0.x/trunk/STATUS.txt	(revision 1066314)
+++ tc6.0.x/trunk/STATUS.txt	(revision 1066315)
@@ -110,8 +110,3 @@
      defaultProtocol, defaultKeystoreType, though I do not see much
      concerns against it.
    markt: Happy to exclude those changes
-
-* Improve HTTP specification compliance
-  http://svn.apache.org/viewvc?rev=1066244&view=rev
-  +1: kkolinko, rjung, markt, funkman
-  -1:
Index: tc6.0.x/trunk
===================================================================
--- tc6.0.x/trunk	(revision 1066314)
+++ tc6.0.x/trunk	(revision 1066315)

Property changes on: tc6.0.x/trunk
___________________________________________________________________
Modified: svn:mergeinfo
## -0,0 +0,1 ##
   Merged /tomcat/trunk:r1066244
