Index: tc8.0.x/trunk/java/org/apache/catalina/servlets/DefaultServlet.java
===================================================================
--- tc8.0.x/trunk/java/org/apache/catalina/servlets/DefaultServlet.java	(revision 1793469)
+++ tc8.0.x/trunk/java/org/apache/catalina/servlets/DefaultServlet.java	(revision 1793470)
@@ -760,7 +760,7 @@
             return;
         }
 
-        boolean isError = response.getStatus() >= HttpServletResponse.SC_BAD_REQUEST;
+        boolean isError = DispatcherType.ERROR == request.getDispatcherType();
 
         boolean included = false;
         // Check if the conditions specified in the optional If headers are
Index: tc8.0.x/trunk/webapps/docs/changelog.xml
===================================================================
--- tc8.0.x/trunk/webapps/docs/changelog.xml	(revision 1793469)
+++ tc8.0.x/trunk/webapps/docs/changelog.xml	(revision 1793470)
@@ -73,6 +73,11 @@
         ensure that that correct encoding (path differs from query string) is
         applied and that the encoding is applied consistently. (markt)
       </fix>
+      <fix>
+        Use a more reliable mechanism for the <code>DefaultServlet</code> when
+        determining if the current request is for custom error page or not.
+        (markt)
+      </fix>
     </changelog>
   </subsection>
   <subsection name="Jasper">
Index: tc8.0.x/trunk
===================================================================
--- tc8.0.x/trunk	(revision 1793469)
+++ tc8.0.x/trunk	(revision 1793470)

Property changes on: tc8.0.x/trunk
___________________________________________________________________
Modified: svn:mergeinfo
## -0,0 +0,1 ##
   Merged /tomcat/trunk:r1793468
