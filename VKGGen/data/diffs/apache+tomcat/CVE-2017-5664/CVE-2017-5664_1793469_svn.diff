Index: tc8.5.x/trunk/java/org/apache/catalina/servlets/DefaultServlet.java
===================================================================
--- tc8.5.x/trunk/java/org/apache/catalina/servlets/DefaultServlet.java	(revision 1793468)
+++ tc8.5.x/trunk/java/org/apache/catalina/servlets/DefaultServlet.java	(revision 1793469)
@@ -794,7 +794,7 @@
             return;
         }
 
-        boolean isError = response.getStatus() >= HttpServletResponse.SC_BAD_REQUEST;
+        boolean isError = DispatcherType.ERROR == request.getDispatcherType();
 
         boolean included = false;
         // Check if the conditions specified in the optional If headers are
Index: tc8.5.x/trunk/webapps/docs/changelog.xml
===================================================================
--- tc8.5.x/trunk/webapps/docs/changelog.xml	(revision 1793468)
+++ tc8.5.x/trunk/webapps/docs/changelog.xml	(revision 1793469)
@@ -78,6 +78,11 @@
         the number of places the associated <code>Charset</code> needs to be
         looked up. (markt)
       </scode>
+      <fix>
+        Use a more reliable mechanism for the <code>DefaultServlet</code> when
+        determining if the current request is for custom error page or not.
+        (markt)
+      </fix>
     </changelog>
   </subsection>
   <subsection name="Coyote">
Index: tc8.5.x/trunk
===================================================================
--- tc8.5.x/trunk	(revision 1793468)
+++ tc8.5.x/trunk	(revision 1793469)

Property changes on: tc8.5.x/trunk
___________________________________________________________________
Modified: svn:mergeinfo
## -0,0 +0,1 ##
   Merged /tomcat/trunk:r1793468
