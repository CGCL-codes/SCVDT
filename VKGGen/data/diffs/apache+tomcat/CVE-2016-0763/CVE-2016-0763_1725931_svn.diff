Index: tc7.0.x/trunk/java/org/apache/naming/factory/ResourceLinkFactory.java
===================================================================
--- tc7.0.x/trunk/java/org/apache/naming/factory/ResourceLinkFactory.java	(revision 1725930)
+++ tc7.0.x/trunk/java/org/apache/naming/factory/ResourceLinkFactory.java	(revision 1725931)
@@ -60,6 +60,11 @@
      * @param newGlobalContext new global context value
      */
     public static void setGlobalContext(Context newGlobalContext) {
+        SecurityManager sm = System.getSecurityManager();
+        if (sm != null) {
+            sm.checkPermission(new RuntimePermission(
+                   ResourceLinkFactory.class.getName() + ".setGlobalContext"));
+        }
         globalContext = newGlobalContext;
     }
 
Index: tc7.0.x/trunk/webapps/docs/changelog.xml
===================================================================
--- tc7.0.x/trunk/webapps/docs/changelog.xml	(revision 1725930)
+++ tc7.0.x/trunk/webapps/docs/changelog.xml	(revision 1725931)
@@ -149,6 +149,10 @@
         <bug>58900</bug>: Correctly undeploy symlinked resources and prevent an
         infinite cycle of deploy / undeploy. (markt)
       </fix>
+      <fix>
+        Protect initialization of <code>ResourceLinkFactory</code> when
+        running with a SecurityManager. (kkolinko)
+      </fix>
     </changelog>
   </subsection>
   <subsection name="Jasper">
Index: tc7.0.x/trunk
===================================================================
--- tc7.0.x/trunk	(revision 1725930)
+++ tc7.0.x/trunk	(revision 1725931)

Property changes on: tc7.0.x/trunk
___________________________________________________________________
Modified: svn:mergeinfo
## -0,0 +0,2 ##
   Merged /tomcat/tc8.0.x/trunk:r1725929
   Merged /tomcat/trunk:r1725926
