Index: tc8.0.x/trunk/java/org/apache/catalina/realm/DataSourceRealm.java
===================================================================
--- tc8.0.x/trunk/java/org/apache/catalina/realm/DataSourceRealm.java	(revision 1758500)
+++ tc8.0.x/trunk/java/org/apache/catalina/realm/DataSourceRealm.java	(revision 1758501)
@@ -303,6 +303,8 @@
 
         if(dbCredentials == null) {
             // User was not found in the database.
+            // Waste a bit of time as not to reveal that the user does not exist.
+            getCredentialHandler().mutate(credentials);
 
             if (containerLog.isTraceEnabled())
                 containerLog.trace(sm.getString("dataSourceRealm.authenticateFailure",
Index: tc8.0.x/trunk/java/org/apache/catalina/realm/JDBCRealm.java
===================================================================
--- tc8.0.x/trunk/java/org/apache/catalina/realm/JDBCRealm.java	(revision 1758500)
+++ tc8.0.x/trunk/java/org/apache/catalina/realm/JDBCRealm.java	(revision 1758501)
@@ -384,6 +384,8 @@
 
         if (dbCredentials == null) {
             // User was not found in the database.
+            // Waste a bit of time as not to reveal that the user does not exist.
+            getCredentialHandler().mutate(credentials);
 
             if (containerLog.isTraceEnabled())
                 containerLog.trace(sm.getString("jdbcRealm.authenticateFailure",
Index: tc8.0.x/trunk/java/org/apache/catalina/realm/MemoryRealm.java
===================================================================
--- tc8.0.x/trunk/java/org/apache/catalina/realm/MemoryRealm.java	(revision 1758500)
+++ tc8.0.x/trunk/java/org/apache/catalina/realm/MemoryRealm.java	(revision 1758501)
@@ -125,7 +125,9 @@
         GenericPrincipal principal = principals.get(username);
 
         if(principal == null || principal.getPassword() == null) {
-            // User was not found in the database of the password was null
+            // User was not found in the database or the password was null
+            // Waste a bit of time as not to reveal that the user does not exist.
+            getCredentialHandler().mutate(credentials);
 
             if (log.isDebugEnabled())
                 log.debug(sm.getString("memoryRealm.authenticateFailure", username));
Index: tc8.0.x/trunk/java/org/apache/catalina/realm/RealmBase.java
===================================================================
--- tc8.0.x/trunk/java/org/apache/catalina/realm/RealmBase.java	(revision 1758500)
+++ tc8.0.x/trunk/java/org/apache/catalina/realm/RealmBase.java	(revision 1758501)
@@ -488,6 +488,8 @@
 
         if (serverCredentials == null) {
             // User was not found
+            // Waste a bit of time as not to reveal that the user does not exist.
+            getCredentialHandler().mutate(credentials);
 
             if (containerLog.isTraceEnabled()) {
                 containerLog.trace(sm.getString("realmBase.authenticateFailure",
Index: tc8.0.x/trunk/webapps/docs/changelog.xml
===================================================================
--- tc8.0.x/trunk/webapps/docs/changelog.xml	(revision 1758500)
+++ tc8.0.x/trunk/webapps/docs/changelog.xml	(revision 1758501)
@@ -200,6 +200,9 @@
         of the web.xml file where specified or UTF-8 where no explicit encoding
         is specified. (markt)
       </fix>
+      <fix>
+        Make timing attacks against the Realm implementations harder. (schultz)
+      </fix>
     </changelog>
   </subsection>
   <subsection name="Coyote">
Index: tc8.0.x/trunk
===================================================================
--- tc8.0.x/trunk	(revision 1758500)
+++ tc8.0.x/trunk	(revision 1758501)

Property changes on: tc8.0.x/trunk
___________________________________________________________________
Modified: svn:mergeinfo
## -0,0 +0,1 ##
   Merged /tomcat/trunk:r1758499
