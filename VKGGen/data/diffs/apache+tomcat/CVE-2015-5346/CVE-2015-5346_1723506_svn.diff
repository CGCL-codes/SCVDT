Index: tc8.0.x/trunk/java/org/apache/catalina/connector/CoyoteAdapter.java
===================================================================
--- tc8.0.x/trunk/java/org/apache/catalina/connector/CoyoteAdapter.java	(revision 1723505)
+++ tc8.0.x/trunk/java/org/apache/catalina/connector/CoyoteAdapter.java	(revision 1723506)
@@ -951,8 +951,8 @@
                                 // Recycle cookies and session info in case the
                                 // correct context is configured with different
                                 // settings
-                                req.getCookies().recycle();
                                 request.recycleSessionInfo();
+                                request.recycleCookieInfo(true);
                             }
                             break;
                         }
Index: tc8.0.x/trunk/java/org/apache/catalina/connector/Request.java
===================================================================
--- tc8.0.x/trunk/java/org/apache/catalina/connector/Request.java	(revision 1723505)
+++ tc8.0.x/trunk/java/org/apache/catalina/connector/Request.java	(revision 1723506)
@@ -477,8 +477,6 @@
             parts = null;
         }
         partsParseException = null;
-        cookiesParsed = false;
-        cookiesConverted = false;
         locales.clear();
         localesParsed = false;
         secure = false;
@@ -492,9 +490,9 @@
         attributes.clear();
         sslAttributesParsed = false;
         notes.clear();
-        cookies = null;
 
         recycleSessionInfo();
+        recycleCookieInfo(false);
 
         if (Globals.IS_SECURITY_ENABLED || Connector.RECYCLE_FACADES) {
             parameterMap = new ParameterMap<>();
@@ -554,6 +552,16 @@
     }
 
 
+    protected void recycleCookieInfo(boolean recycleCoyote) {
+        cookiesParsed = false;
+        cookiesConverted = false;
+        cookies = null;
+        if (recycleCoyote) {
+            getCoyoteRequest().getCookies().recycle();
+        }
+    }
+
+
     public boolean read() throws IOException {
         return (inputBuffer.realReadBytes(null, 0, 0) > 0);
     }
Index: tc8.0.x/trunk/webapps/docs/changelog.xml
===================================================================
--- tc8.0.x/trunk/webapps/docs/changelog.xml	(revision 1723505)
+++ tc8.0.x/trunk/webapps/docs/changelog.xml	(revision 1723506)
@@ -114,6 +114,10 @@
         Fix declaration of <code>localPort</code> attribute of Connector MBean:
         it is read-only. (kkolinko)
       </fix>
+      <fix>
+        <bug>58809/bug>: Correctly recycle cookies when mapping requests for
+        parallel deployment. (markt)
+      </fix>
     </changelog>
   </subsection>
   <subsection name="Jasper">
Index: tc8.0.x/trunk
===================================================================
--- tc8.0.x/trunk	(revision 1723505)
+++ tc8.0.x/trunk	(revision 1723506)

Property changes on: tc8.0.x/trunk
___________________________________________________________________
Modified: svn:mergeinfo
## -0,0 +0,1 ##
   Merged /tomcat/trunk:r1723414
