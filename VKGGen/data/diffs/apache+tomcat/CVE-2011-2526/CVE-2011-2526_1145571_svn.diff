Index: trunk/java/org/apache/tomcat/util/net/NioEndpoint.java
===================================================================
--- trunk/java/org/apache/tomcat/util/net/NioEndpoint.java	(revision 1145570)
+++ trunk/java/org/apache/tomcat/util/net/NioEndpoint.java	(revision 1145571)
@@ -1271,6 +1271,7 @@
                             log.debug("Send file connection is being closed");
                         }
                         cancelledKey(sk,SocketStatus.STOP,false);
+                        return false;
                     }
                 } else if ( attachment.interestOps() == 0 && reg ) {
                     if (log.isDebugEnabled()) {
Index: trunk/webapps/docs/changelog.xml
===================================================================
--- trunk/webapps/docs/changelog.xml	(revision 1145570)
+++ trunk/webapps/docs/changelog.xml	(revision 1145571)
@@ -124,6 +124,10 @@
         Protect against infinite loops in the HTTP NIO connector if sendfile is
         configured to send more data than is available in the file. (markt)
       </fix>
+      <fix>
+        Prevent NPEs when a socket is closed in non-error conditions after
+        sendfile processing when using the HTTP NIO connector. (markt) 
+      </fix>
     </changelog>
   </subsection>
   <subsection name="Cluster">
