Index: tc8.5.x/trunk/java/org/apache/coyote/http2/Http2UpgradeHandler.java
===================================================================
--- tc8.5.x/trunk/java/org/apache/coyote/http2/Http2UpgradeHandler.java	(revision 1788479)
+++ tc8.5.x/trunk/java/org/apache/coyote/http2/Http2UpgradeHandler.java	(revision 1788480)
@@ -983,6 +983,11 @@
 
     private void close() {
         connectionState.set(ConnectionState.CLOSED);
+        for (Stream stream : streams.values()) {
+            // The connection is closing. Close the associated streams as no
+            // longer required.
+            stream.receiveReset(Http2Error.CANCEL.getCode());
+        }
         try {
             socketWrapper.close();
         } catch (IOException ioe) {
Index: tc8.5.x/trunk
===================================================================
--- tc8.5.x/trunk	(revision 1788479)
+++ tc8.5.x/trunk	(revision 1788480)

Property changes on: tc8.5.x/trunk
___________________________________________________________________
Modified: svn:mergeinfo
## -0,0 +0,1 ##
   Merged /tomcat/trunk:r1788460
