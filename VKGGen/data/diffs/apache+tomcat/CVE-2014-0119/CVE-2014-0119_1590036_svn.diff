Index: tc7.0.x/trunk/java/org/apache/catalina/startup/TldConfig.java
===================================================================
--- tc7.0.x/trunk/java/org/apache/catalina/startup/TldConfig.java	(revision 1590035)
+++ tc7.0.x/trunk/java/org/apache/catalina/startup/TldConfig.java	(revision 1590036)
@@ -79,7 +79,7 @@
     /**
      * The <code>Digester</code>s available to process tld files.
      */
-    private static Digester[] tldDigesters = new Digester[2];
+    private static Digester[] tldDigesters = new Digester[4];
 
     /**
      * Create (if necessary) and return a Digester configured to process the
@@ -89,7 +89,7 @@
             boolean blockExternal) {
         
         Digester digester = null;
-        if (!validation) {
+        if (!validation && !blockExternal) {
             if (tldDigesters[0] == null) {
                 tldDigesters[0] = DigesterFactory.newDigester(validation,
                         true, new TldRuleSet(), blockExternal);
@@ -96,7 +96,7 @@
                 tldDigesters[0].getParser();
             }
             digester = tldDigesters[0];
-        } else {
+        } else if (!validation && blockExternal) {
             if (tldDigesters[1] == null) {
                 tldDigesters[1] = DigesterFactory.newDigester(validation,
                         true, new TldRuleSet(), blockExternal);
@@ -103,6 +103,20 @@
                 tldDigesters[1].getParser();
             }
             digester = tldDigesters[1];
+        } else if (validation && !blockExternal) {
+            if (tldDigesters[2] == null) {
+                tldDigesters[2] = DigesterFactory.newDigester(validation,
+                        true, new TldRuleSet(), blockExternal);
+                tldDigesters[2].getParser();
+            }
+            digester = tldDigesters[2];
+        } else {
+            if (tldDigesters[3] == null) {
+                tldDigesters[3] = DigesterFactory.newDigester(validation,
+                        true, new TldRuleSet(), blockExternal);
+                tldDigesters[3].getParser();
+            }
+            digester = tldDigesters[3];
         }
         return digester;
     }
Index: tc7.0.x/trunk/webapps/docs/changelog.xml
===================================================================
--- tc7.0.x/trunk/webapps/docs/changelog.xml	(revision 1590035)
+++ tc7.0.x/trunk/webapps/docs/changelog.xml	(revision 1590036)
@@ -121,6 +121,10 @@
         additional locations where, theoretically, a memory leak could occur.
         (markt)
       </add>
+      <fix>
+        Ensure that a TLD parser obtained from the cache has the correct value
+        of <code>blockExternal</code>. (markt)
+      </fix>
     </changelog>
   </subsection>
   <subsection name="Coyote">
