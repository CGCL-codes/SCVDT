Index: tc7.0.x/trunk/java/org/apache/catalina/core/DefaultInstanceManager.java
===================================================================
--- tc7.0.x/trunk/java/org/apache/catalina/core/DefaultInstanceManager.java	(revision 1176587)
+++ tc7.0.x/trunk/java/org/apache/catalina/core/DefaultInstanceManager.java	(revision 1176588)
@@ -530,6 +530,10 @@
         if (Filter.class.isAssignableFrom(clazz)) {
             checkAccess(clazz, restrictedFilters);
         } else if (Servlet.class.isAssignableFrom(clazz)) {
+            if (ContainerServlet.class.isAssignableFrom(clazz)) {
+                throw new SecurityException("Restricted (ContainerServlet) " +
+                        clazz);
+            }
             checkAccess(clazz, restrictedServlets);
         } else {
             checkAccess(clazz, restrictedListeners);
Index: tc7.0.x/trunk/webapps/docs/changelog.xml
===================================================================
--- tc7.0.x/trunk/webapps/docs/changelog.xml	(revision 1176587)
+++ tc7.0.x/trunk/webapps/docs/changelog.xml	(revision 1176588)
@@ -129,6 +129,10 @@
       <update>
         Add thread name to juli OneLineFormatter. (rjung)
       </update>
+      <fix>
+        Ensure Servlets that implement ContainerServlet always get treated as
+        restricted. (markt)
+      </fix>
     </changelog>
   </subsection>
   <subsection name="Coyote">
Index: tc7.0.x/trunk
===================================================================
--- tc7.0.x/trunk	(revision 1176587)
+++ tc7.0.x/trunk	(revision 1176588)

Property changes on: tc7.0.x/trunk
___________________________________________________________________
Modified: svn:mergeinfo
## -0,0 +0,1 ##
   Merged /tomcat/trunk:r1176584
