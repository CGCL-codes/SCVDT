Index: tc6.0.x/trunk/java/org/apache/catalina/core/StandardContext.java
===================================================================
--- tc6.0.x/trunk/java/org/apache/catalina/core/StandardContext.java	(revision 1022559)
+++ tc6.0.x/trunk/java/org/apache/catalina/core/StandardContext.java	(revision 1022560)
@@ -5339,11 +5339,11 @@
         dir.mkdirs();
 
         // Set the appropriate servlet context attribute
-        getServletContext().setAttribute(Globals.WORK_DIR_ATTR, dir);
-        if (getServletContext() instanceof ApplicationContext)
-            ((ApplicationContext) getServletContext()).setAttributeReadOnly
-                (Globals.WORK_DIR_ATTR);
-
+        if (context == null) {
+            getServletContext();
+        }
+        context.setAttribute(Globals.WORK_DIR_ATTR, dir);
+        context.setAttributeReadOnly(Globals.WORK_DIR_ATTR);
     }
 
 
Index: tc6.0.x/trunk/webapps/docs/changelog.xml
===================================================================
--- tc6.0.x/trunk/webapps/docs/changelog.xml	(revision 1022559)
+++ tc6.0.x/trunk/webapps/docs/changelog.xml	(revision 1022560)
@@ -121,6 +121,9 @@
         <bug>49987</bug>: Fix potential data race in the population of the
         Servlet Context initialisation parameters. (markt)
       </fix>
+      <fix>
+        Code clean-up. Avoid some casts in StandardContext. (markt)
+      </fix>
     </changelog>
   </subsection>
   <subsection name="Coyote">
Index: tc6.0.x/trunk/STATUS.txt
===================================================================
--- tc6.0.x/trunk/STATUS.txt	(revision 1022559)
+++ tc6.0.x/trunk/STATUS.txt	(revision 1022560)
@@ -251,11 +251,6 @@
      - Do not remove "// Make sure no session ID is returned" comment.
      - Documentation update will be needed.
 
-* Avoid unnecessary cast
-  http://svn.apache.org/viewvc?rev=1022134&view=rev
-  +1: markt, kkolinko, rjung, timw
-  -1:
-
 * Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=49428
   Add a work-around for the known namespace issues for some Microsoft WebDAV
   clients. Based on the patch provided by Panagiotis Astithas.
Index: tc6.0.x/trunk
===================================================================
--- tc6.0.x/trunk	(revision 1022559)
+++ tc6.0.x/trunk	(revision 1022560)

Property changes on: tc6.0.x/trunk
___________________________________________________________________
Modified: svn:mergeinfo
## -0,0 +0,1 ##
   Merged /tomcat/trunk:r1022134
