Index: tc5.5.x/trunk/STATUS.txt
===================================================================
--- tc5.5.x/trunk/STATUS.txt	(revision 1027609)
+++ tc5.5.x/trunk/STATUS.txt	(revision 1027610)
@@ -76,11 +76,6 @@
   +1: markt, kkolinko, timw
   -1:
 
-* Avoid unnecessary cast
-  http://svn.apache.org/viewvc?rev=1022134&view=rev
-  +1: markt, kkolinko, rjung, timw
-  -1:
-
 * Improve sending an access message in DeltaManager.
   maxInactiveInterval of not Manager but the session is used. 
   If maxInactiveInterval is negative, an access message is not sending. 
Index: tc5.5.x/trunk/container/webapps/docs/changelog.xml
===================================================================
--- tc5.5.x/trunk/container/webapps/docs/changelog.xml	(revision 1027609)
+++ tc5.5.x/trunk/container/webapps/docs/changelog.xml	(revision 1027610)
@@ -47,6 +47,13 @@
       </fix>
     </changelog>
   </subsection>
+  <subsection name="Catalina">
+    <changelog>
+      <fix>
+        Avoid unnecessary cast in StandardContext. (markt)
+      </fix>
+    </changelog>
+  </subsection>
 </section>
 <section name="Tomcat 5.5.31 (jim)" rtext="released 2010-09-16">
   <subsection name="General">
Index: tc5.5.x/trunk/container/catalina/src/share/org/apache/catalina/core/StandardContext.java
===================================================================
--- tc5.5.x/trunk/container/catalina/src/share/org/apache/catalina/core/StandardContext.java	(revision 1027609)
+++ tc5.5.x/trunk/container/catalina/src/share/org/apache/catalina/core/StandardContext.java	(revision 1027610)
@@ -4805,11 +4805,11 @@
         dir.mkdirs();
 
         // Set the appropriate servlet context attribute
-        getServletContext().setAttribute(Globals.WORK_DIR_ATTR, dir);
-        if (getServletContext() instanceof ApplicationContext)
-            ((ApplicationContext) getServletContext()).setAttributeReadOnly
-                (Globals.WORK_DIR_ATTR);
-
+        if (context == null) {
+            getServletContext();
+        }
+        context.setAttribute(Globals.WORK_DIR_ATTR, dir);
+        context.setAttributeReadOnly(Globals.WORK_DIR_ATTR);
     }
 
 
