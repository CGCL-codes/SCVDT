Index: tc8.0.x/trunk/java/org/apache/naming/factory/ResourceLinkFactory.java
===================================================================
--- tc8.0.x/trunk/java/org/apache/naming/factory/ResourceLinkFactory.java	(revision 1763233)
+++ tc8.0.x/trunk/java/org/apache/naming/factory/ResourceLinkFactory.java	(revision 1763234)
@@ -109,9 +109,12 @@
 
     private static boolean validateGlobalResourceAccess(String globalName) {
         ClassLoader cl = Thread.currentThread().getContextClassLoader();
-        Map<String,String> registrations = globalResourceRegistrations.get(cl);
-        if (registrations != null && registrations.containsValue(globalName)) {
-            return true;
+        while (cl != null) {
+            Map<String,String> registrations = globalResourceRegistrations.get(cl);
+            if (registrations != null && registrations.containsValue(globalName)) {
+                return true;
+            }
+            cl = cl.getParent();
         }
         return false;
     }
Index: tc8.0.x/trunk/webapps/docs/changelog.xml
===================================================================
--- tc8.0.x/trunk/webapps/docs/changelog.xml	(revision 1763233)
+++ tc8.0.x/trunk/webapps/docs/changelog.xml	(revision 1763234)
@@ -96,6 +96,11 @@
         When starting web resources, ensure that class resources are only
         started once. (markt)
       </fix>
+      <fix>
+        Improve the access checks for linked global resources to handle the case
+        where the current class loader is a child of the web application class
+        loader. (markt)
+      </fix>
     </changelog>
   </subsection>
   <subsection name="Coyote">
Index: tc8.0.x/trunk
===================================================================
--- tc8.0.x/trunk	(revision 1763233)
+++ tc8.0.x/trunk	(revision 1763234)

Property changes on: tc8.0.x/trunk
___________________________________________________________________
Modified: svn:mergeinfo
## -0,0 +0,1 ##
   Merged /tomcat/trunk:r1763232
