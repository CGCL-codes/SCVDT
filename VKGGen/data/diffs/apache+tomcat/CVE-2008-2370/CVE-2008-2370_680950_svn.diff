Index: container/branches/tc4.1.x/catalina/src/share/org/apache/catalina/core/ApplicationContext.java
===================================================================
--- container/branches/tc4.1.x/catalina/src/share/org/apache/catalina/core/ApplicationContext.java	(revision 680949)
+++ container/branches/tc4.1.x/catalina/src/share/org/apache/catalina/core/ApplicationContext.java	(revision 680950)
@@ -581,6 +581,15 @@
         if (!path.startsWith("/"))
             throw new IllegalArgumentException
               (sm.getString("applicationContext.requestDispatcher.iae", path));
+
+        // Get query string
+        String queryString = null;
+        int question = path.indexOf('?');
+        if (question >= 0) {
+            queryString = path.substring(question + 1);
+            path = path.substring(0, question);
+        }
+
         path = normalize(path);
         if (path == null)
             return (null);
@@ -589,17 +598,10 @@
         String contextPath = context.getPath();
         if (contextPath == null)
             contextPath = "";
-        String relativeURI = path;
-        String queryString = null;
-        int question = path.indexOf('?');
-        if (question >= 0) {
-            relativeURI = path.substring(0, question);
-            queryString = path.substring(question + 1);
-        }
         if( System.getSecurityManager() != null ) {
             PrivilegedGetRequestDispatcher dp =
                 new PrivilegedGetRequestDispatcher(contextPath,
-                        relativeURI,queryString);
+                        path,queryString);
             return (RequestDispatcher)AccessController.doPrivileged(dp);
         }
 
@@ -606,7 +608,7 @@
         // The remaining code is duplicated in PrivilegedGetRequestDispatcher,
         // we need to make sure they stay in sync
         HttpRequest request = new MappingRequest
-            (context.getPath(), contextPath + relativeURI, queryString);
+            (context.getPath(), contextPath + path, queryString);
         /*
         request.setContext(context);
         request.setContextPath(context.getPath());
