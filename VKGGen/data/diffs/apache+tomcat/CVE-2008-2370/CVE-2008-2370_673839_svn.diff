Index: tc6.0.x/trunk/java/org/apache/catalina/core/ApplicationContext.java
===================================================================
--- tc6.0.x/trunk/java/org/apache/catalina/core/ApplicationContext.java	(revision 673838)
+++ tc6.0.x/trunk/java/org/apache/catalina/core/ApplicationContext.java	(revision 673839)
@@ -369,10 +369,21 @@
             throw new IllegalArgumentException
                 (sm.getString
                  ("applicationContext.requestDispatcher.iae", path));
+
+        // Get query string
+        String queryString = null;
+        int pos = path.indexOf('?');
+        if (pos >= 0) {
+            queryString = path.substring(pos + 1);
+            path = path.substring(0, pos);
+        }
+
         path = normalize(path);
         if (path == null)
             return (null);
 
+        pos = path.length(); 
+
         // Use the thread local URI and mapping data
         DispatchData dd = dispatchData.get();
         if (dd == null) {
@@ -383,15 +394,6 @@
         MessageBytes uriMB = dd.uriMB;
         uriMB.recycle();
 
-        // Get query string
-        String queryString = null;
-        int pos = path.indexOf('?');
-        if (pos >= 0) {
-            queryString = path.substring(pos + 1);
-        } else {
-            pos = path.length();
-        }
- 
         // Use the thread local mapping data
         MappingData mappingData = dd.mappingData;
 
Index: tc6.0.x/trunk
===================================================================
--- tc6.0.x/trunk	(revision 673838)
+++ tc6.0.x/trunk	(revision 673839)

Property changes on: tc6.0.x/trunk
___________________________________________________________________
Modified: svn:mergeinfo
## -0,0 +0,1 ##
   Merged /tomcat/trunk:r673820
