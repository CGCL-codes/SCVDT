Index: trunk/java/org/apache/tomcat/util/net/Nio2Endpoint.java
===================================================================
--- trunk/java/org/apache/tomcat/util/net/Nio2Endpoint.java	(revision 1833905)
+++ trunk/java/org/apache/tomcat/util/net/Nio2Endpoint.java	(revision 1833906)
@@ -410,7 +410,7 @@
         private final Semaphore writePending = new Semaphore(1);
         private boolean writeInterest = false; // Guarded by writeCompletionHandler
         private boolean writeNotify = false;
-        private boolean closed = false;
+        private volatile boolean closed = false;
 
         private CompletionHandler<Integer, SocketWrapperBase<Nio2Channel>> awaitBytesHandler
                 = new CompletionHandler<Integer, SocketWrapperBase<Nio2Channel>>() {
@@ -842,7 +842,7 @@
 
         @Override
         public boolean isClosed() {
-            return !getSocket().isOpen();
+            return closed || !getSocket().isOpen();
         }
 
 
Index: trunk/java/org/apache/tomcat/util/net/NioEndpoint.java
===================================================================
--- trunk/java/org/apache/tomcat/util/net/NioEndpoint.java	(revision 1833905)
+++ trunk/java/org/apache/tomcat/util/net/NioEndpoint.java	(revision 1833906)
@@ -501,6 +501,7 @@
                         // since it won't have been counted down when the socket
                         // closed.
                         socket.socketWrapper.getEndpoint().countDownConnection();
+                        ((NioSocketWrapper) socket.socketWrapper).closed = true;
                     } else {
                         final NioSocketWrapper socketWrapper = (NioSocketWrapper) key.attachment();
                         if (socketWrapper != null) {
@@ -682,6 +683,7 @@
                 }
                 if (ka != null) {
                     countDownConnection();
+                    ka.closed = true;
                 }
             } catch (Throwable e) {
                 ExceptionUtils.handleThrowable(e);
@@ -997,6 +999,7 @@
         private volatile SendfileData sendfileData = null;
         private volatile long lastRead = System.currentTimeMillis();
         private volatile long lastWrite = lastRead;
+        private volatile boolean closed = false;
 
         public NioSocketWrapper(NioChannel channel, NioEndpoint endpoint) {
             super(channel, endpoint);
@@ -1138,7 +1141,7 @@
 
         @Override
         public boolean isClosed() {
-            return !getSocket().isOpen();
+            return closed || !getSocket().isOpen();
         }
 
 
