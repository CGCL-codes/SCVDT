Index: trunk/java/org/apache/coyote/AbstractProcessor.java
===================================================================
--- trunk/java/org/apache/coyote/AbstractProcessor.java	(revision 1837529)
+++ trunk/java/org/apache/coyote/AbstractProcessor.java	(revision 1837530)
@@ -51,6 +51,15 @@
     protected final Adapter adapter;
     protected final AsyncStateMachine asyncStateMachine;
     private volatile long asyncTimeout = -1;
+    /*
+     * Tracks the current async generation when a timeout is dispatched. In the
+     * time it takes for a container thread to be allocated and the timeout
+     * processing to start, it is possible that the application completes this
+     * generation of async processing and starts a new one. If the timeout is
+     * then processed against the new generation, response mix-up can occur.
+     * This field is used to ensure that any timeout event processed is for the
+     * current async generation. This prevents the response mix-up.
+     */
     private volatile long asyncTimeoutGeneration = 0;
     protected final Request request;
     protected final Response response;
Index: trunk/java/org/apache/coyote/AsyncStateMachine.java
===================================================================
--- trunk/java/org/apache/coyote/AsyncStateMachine.java	(revision 1837529)
+++ trunk/java/org/apache/coyote/AsyncStateMachine.java	(revision 1837530)
@@ -190,6 +190,14 @@
 
     private volatile AsyncState state = AsyncState.DISPATCHED;
     private volatile long lastAsyncStart = 0;
+    /*
+     * Tracks the current generation of async processing for this state machine.
+     * The generation is incremented every time async processing is started. The
+     * primary purpose of this is to enable Tomcat to detect and prevent
+     * attempts to process an event for a previous generation with the current
+     * generation as processing such an event usually ends badly:
+     * e.g. CVE-2018-8037.
+     */
     private final AtomicLong generation = new AtomicLong(0);
     // Need this to fire listener on complete
     private AsyncContextCallback asyncCtxt = null;
