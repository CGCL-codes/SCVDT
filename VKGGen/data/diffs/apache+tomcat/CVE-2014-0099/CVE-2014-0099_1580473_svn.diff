Index: tc6.0.x/trunk/STATUS.txt
===================================================================
--- tc6.0.x/trunk/STATUS.txt	(revision 1580472)
+++ tc6.0.x/trunk/STATUS.txt	(revision 1580473)
@@ -49,11 +49,6 @@
       remm: no need to add i18n for something that will not happen
   -1:
 
-* Fix possible overflow when parsing long values from a byte array.
-  http://people.apache.org/~markt/patches/2014-03-18-ascii-tc6.patch
-  +1: markt, kkolinko, schultz, remm
-  -1:
-
 * Fix http://issues.apache.org/bugzilla/show_bug.cgi?id=56283
   Add Java 8 support to Jasper's default configuration
   http://people.apache.org/~markt/patches/2014-03-19-Jasper-Java8-tc6-v1.patch
Index: tc6.0.x/trunk/java/org/apache/tomcat/util/buf/Ascii.java
===================================================================
--- tc6.0.x/trunk/java/org/apache/tomcat/util/buf/Ascii.java	(revision 1580472)
+++ tc6.0.x/trunk/java/org/apache/tomcat/util/buf/Ascii.java	(revision 1580473)
@@ -41,10 +41,11 @@
     private static final boolean[] isWhite = new boolean[256];
     private static final boolean[] isDigit = new boolean[256];
 
+    private static final long OVERFLOW_LIMIT = Long.MAX_VALUE / 10;
+
     /*
      * Initialize character translation and type tables.
      */
-
     static {
         for (int i = 0; i < 256; i++) {
             toUpper[i] = (byte)i;
@@ -196,20 +197,13 @@
         }
 
         long n = c - '0';
-        long m;
-        
         while (--len > 0) {
-            if (!isDigit(c = b[off++])) {
+            if (isDigit(c = b[off++]) &&
+                    (n < OVERFLOW_LIMIT || (n == OVERFLOW_LIMIT && (c - '0') < 8))) {
+                n = n * 10 + c - '0';
+            } else {
                 throw new NumberFormatException();
             }
-            m = n * 10 + c - '0';
-
-            if (m < n) {
-                // Overflow
-                throw new NumberFormatException();
-            } else {
-                n = m;
-            }
         }
 
         return n;
Index: tc6.0.x/trunk/webapps/docs/changelog.xml
===================================================================
--- tc6.0.x/trunk/webapps/docs/changelog.xml	(revision 1580472)
+++ tc6.0.x/trunk/webapps/docs/changelog.xml	(revision 1580473)
@@ -75,6 +75,10 @@
         and use a bit shift instead of a multiplication as it is marginally
         faster. (markt/kkolinko)
       </fix>
+      <fix>
+        Fix possible overflow when parsing long values from a byte array.
+        (markt)
+      </fix>
     </changelog>
   </subsection>
   <subsection name="Jasper">
Index: tc6.0.x/trunk
===================================================================
--- tc6.0.x/trunk	(revision 1580472)
+++ tc6.0.x/trunk	(revision 1580473)

Property changes on: tc6.0.x/trunk
___________________________________________________________________
Modified: svn:mergeinfo
## -0,0 +0,2 ##
   Merged /tomcat/tc7.0.x/trunk:r1578814
   Merged /tomcat/trunk:r1578812-1578813
