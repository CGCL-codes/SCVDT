Index: tc8.5.x/trunk/java/org/apache/catalina/servlets/DefaultServlet.java
===================================================================
--- tc8.5.x/trunk/java/org/apache/catalina/servlets/DefaultServlet.java	(revision 1840055)
+++ tc8.5.x/trunk/java/org/apache/catalina/servlets/DefaultServlet.java	(revision 1840056)
@@ -1154,6 +1154,10 @@
             location.append('?');
             location.append(request.getQueryString());
         }
+        // Avoid protocol relative redirects
+        while (location.length() > 1 && location.charAt(1) == '/') {
+            location.deleteCharAt(0);
+        }
         response.sendRedirect(response.encodeRedirectURL(location.toString()));
     }
 
Index: tc8.5.x/trunk/webapps/docs/changelog.xml
===================================================================
--- tc8.5.x/trunk/webapps/docs/changelog.xml	(revision 1840055)
+++ tc8.5.x/trunk/webapps/docs/changelog.xml	(revision 1840056)
@@ -76,6 +76,10 @@
       <fix>
         <bug>62667</bug>: Add recursion to rewrite substitution parsing. (remm)
       </fix>
+      <fix>
+        When generating a redirect to a directory in the Default Servlet, avoid
+        generating a protocol relative redirect. (markt)
+      </fix>
     </changelog>
   </subsection>
   <subsection name="Coyote">
Index: tc8.5.x/trunk
===================================================================
--- tc8.5.x/trunk	(revision 1840055)
+++ tc8.5.x/trunk	(revision 1840056)

Property changes on: tc8.5.x/trunk
___________________________________________________________________
Modified: svn:mergeinfo
## -0,0 +0,1 ##
   Merged /tomcat/trunk:r1840055
