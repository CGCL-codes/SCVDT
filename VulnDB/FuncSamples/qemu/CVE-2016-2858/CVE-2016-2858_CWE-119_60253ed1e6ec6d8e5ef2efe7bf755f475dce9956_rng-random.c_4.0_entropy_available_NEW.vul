static void entropy_available(void *opaque)
{
    RndRandom *s = RNG_RANDOM(opaque);

    while (s->parent.requests != NULL) {
        RngRequest *req = s->parent.requests->data;
        ssize_t len;

        len = read(s->fd, req->data, req->size);
        if (len < 0 && errno == EAGAIN) {
            return;
        }
        g_assert(len != -1);

        req->receive_entropy(req->opaque, req->data, len);

        rng_backend_finalize_request(&s->parent, req);
    }

    /* We've drained all requests, the fd handler can be reset. */
    qemu_set_fd_handler(s->fd, NULL, NULL, NULL);
}
