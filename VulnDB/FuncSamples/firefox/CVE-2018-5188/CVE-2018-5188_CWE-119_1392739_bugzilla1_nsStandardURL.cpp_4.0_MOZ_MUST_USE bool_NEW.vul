inline
MOZ_MUST_USE bool
FromIPCSegment(const nsACString& aSpec, const ipc::StandardURLSegment& aSegment, nsStandardURL::URLSegment& aTarget)
{
    // This seems to be just an empty segment.
    if (aSegment.length() == -1) {
        aTarget = nsStandardURL::URLSegment();
        return true;
    }

    // A value of -1 means an empty segment, but < -1 is undefined.
    if (NS_WARN_IF(aSegment.length() < -1)) {
        return false;
    }

    CheckedInt<uint32_t> segmentLen = aSegment.position();
    segmentLen += aSegment.length();
    // Make sure the segment does not extend beyond the spec.
    if (NS_WARN_IF(!segmentLen.isValid() || segmentLen.value() > aSpec.Length())) {
        return false;
    }

    aTarget.mPos = aSegment.position();
    aTarget.mLen = aSegment.length();

    return true;
}
