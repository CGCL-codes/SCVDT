static void
EmitReadSlotGuard(CacheIRWriter& writer, JSObject* obj, JSObject* holder,
                  ObjOperandId objId, Maybe<ObjOperandId>* holderId)
{
    Maybe<ObjOperandId> expandoId;
    TestMatchingReceiver(writer, obj, objId, &expandoId);

    if (obj != holder) {
        if (holder) {
            // Guard proto chain integrity.
            GeneratePrototypeGuards(writer, obj, holder, objId);

            // Guard on the holder's shape.
            holderId->emplace(writer.loadObject(holder));
            TestMatchingHolder(writer, holder, holderId->ref());
        } else {
            // The property does not exist. Guard on everything in the prototype
            // chain. This is guaranteed to see only Native objects because of
            // CanAttachNativeGetProp().
            ShapeGuardProtoChain(writer, obj, objId);
        }
    } else if (obj->is<UnboxedPlainObject>()) {
        holderId->emplace(*expandoId);
    } else {
        holderId->emplace(objId);
    }
}
