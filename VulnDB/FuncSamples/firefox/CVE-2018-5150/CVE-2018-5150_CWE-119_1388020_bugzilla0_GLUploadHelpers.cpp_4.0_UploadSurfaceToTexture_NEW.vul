SurfaceFormat
UploadSurfaceToTexture(GLContext* gl,
                       DataSourceSurface* aSurface,
                       const nsIntRegion& aDstRegion,
                       GLuint aTexture,
                       const gfx::IntSize& aSize,
                       size_t* aOutUploadSize,
                       bool aNeedInit,
                       const gfx::IntPoint& aSrcPoint,
                       GLenum aTextureUnit,
                       GLenum aTextureTarget)
{
    DataSourceSurface::ScopedMap map(aSurface, DataSourceSurface::READ);
    int32_t stride = map.GetStride();
    SurfaceFormat format = aSurface->GetFormat();
    gfx::IntSize size = aSurface->GetSize();
    if (!CheckUploadBounds(aSize, size, aSrcPoint)) {
        return SurfaceFormat::UNKNOWN;
    }

    unsigned char* data = map.GetData() +
        DataOffset(aSrcPoint, stride, format);
    size.width -= aSrcPoint.x;
    size.height -= aSrcPoint.y;

    return UploadImageDataToTexture(gl, data, size, stride, format,
                                    aDstRegion, aTexture, aSize,
                                    aOutUploadSize, aNeedInit,
                                    aTextureUnit, aTextureTarget);
}
