static SECStatus
serial_read_int(msgpack_unpacker* upk, int* n)
{
  SECStatus rv = SECSuccess;

  msgpack_unpacked res;
  msgpack_unpacked_init(&res);

  P_CHECKCB(upk != NULL);
  P_CHECKCB(n != NULL);

  UP_CHECK(msgpack_unpacker_next(upk, &res))

  msgpack_object obj = res.data;
  P_CHECKCB(obj.type == MSGPACK_OBJECT_POSITIVE_INTEGER);

  *n = obj.via.i64;

cleanup:
  msgpack_unpacked_destroy(&res);

  return rv;
}
