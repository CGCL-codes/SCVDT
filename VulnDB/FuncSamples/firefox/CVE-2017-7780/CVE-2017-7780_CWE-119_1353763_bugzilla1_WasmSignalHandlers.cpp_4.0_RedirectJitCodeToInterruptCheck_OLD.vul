static bool
RedirectJitCodeToInterruptCheck(JSContext* cx, CONTEXT* context)
{
    // Jitcode may only be modified on the runtime's active thread.
    if (cx != cx->runtime()->activeContext())
        return false;

    RedirectIonBackedgesToInterruptCheck(cx);

    if (WasmActivation* activation = cx->wasmActivationStack()) {
#ifdef JS_SIMULATOR
        (void)ContextToPC(context);  // silence static 'unused' errors

        void* pc = cx->simulator()->get_pc_as<void*>();

        const Code* code = activation->compartment()->wasm.lookupCode(pc);
        if (code && code->segment().containsFunctionPC(pc))
            cx->simulator()->trigger_wasm_interrupt();
#else
        uint8_t** ppc = ContextToPC(context);
        uint8_t* pc = *ppc;
        uint8_t* fp = ContextToFP(context);

        const Code* code = activation->compartment()->wasm.lookupCode(pc);
        if (code && code->segment().containsFunctionPC(pc) && fp) {
            activation->startInterrupt(pc, fp);
            *ppc = code->segment().interruptCode();
            return true;
        }
#endif
    }

    return false;
}
