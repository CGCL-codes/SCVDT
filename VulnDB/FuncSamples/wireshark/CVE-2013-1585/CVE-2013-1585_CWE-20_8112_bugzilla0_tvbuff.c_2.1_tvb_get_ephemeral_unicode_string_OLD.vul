gchar *
tvb_get_ephemeral_unicode_string(tvbuff_t *tvb, const gint offset, gint length, const guint encoding)
{
	/* Longest UTF-8 character takes 6 bytes + 1 byte for NUL, round it to 8B */
	gchar          tmpbuf[8];
	gunichar2      uchar;
	gint           i;       /* Byte counter for tvbuff */
	gint           tmpbuf_len;
	emem_strbuf_t *strbuf = NULL;

	strbuf = ep_strbuf_new(NULL);

	for(i = 0; i < length; i += 2) {

		if (encoding == ENC_BIG_ENDIAN)
			uchar = tvb_get_ntohs(tvb, offset + i);
		else
			uchar = tvb_get_letohs(tvb, offset + i);

		tmpbuf_len = g_unichar_to_utf8(uchar, tmpbuf);

		/* NULL terminate the tmpbuf so ep_strbuf_append knows where
		 * to stop */
		tmpbuf[tmpbuf_len] = '\0';

		ep_strbuf_append(strbuf, tmpbuf);
	}

	return strbuf->str;
}
