void
add_tn3270_conversation(packet_info *pinfo, int tn3270e, gint model)
{
  conversation_t     *conversation;
  tn3270_conv_info_t *tn3270_info;

  conversation = find_or_create_conversation(pinfo);

  /*
   * Do we already have a type and mechanism?
   */
  tn3270_info = (tn3270_conv_info_t *)conversation_get_proto_data(conversation, proto_tn3270);
  if (tn3270_info == NULL) {
    /* No.  Attach that information to the conversation, and add
     * it to the list of information structures.
     */
    tn3270_info = wmem_new(wmem_file_scope(), tn3270_conv_info_t);

    copy_address(&(tn3270_info->outbound_addr), &(pinfo->dst));
    tn3270_info->outbound_port = pinfo->destport;

    copy_address(&(tn3270_info->inbound_addr), &(pinfo->src));
    tn3270_info->inbound_port  = pinfo->srcport;

    conversation_add_proto_data(conversation, proto_tn3270, tn3270_info);
  }

  /* The maximum rows/cols is tied to the 3270 model number */
  switch (model) {
    default:
    case 2:
      tn3270_info->altrows = 24;
      tn3270_info->altcols = 80;
      break;
    case 3:
      tn3270_info->altrows = 32;
      tn3270_info->altcols = 80;
      break;
    case 4:
      tn3270_info->altrows = 43;
      tn3270_info->altcols = 80;
      break;
    case 5:
      tn3270_info->altrows = 27;
      tn3270_info->altcols = 132;
      break;
  }
  tn3270_info->rows = 24;
  tn3270_info->cols = 80;

  tn3270_info->extended = tn3270e;

}
