static guint get_write_list_size(tvbuff_t *tvb, guint max_offset, guint offset)
{
    guint32 value_follows, segment_count;
    guint start = offset;

    while (1) {
        value_follows = tvb_get_ntohl(tvb, offset);
        offset += 4;
        if (offset > max_offset)
            return 0;
        if (!value_follows)
            break;

        segment_count = tvb_get_ntohl(tvb, offset);
        offset += 4;
        if (offset > max_offset)
            return 0;
        if ((offset + (segment_count * 16)) < offset ||
            (offset + (segment_count * 16)) > max_offset)
            return 0;
        offset += (segment_count * 16);
    }

    return offset - start;
}
