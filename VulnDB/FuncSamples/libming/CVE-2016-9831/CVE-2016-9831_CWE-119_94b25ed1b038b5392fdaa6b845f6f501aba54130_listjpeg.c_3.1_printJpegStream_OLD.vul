void printJpegStream(FILE *f)
{
  int c, l;

  while(!feof(f))
  {
    if(fgetc(f) != JPEG_MARKER)
    {
      printf("Jpeg marker not found!\n");
      break;
    }

    switch(c=fgetc(f))
    {
      case JPEG_SOI:   printf("SOI\n"); break;
      case JPEG_EOI:   printf("EOI\n"); break;
      case JPEG_JFIF:  printf("JFIF\n"); break;
      case JPEG_QUANT: printf("Quantization table\n"); break;
      case JPEG_HUFF:  printf("Huffman table\n"); break;
      case JPEG_SOF0:  printf("Start of frame 0\n"); break;
      case JPEG_SOF1:  printf("Start of frame 1\n"); break;
      case JPEG_SOF2:  printf("Start of frame 2\n"); break;
      case JPEG_SOS:   printf("Start of scan\n"); break;
      default:         printf("Unknown JPEG block: %02x\n", c);
    }

    if(c==JPEG_SOS)
      break;

    if(c != JPEG_SOI && c != JPEG_EOI)
    {
      l = (fgetc(f)<<8) + fgetc(f);
      printf("%i bytes\n", l);

      for(l-=2; l>0; --l)
	fgetc(f);
    }
  }
}
