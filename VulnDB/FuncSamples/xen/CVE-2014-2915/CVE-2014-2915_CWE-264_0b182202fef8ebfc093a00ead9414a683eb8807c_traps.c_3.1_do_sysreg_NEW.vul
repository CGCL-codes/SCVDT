static void do_sysreg(struct cpu_user_regs *regs,
                      union hsr hsr)
{
    register_t *x = select_user_reg(regs, hsr.sysreg.reg);

    switch ( hsr.bits & HSR_SYSREG_REGS_MASK )
    {
    /* RAZ/WI registers: */
    /*  - Debug */
    case HSR_SYSREG_MDSCR_EL1:
    /*  - Perf monitors */
    case HSR_SYSREG_PMINTENSET_EL1:
    case HSR_SYSREG_PMINTENCLR_EL1:
    case HSR_SYSREG_PMCR_EL0:
    case HSR_SYSREG_PMCNTENSET_EL0:
    case HSR_SYSREG_PMCNTENCLR_EL0:
    case HSR_SYSREG_PMOVSCLR_EL0:
    case HSR_SYSREG_PMSWINC_EL0:
    case HSR_SYSREG_PMSELR_EL0:
    case HSR_SYSREG_PMCEID0_EL0:
    case HSR_SYSREG_PMCEID1_EL0:
    case HSR_SYSREG_PMCCNTR_EL0:
    case HSR_SYSREG_PMXEVTYPER_EL0:
    case HSR_SYSREG_PMXEVCNTR_EL0:
    case HSR_SYSREG_PMUSERENR_EL0:
    case HSR_SYSREG_PMOVSSET_EL0:
    /* - Breakpoints */
    HSR_SYSREG_DBG_CASES(DBGBVR):
    HSR_SYSREG_DBG_CASES(DBGBCR):
    /* -  Watchpoints */
    HSR_SYSREG_DBG_CASES(DBGWVR):
    HSR_SYSREG_DBG_CASES(DBGWCR):
        if ( hsr.sysreg.read )
            *x = 0;
        /* else: write ignored */
        break;

    /* Write only, Write ignore registers: */
    case HSR_SYSREG_OSLAR_EL1:
        if ( hsr.sysreg.read )
            goto bad_sysreg;
        /* else: write ignored */
        break;
    case HSR_SYSREG_CNTP_CTL_EL0:
    case HSR_SYSREG_CNTP_TVAL_EL0:
        if ( !vtimer_emulate(regs, hsr) )
        {
            dprintk(XENLOG_ERR,
                    "failed emulation of 64-bit vtimer sysreg access\n");
            domain_crash_synchronous();
        }
        break;
    default:
 bad_sysreg:
        {
            struct hsr_sysreg sysreg = hsr.sysreg;
#ifndef NDEBUG

            gdprintk(XENLOG_ERR,
                     "%s %d, %d, c%d, c%d, %d %s x%d @ 0x%"PRIregister"\n",
                     sysreg.read ? "mrs" : "msr",
                     sysreg.op0, sysreg.op1,
                     sysreg.crn, sysreg.crm,
                     sysreg.op2,
                     sysreg.read ? "=>" : "<=",
                     sysreg.reg, regs->pc);
            gdprintk(XENLOG_ERR, "unhandled 64-bit sysreg access %#x",
                     hsr.bits & HSR_SYSREG_REGS_MASK);
#endif
            inject_undef64_exception(regs, sysreg.len);
        }
    }

    regs->pc += 4;
}
