int _read_trylock(rwlock_t *lock)
{
    uint32_t x;

    check_lock(&lock->debug);
    do {
        if ( (x = lock->lock) & RW_WRITE_FLAG )
            return 0;
    } while ( cmpxchg(&lock->lock, x, x+1) != x );
    preempt_disable();
    return 1;
}
