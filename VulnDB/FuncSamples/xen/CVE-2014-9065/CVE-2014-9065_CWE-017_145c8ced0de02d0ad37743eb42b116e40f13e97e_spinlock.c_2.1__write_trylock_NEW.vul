int _write_trylock(rwlock_t *lock)
{
    uint32_t x;

    check_lock(&lock->debug);
    do {
        if ( (x = lock->lock) != 0 )
            return 0;
    } while ( cmpxchg(&lock->lock, x, x|RW_WRITE_FLAG) != x );
    preempt_disable();
    return 1;
}
