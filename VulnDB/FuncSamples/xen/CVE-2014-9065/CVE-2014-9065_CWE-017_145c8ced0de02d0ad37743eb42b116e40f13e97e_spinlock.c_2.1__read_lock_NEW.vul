void _read_lock(rwlock_t *lock)
{
    uint32_t x;

    check_lock(&lock->debug);
    do {
        while ( (x = lock->lock) & RW_WRITE_FLAG )
            cpu_relax();
    } while ( cmpxchg(&lock->lock, x, x+1) != x );
    preempt_disable();
}
