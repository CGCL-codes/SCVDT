unsigned long _read_lock_irqsave(rwlock_t *lock)
{
    unsigned long flags;
    local_irq_save(flags);
    check_lock(&lock->debug);
    while ( unlikely(!_raw_read_trylock(&lock->raw)) )
    {
        local_irq_restore(flags);
        while ( likely(_raw_rw_is_write_locked(&lock->raw)) )
            cpu_relax();
        local_irq_save(flags);
    }
    preempt_disable();
    return flags;
}
