int handle_xsetbv(u32 index, u64 new_bv)
{
    struct vcpu *curr = current;

    if ( index != XCR_XFEATURE_ENABLED_MASK )
        return -EOPNOTSUPP;

    if ( (new_bv & ~xfeature_mask) || !(new_bv & XSTATE_FP) )
        return -EINVAL;

    if ( (new_bv & XSTATE_YMM) && !(new_bv & XSTATE_SSE) )
        return -EINVAL;

    if ( !set_xcr0(new_bv) )
        return -EFAULT;

    curr->arch.xcr0 = new_bv;
    curr->arch.xcr0_accum |= new_bv;

    return 0;
}
