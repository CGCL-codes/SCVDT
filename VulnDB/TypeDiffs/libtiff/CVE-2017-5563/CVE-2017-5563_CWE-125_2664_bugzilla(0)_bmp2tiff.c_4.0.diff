Index: archive/tools/bmp2tiff.c
===================================================================
RCS file: /cvs/maptools/cvsroot/libtiff/archive/tools/bmp2tiff.c,v
retrieving revision 1.1
diff -u -r1.1 bmp2tiff.c
--- archive/tools/bmp2tiff.c	5 Jun 2016 19:53:59 -0000	1.1
+++ archive/tools/bmp2tiff.c	29 Mar 2017 09:23:00 -0000
@@ -1,4 +1,4 @@
-/* $Id: bmp2tiff.c,v 1.1 2016-06-05 19:53:59 bfriesen Exp $
+/* $Id$
  *
  * Project:  libtiff tools
  * Purpose:  Convert Windows BMP files in TIFF.
@@ -771,6 +771,14 @@
 
 			_TIFFfree(comprbuf);
 
+			/* Check whether we are not going to read past the uncompressed data */
+			if ( length > j || width > j || length * width > j) {
+				TIFFError(infilename,
+                                          "Premature end of file");
+				_TIFFfree(uncomprbuf);
+				goto bad3;
+			}
+
 			for (row = 0; row < length; row++) {
 				if (TIFFWriteScanline(out,
                                                       uncomprbuf + (length - row - 1) * width,
