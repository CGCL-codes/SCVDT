diff -urNp libpng-1.2.7.orig/pngtrans.c libpng-1.2.7/pngtrans.c
--- libpng-1.2.7.orig/pngtrans.c	2006-01-24 15:00:27.000000000 -0500
+++ libpng-1.2.7/pngtrans.c	2006-01-25 09:50:12.000000000 -0500
@@ -392,7 +392,9 @@ png_do_strip_filler(png_row_infop row_in
       png_uint_32 row_width=row_info->width;
       png_uint_32 i;
 
-      if (row_info->color_type == PNG_COLOR_TYPE_RGB &&
+      if ((row_info->color_type == PNG_COLOR_TYPE_RGB ||
+         (row_info->color_type == PNG_COLOR_TYPE_RGB_ALPHA &&
+         (flags & PNG_FLAG_STRIP_ALPHA))) && 
          row_info->channels == 4)
       {
          if (row_info->bit_depth == 8)
@@ -471,8 +473,10 @@ png_do_strip_filler(png_row_infop row_in
          }
          row_info->channels = 3;
       }
-      else if (row_info->color_type == PNG_COLOR_TYPE_GRAY &&
-          row_info->channels == 2)
+      else if ((row_info->color_type == PNG_COLOR_TYPE_GRAY ||
+              (row_info->color_type == PNG_COLOR_TYPE_GRAY_ALPHA &&
+              (flags & PNG_FLAG_STRIP_ALPHA))) &&
+              row_info->channels == 2)
       {
          if (row_info->bit_depth == 8)
          {
@@ -525,6 +529,9 @@ png_do_strip_filler(png_row_infop row_in
          }
          row_info->channels = 1;
       }
+      if (flags & PNG_FLAG_STRIP_ALPHA)
+        row_info->color_type &= ~PNG_COLOR_MASK_ALPHA;
+
    }
 }
 #endif
