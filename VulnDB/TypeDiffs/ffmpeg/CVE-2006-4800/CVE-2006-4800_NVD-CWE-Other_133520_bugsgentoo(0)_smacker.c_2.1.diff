Index: smacker.c
===================================================================
RCS file: /cvsroot/ffmpeg/ffmpeg/libavcodec/smacker.c,v
retrieving revision 1.2
retrieving revision 1.3
diff -u -d -r1.2 -r1.3
--- smacker.c	25 Mar 2006 15:37:08 -0000	1.2
+++ smacker.c	13 May 2006 10:45:25 -0000	1.3
@@ -177,6 +177,11 @@
     int escapes[3];
     DBCtx ctx;
 
+    if(size >= UINT_MAX>>4){ // (((size + 3) >> 2) + 3) << 2 must not overflow
+        av_log(smk->avctx, AV_LOG_ERROR, "size too large\n");
+        return -1;
+    }
+
     tmp1.length = 256;
     tmp1.maxlength = 0;
     tmp1.current = 0;

