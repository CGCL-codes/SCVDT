Index: smacker.c
===================================================================
RCS file: /cvsroot/ffmpeg/ffmpeg/libavformat/smacker.c,v
retrieving revision 1.1
retrieving revision 1.2
diff -u -d -r1.1 -r1.2
--- smacker.c	21 Mar 2006 17:27:47 -0000	1.1
+++ smacker.c	13 May 2006 11:37:56 -0000	1.2
@@ -114,6 +114,13 @@
     for(i = 0; i < 7; i++)
         smk->audio[i] = get_le32(pb);
     smk->treesize = get_le32(pb);
+
+    if(smk->treesize >= UINT_MAX/4){ // smk->treesize + 16 must not overflow (this check is probably redundant)
+        av_log(s, AV_LOG_ERROR, "treesize too large\n");
+        return -1;
+    }
+
+//FIXME remove extradata "rebuilding"
     smk->mmap_size = get_le32(pb);
     smk->mclr_size = get_le32(pb);
     smk->full_size = get_le32(pb);

