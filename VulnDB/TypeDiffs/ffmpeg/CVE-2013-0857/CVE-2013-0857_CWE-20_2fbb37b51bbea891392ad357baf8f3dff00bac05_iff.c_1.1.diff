diff --git a/libavcodec/iff.c b/libavcodec/iff.c
index d5c1457de1c..9184015d50c 100644
--- a/libavcodec/iff.c
+++ b/libavcodec/iff.c
@@ -575,13 +575,13 @@ static int decode_frame_ilbm(AVCodecContext *avctx,
         }
     } else if (avctx->codec_tag == MKTAG('P','B','M',' ')) { // IFF-PBM
         if (avctx->pix_fmt == AV_PIX_FMT_PAL8 || avctx->pix_fmt == AV_PIX_FMT_GRAY8) {
-            for(y = 0; y < avctx->height; y++ ) {
+            for(y = 0; y < avctx->height && buf_end > buf; y++ ) {
                 uint8_t *row = &s->frame.data[0][y * s->frame.linesize[0]];
                 memcpy(row, buf, FFMIN(avctx->width, buf_end - buf));
                 buf += avctx->width + (avctx->width % 2); // padding if odd
             }
         } else if (s->ham) { // IFF-PBM: HAM to AV_PIX_FMT_BGR32
-            for (y = 0; y < avctx->height; y++) {
+            for (y = 0; y < avctx->height && buf_end > buf; y++) {
                 uint8_t *row = &s->frame.data[0][ y*s->frame.linesize[0] ];
                 memcpy(s->ham_buf, buf, FFMIN(avctx->width, buf_end - buf));
                 buf += avctx->width + (avctx->width & 1); // padding if odd
