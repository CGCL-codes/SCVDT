--- php/php-src/branches/PHP_5_3/ext/gd/gd.c	2010/11/18 14:59:28	305506
+++ php/php-src/branches/PHP_5_3/ext/gd/gd.c	2010/11/18 15:22:22	305507
@@ -2642,6 +2642,9 @@
 	}
 
 	if (argc >= 2 && file_len) {
+		if (strlen(file) != file_len) {
+			RETURN_FALSE;
+		}
 		PHP_GD_CHECK_OPEN_BASEDIR(fn, "Invalid filename");
 
 		fp = VCWD_FOPEN(fn, "wb");
@@ -4552,6 +4555,14 @@
 	dest_width = width;
 	int_threshold = threshold;
 
+	if (strlen(f_org) != f_org_len) {
+		RETURN_FALSE;
+	}
+
+	if (strlen(f_dest) != f_dest_len) {
+		RETURN_FALSE;
+	}
+
 	/* Check threshold value */
 	if (int_threshold < 0 || int_threshold > 8) {
 		php_error_docref(NULL TSRMLS_CC, E_WARNING, "Invalid threshold value '%d'", int_threshold);
