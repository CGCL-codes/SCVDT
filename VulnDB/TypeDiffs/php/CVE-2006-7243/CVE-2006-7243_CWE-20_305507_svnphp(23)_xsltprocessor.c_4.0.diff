--- php/php-src/branches/PHP_5_3/ext/xsl/xsltprocessor.c	2010/11/18 14:59:28	305506
+++ php/php-src/branches/PHP_5_3/ext/xsl/xsltprocessor.c	2010/11/18 15:22:22	305507
@@ -642,6 +642,9 @@
 
 	ret = -1;
 	if (newdocp) {
+		if (strlen(uri) != uri_len) {
+			RETURN_FALSE;
+		}
 		ret = xsltSaveResultToFilename(uri, newdocp, sheetp, 0);
 		xmlFreeDoc(newdocp);
 	}
@@ -845,7 +848,7 @@
 		if (intern->profiling) {
 			efree(intern->profiling);
 		}
-		if (filename != NULL) {
+		if (filename != NULL && strlen(filename) == filename_len) {
 			intern->profiling = estrndup(filename,filename_len);
 		} else {
 			intern->profiling = NULL;
