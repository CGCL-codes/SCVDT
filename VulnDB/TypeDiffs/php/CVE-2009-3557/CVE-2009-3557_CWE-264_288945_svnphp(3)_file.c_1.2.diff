--- php/php-src/branches/PHP_5_3/ext/standard/file.c	2009/09/29 14:03:49	288944
+++ php/php-src/branches/PHP_5_3/ext/standard/file.c	2009/09/29 14:14:02	288945
@@ -846,6 +846,10 @@
 		return;
 	}
 
+	if (PG(safe_mode) &&(!php_checkuid(dir, NULL, CHECKUID_ALLOW_ONLY_DIR))) {
+		RETURN_FALSE;
+	}
+
 	if (php_check_open_basedir(dir TSRMLS_CC)) {
 		RETURN_FALSE;
 	}
