diff --git a/ext/ftp/ftp.c b/ext/ftp/ftp.c
index a6e0dfd..b805abe 100644
--- a/ext/ftp/ftp.c
+++ b/ext/ftp/ftp.c
@@ -1653,7 +1653,7 @@ ftp_genlist(ftpbuf_t *ftp, const char *cmd, const char *path TSRMLS_DC)
        lines = 0;
        lastch = 0;
        while ((rcvd = my_recv(ftp, data->fd, data->buf, FTP_BUFSIZE))) {
-               if (rcvd == -1) {
+               if (rcvd == -1 || size > INT_MAX - (rcvd * 2)) {
                        goto bail;
                }

@@ -1663,8 +1663,6 @@ ftp_genlist(ftpbuf_t *ftp, const char *cmd, const char *path TSRMLS_DC)
                for (ptr = data->buf; rcvd; rcvd--, ptr++) {
                        if (*ptr == '\n' && lastch == '\r') {
                                lines++;
-                       } else {
-                               size++;
                        }
                        lastch = *ptr;
                }