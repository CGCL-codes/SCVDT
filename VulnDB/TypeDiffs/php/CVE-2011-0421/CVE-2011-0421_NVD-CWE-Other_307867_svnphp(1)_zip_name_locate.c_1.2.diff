--- php/php-src/branches/PHP_5_3/ext/zip/lib/zip_name_locate.c	2011/01/30 22:16:39	307866
+++ php/php-src/branches/PHP_5_3/ext/zip/lib/zip_name_locate.c	2011/01/30 22:28:57	307867
@@ -60,6 +60,10 @@
 	return -1;
     }
 
+    if((flags & ZIP_FL_UNCHANGED)  && !za->cdir) {
+    	return -1;
+    }
+
     cmp = (flags & ZIP_FL_NOCASE) ? strcmpi : strcmp;
 
     n = (flags & ZIP_FL_UNCHANGED) ? za->cdir->nentry : za->nentry;
