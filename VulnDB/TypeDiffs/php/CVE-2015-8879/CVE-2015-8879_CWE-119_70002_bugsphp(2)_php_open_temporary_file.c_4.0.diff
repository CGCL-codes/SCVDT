diff --git a/main/php_open_temporary_file.c b/main/php_open_temporary_file.c
index 2600246..ab3f763 100644
--- a/main/php_open_temporary_file.c
+++ b/main/php_open_temporary_file.c
@@ -176,7 +176,16 @@ static int php_do_open_temporary_file(const char *path, const char *pfx, char **
 /* }}} */
 
 /* Cache the chosen temporary directory. */
-static char* temporary_directory;
+#ifdef ZTS
+# ifdef PHP_WIN32
+static __declspec(thread)
+# else
+static __thread
+# endif
+#else
+static
+#endif
+char* temporary_directory;
 
 PHPAPI void php_shutdown_temporary_directory(void)
 {
