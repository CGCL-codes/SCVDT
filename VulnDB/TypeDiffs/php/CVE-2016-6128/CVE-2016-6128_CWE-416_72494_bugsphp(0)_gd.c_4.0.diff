diff --git a/ext/gd/gd.c b/ext/gd/gd.c
index d863523..8c88474 100644
--- a/ext/gd/gd.c
+++ b/ext/gd/gd.c
@@ -4617,7 +4617,7 @@ PHP_FUNCTION(imagecropauto)
                        break;

                case GD_CROP_THRESHOLD:
-                       if (color < 0) {
+                       if (color < 0 || (!gdImageTrueColor(im) && color >= gdImageColorsTotal(im))) {
                                php_error_docref(NULL, E_WARNING, "Color argument missing with threshold mode");
                                RETURN_FALSE;
                        }