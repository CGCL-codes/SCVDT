diff --git a/ext/standard/url.c b/ext/standard/url.c
index 2f56d3186d45..28ccba0c8173 100644
--- a/ext/standard/url.c
+++ b/ext/standard/url.c
@@ -320,7 +320,7 @@ PHPAPI php_url *php_url_parse_ex(char const *str, int length)
 	nohost:
 	
 	if ((p = memchr(s, '?', (ue - s)))) {
-		pp = strchr(s, '#');
+		pp = memchr(s, '#', (ue - s));
 
 		if (pp && pp < p) {
 			if (pp - s) {
