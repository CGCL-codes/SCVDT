diff -urN hfs/dir.c linux-2.6.31.6/fs/hfs/dir.c
--- hfs/dir.c	2009-11-16 13:29:47.000000000 -0500
+++ linux-2.6.31.6/fs/hfs/dir.c	2009-11-17 13:08:43.000000000 -0500
@@ -79,6 +79,11 @@
 		filp->f_pos++;
 		/* fall through */
 	case 1:
+		if ((fd.entrylength > sizeof(entry)) || (fd.entrylength < 0)) {
+			err = -EINVAL;
+			goto out;
+			}
+
 		hfs_bnode_read(fd.bnode, &entry, fd.entryoffset, fd.entrylength);
 		if (entry.type != HFS_CDR_THD) {
 			printk(KERN_ERR "hfs: bad catalog folder thread\n");
@@ -109,6 +114,12 @@
 			err = -EIO;
 			goto out;
 		}
+		
+		if ((fd.entrylength > sizeof(entry)) || (fd.entrylength < 0)) {
+			err = -EINVAL;
+			goto out;
+			}
+
 		hfs_bnode_read(fd.bnode, &entry, fd.entryoffset, fd.entrylength);
 		type = entry.type;
 		len = hfs_mac2asc(sb, strbuf, &fd.key->cat.CName);
