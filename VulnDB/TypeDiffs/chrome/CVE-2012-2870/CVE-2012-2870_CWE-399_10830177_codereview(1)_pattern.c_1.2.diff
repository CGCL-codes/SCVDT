Index: third_party/libxslt/libxslt/pattern.c
===================================================================
--- third_party/libxslt/libxslt/pattern.c	(revision 148983)
+++ third_party/libxslt/libxslt/pattern.c	(working copy)
@@ -1787,6 +1787,8 @@
 	SKIP_BLANKS;
 	if ((CUR == '(') && !xmlXPathIsNodeType(name)) {
 	    xsltCompileIdKeyPattern(ctxt, name, 1, novar, 0);
+	    if (ctxt->error)
+		return;
 	    if ((CUR == '/') && (NXT(1) == '/')) {
 		PUSH(XSLT_OP_ANCESTOR, NULL, NULL, novar);
 		NEXT;
