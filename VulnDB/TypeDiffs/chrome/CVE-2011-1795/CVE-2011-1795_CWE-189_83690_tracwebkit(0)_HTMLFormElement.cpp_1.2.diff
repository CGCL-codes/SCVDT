Index: /trunk/Source/WebCore/html/HTMLFormElement.cpp

===================================================================

--- /trunk/Source/WebCore/html/HTMLFormElement.cpp	(revision 83689)

+++ /trunk/Source/WebCore/html/HTMLFormElement.cpp	(revision 83690)

@@ -412,5 +412,5 @@

     // Updates the indeces in order to the relation of the position:

     unsigned short position = compareDocumentPosition(element);

-    if (position & DOCUMENT_POSITION_CONTAINS)

+    if (position & (DOCUMENT_POSITION_CONTAINS | DOCUMENT_POSITION_CONTAINED_BY))

         ++m_associatedElementsAfterIndex;

     else if (position & DOCUMENT_POSITION_PRECEDING) {

@@ -483,16 +483,13 @@

     if (e->isFormControlElement())

         m_checkedRadioButtons.removeButton(static_cast<HTMLFormControlElement*>(e));

-    HTMLElement* element = toHTMLElement(e);

-    if (element->fastHasAttribute(formAttr)) {

-        unsigned index;

-        for (index = 0; index < m_associatedElements.size(); ++index)

-            if (m_associatedElements[index] == e)

-                break;

-        ASSERT(index < m_associatedElements.size());

-        if (index < m_associatedElementsBeforeIndex)

-            --m_associatedElementsBeforeIndex;

-        if (index < m_associatedElementsAfterIndex)

-            --m_associatedElementsAfterIndex;

-    } else

+    unsigned index;

+    for (index = 0; index < m_associatedElements.size(); ++index) {

+        if (m_associatedElements[index] == e)

+            break;

+    }

+    ASSERT(index < m_associatedElements.size());

+    if (index < m_associatedElementsBeforeIndex)

+        --m_associatedElementsBeforeIndex;

+    if (index < m_associatedElementsAfterIndex)

         --m_associatedElementsAfterIndex;

     removeFromVector(m_associatedElements, e);

