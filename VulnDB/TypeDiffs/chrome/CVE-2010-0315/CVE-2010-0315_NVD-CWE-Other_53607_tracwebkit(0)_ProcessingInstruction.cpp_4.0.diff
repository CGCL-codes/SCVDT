Index: /trunk/WebCore/dom/ProcessingInstruction.cpp

===================================================================

--- /trunk/WebCore/dom/ProcessingInstruction.cpp	(revision 53606)

+++ /trunk/WebCore/dom/ProcessingInstruction.cpp	(revision 53607)

@@ -140,5 +140,6 @@

             // to kick off import/include loads that can hang off some parent sheet.

             if (m_isXSL) {

-                m_sheet = XSLStyleSheet::createEmbedded(this, m_localHref);

+                KURL baseURL = KURL(ParsedURLString, m_localHref);

+                m_sheet = XSLStyleSheet::createEmbedded(this, m_localHref, baseURL);

                 m_loading = false;

             }

@@ -198,10 +199,10 @@

 }

 

-void ProcessingInstruction::setCSSStyleSheet(const String& url, const String& charset, const CachedCSSStyleSheet* sheet)

+void ProcessingInstruction::setCSSStyleSheet(const String& href, const KURL& baseURL, const String& charset, const CachedCSSStyleSheet* sheet)

 {

 #if ENABLE(XSLT)

     ASSERT(!m_isXSL);

 #endif

-    RefPtr<CSSStyleSheet> newSheet = CSSStyleSheet::create(this, url, charset);

+    RefPtr<CSSStyleSheet> newSheet = CSSStyleSheet::create(this, href, baseURL, charset);

     m_sheet = newSheet;

     // We don't need the cross-origin security check here because we are

@@ -215,8 +216,8 @@

 

 #if ENABLE(XSLT)

-void ProcessingInstruction::setXSLStyleSheet(const String& url, const String& sheet)

+void ProcessingInstruction::setXSLStyleSheet(const String& href, const KURL& baseURL, const String& sheet)

 {

     ASSERT(m_isXSL);

-    m_sheet = XSLStyleSheet::create(this, url);

+    m_sheet = XSLStyleSheet::create(this, href, baseURL);

     parseStyleSheet(sheet);

 }

