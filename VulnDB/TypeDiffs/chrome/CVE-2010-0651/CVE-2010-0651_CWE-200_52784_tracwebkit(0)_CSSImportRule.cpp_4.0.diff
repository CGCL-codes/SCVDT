Index: /trunk/WebCore/css/CSSImportRule.cpp

===================================================================

--- /trunk/WebCore/css/CSSImportRule.cpp	(revision 52783)

+++ /trunk/WebCore/css/CSSImportRule.cpp	(revision 52784)

@@ -26,4 +26,5 @@

 #include "DocLoader.h"

 #include "Document.h"

+#include "SecurityOrigin.h"

 #include "Settings.h"

 #include <wtf/StdLibExtras.h>

@@ -60,4 +61,6 @@

     m_styleSheet = CSSStyleSheet::create(this, url, charset);

 

+    bool crossOriginCSS = false;

+    bool validMIMEType = false;

     CSSStyleSheet* parent = parentStyleSheet();

     bool strict = !parent || parent->useStrictParsing();

@@ -73,6 +76,12 @@

 #endif

 

-    String sheetText = sheet->sheetText(enforceMIMEType);

+    String sheetText = sheet->sheetText(enforceMIMEType, &validMIMEType);

     m_styleSheet->parseString(sheetText, strict);

+

+    if (!parent || !parent->doc() || !parent->doc()->securityOrigin()->canRequest(KURL(ParsedURLString, url)))

+        crossOriginCSS = true;

+

+    if (crossOriginCSS && !validMIMEType && !m_styleSheet->hasSyntacticallyValidCSSHeader())

+        m_styleSheet = CSSStyleSheet::create(this, url, charset);

 

     if (strict && needsSiteSpecificQuirks) {

