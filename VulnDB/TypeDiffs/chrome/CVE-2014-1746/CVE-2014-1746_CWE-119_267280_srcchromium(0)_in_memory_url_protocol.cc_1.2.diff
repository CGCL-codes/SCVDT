--- trunk/src/media/filters/in_memory_url_protocol.cc	2014/04/30 18:38:38	267279
+++ trunk/src/media/filters/in_memory_url_protocol.cc	2014/04/30 18:56:22	267280
@@ -4,6 +4,8 @@
 
 #include "media/filters/in_memory_url_protocol.h"
 
+#include "media/ffmpeg/ffmpeg_common.h"
+
 namespace media {
 
 InMemoryUrlProtocol::InMemoryUrlProtocol(const uint8* data, int64 size,
@@ -17,12 +19,18 @@
 InMemoryUrlProtocol::~InMemoryUrlProtocol() {}
 
 int InMemoryUrlProtocol::Read(int size, uint8* data) {
-  int available_bytes = size_ - position_;
+  if (size < 0)
+    return AVERROR(EIO);
+
+  int64 available_bytes = size_ - position_;
   if (size > available_bytes)
     size = available_bytes;
 
-  memcpy(data, data_ + position_, size);
-  position_ += size;
+  if (size > 0) {
+    memcpy(data, data_ + position_, size);
+    position_ += size;
+  }
+
   return size;
 }
 
