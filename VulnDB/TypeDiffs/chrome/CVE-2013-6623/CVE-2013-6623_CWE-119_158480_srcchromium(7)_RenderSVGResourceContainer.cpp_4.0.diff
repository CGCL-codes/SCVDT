--- trunk/Source/core/rendering/svg/RenderSVGResourceContainer.cpp	2013/09/28 04:00:31	158479
+++ trunk/Source/core/rendering/svg/RenderSVGResourceContainer.cpp	2013/09/28 04:17:17	158480
@@ -23,11 +23,12 @@
 
 #include "core/rendering/RenderLayer.h"
 #include "core/rendering/RenderView.h"
-#include "core/rendering/svg/RenderSVGRoot.h"
 #include "core/rendering/svg/SVGRenderingContext.h"
 #include "core/rendering/svg/SVGResourcesCache.h"
 #include "core/svg/SVGGraphicsElement.h"
 
+#include "wtf/TemporaryChange.h"
+
 namespace WebCore {
 
 static inline SVGDocumentExtensions* svgExtensionsFromElement(SVGElement* element)
@@ -41,6 +42,7 @@
     , m_id(node->getIdAttribute())
     , m_registered(false)
     , m_isInvalidating(false)
+    , m_isInLayout(false)
 {
 }
 
@@ -52,9 +54,15 @@
 
 void RenderSVGResourceContainer::layout()
 {
+    ASSERT(needsLayout());
+    if (m_isInLayout)
+        return;
+
+    TemporaryChange<bool> inLayoutChange(m_isInLayout, true);
+
     // Invalidate all resources if our layout changed.
     if (everHadLayout() && selfNeedsLayout())
-        RenderSVGRoot::addResourceForClientInvalidation(this);
+        removeAllClientsFromCache();
 
     RenderSVGHiddenContainer::layout();
 }
