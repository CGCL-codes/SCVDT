--- trunk/Source/core/rendering/svg/RenderSVGResourceMarker.cpp	2013/09/28 04:00:31	158479
+++ trunk/Source/core/rendering/svg/RenderSVGResourceMarker.cpp	2013/09/28 04:17:17	158480
@@ -25,11 +25,12 @@
 
 #include "core/platform/graphics/GraphicsContextStateSaver.h"
 #include "core/rendering/svg/RenderSVGContainer.h"
-#include "core/rendering/svg/RenderSVGRoot.h"
 #include "core/rendering/svg/SVGRenderSupport.h"
 #include "core/svg/SVGElement.h"
 #include "core/svg/SVGMarkerElement.h"
 
+#include "wtf/TemporaryChange.h"
+
 namespace WebCore {
 
 RenderSVGResourceType RenderSVGResourceMarker::s_resourceType = MarkerResourceType;
@@ -45,9 +46,15 @@
 
 void RenderSVGResourceMarker::layout()
 {
+    ASSERT(needsLayout());
+    if (m_isInLayout)
+        return;
+
+    TemporaryChange<bool> inLayoutChange(m_isInLayout, true);
+
     // Invalidate all resources if our layout changed.
     if (everHadLayout() && selfNeedsLayout())
-        RenderSVGRoot::addResourceForClientInvalidation(this);
+        removeAllClientsFromCache();
 
     // RenderSVGHiddenContainer overwrites layout(). We need the
     // layouting of RenderSVGContainer for calculating  local
