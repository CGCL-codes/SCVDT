Index: /trunk/Source/WebCore/platform/graphics/cg/GraphicsContext3DCG.cpp

===================================================================

--- /trunk/Source/WebCore/platform/graphics/cg/GraphicsContext3DCG.cpp	(revision 117190)

+++ /trunk/Source/WebCore/platform/graphics/cg/GraphicsContext3DCG.cpp	(revision 117191)

@@ -241,5 +241,11 @@

         return false;

     const UInt8* rgba = CFDataGetBytePtr(pixelData.get());

-    outputVector.resize(width * height * 4);

+

+    unsigned int packedSize;

+    // Output data is tightly packed (alignment == 1).

+    if (computeImageSizeInBytes(format, type, width, height, 1, &packedSize, 0) != GraphicsContext3D::NO_ERROR)

+        return false;

+    outputVector.resize(packedSize);

+

     unsigned int srcUnpackAlignment = 0;

     size_t bytesPerRow = CGImageGetBytesPerRow(cgImage);

