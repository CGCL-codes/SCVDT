Index: /trunk/WebCore/editing/DeleteSelectionCommand.cpp

===================================================================

--- /trunk/WebCore/editing/DeleteSelectionCommand.cpp	(revision 63772)

+++ /trunk/WebCore/editing/DeleteSelectionCommand.cpp	(revision 63773)

@@ -538,10 +538,10 @@

     updateLayout();

     // FIXME: isRenderedCharacter should be removed, and we should use VisiblePosition::characterAfter and VisiblePosition::characterBefore

-    if (m_leadingWhitespace.isNotNull() && !m_leadingWhitespace.isRenderedCharacter()) {

+    if (m_leadingWhitespace.isNotNull() && !m_leadingWhitespace.isRenderedCharacter() && m_leadingWhitespace.node()->isTextNode()) {

         Text* textNode = static_cast<Text*>(m_leadingWhitespace.node());

         ASSERT(!textNode->renderer() || textNode->renderer()->style()->collapseWhiteSpace());

         replaceTextInNode(textNode, m_leadingWhitespace.deprecatedEditingOffset(), 1, nonBreakingSpaceString());

     }

-    if (m_trailingWhitespace.isNotNull() && !m_trailingWhitespace.isRenderedCharacter()) {

+    if (m_trailingWhitespace.isNotNull() && !m_trailingWhitespace.isRenderedCharacter() && m_trailingWhitespace.node()->isTextNode()) {

         Text* textNode = static_cast<Text*>(m_trailingWhitespace.node());

         ASSERT(!textNode->renderer() ||textNode->renderer()->style()->collapseWhiteSpace());

