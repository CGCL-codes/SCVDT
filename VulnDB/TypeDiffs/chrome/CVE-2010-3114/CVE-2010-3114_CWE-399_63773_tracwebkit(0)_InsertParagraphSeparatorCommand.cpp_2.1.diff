Index: /trunk/WebCore/editing/InsertParagraphSeparatorCommand.cpp

===================================================================

--- /trunk/WebCore/editing/InsertParagraphSeparatorCommand.cpp	(revision 63772)

+++ /trunk/WebCore/editing/InsertParagraphSeparatorCommand.cpp	(revision 63773)

@@ -313,5 +313,5 @@

     // FIXME: leadingWhitespacePosition is returning the position before preserved newlines for positions

     // after the preserved newline, causing the newline to be turned into a nbsp.

-    if (leadingWhitespace.isNotNull()) {

+    if (leadingWhitespace.isNotNull() && leadingWhitespace.node()->isTextNode()) {

         Text* textNode = static_cast<Text*>(leadingWhitespace.node());

         ASSERT(!textNode->renderer() || textNode->renderer()->style()->collapseWhiteSpace());

@@ -386,8 +386,8 @@

         if (!insertionPosition.isRenderedCharacter()) {

             // Clear out all whitespace and insert one non-breaking space

-            ASSERT(insertionPosition.node()->isTextNode());

             ASSERT(!insertionPosition.node()->renderer() || insertionPosition.node()->renderer()->style()->collapseWhiteSpace());

             deleteInsignificantTextDownstream(insertionPosition);

-            insertTextIntoNode(static_cast<Text*>(insertionPosition.node()), 0, nonBreakingSpaceString());

+            if (insertionPosition.node()->isTextNode())

+                insertTextIntoNode(static_cast<Text*>(insertionPosition.node()), 0, nonBreakingSpaceString());

         }

     }

