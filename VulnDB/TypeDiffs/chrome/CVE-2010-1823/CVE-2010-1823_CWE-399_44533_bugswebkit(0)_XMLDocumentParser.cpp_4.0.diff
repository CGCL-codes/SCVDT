diff --git a/WebCore/dom/XMLDocumentParser.cpp b/WebCore/dom/XMLDocumentParser.cpp
index 054e4e359abd59412d22f867e3416a71b5c767da..117a45496e22d607ddc47db702ffb7c7f29fd98e 100644
--- a/WebCore/dom/XMLDocumentParser.cpp
+++ b/WebCore/dom/XMLDocumentParser.cpp
@@ -132,7 +132,7 @@ void XMLDocumentParser::append(const SegmentedString& s)
     if (m_sawXSLTransform || !m_sawFirstElement)
         m_originalSourceForTransform += parseString;
 
-    if (m_parserStopped || m_sawXSLTransform)
+    if (isDetached() || m_parserStopped || m_sawXSLTransform)
         return;
 
     if (m_parserPaused) {
@@ -211,6 +211,12 @@ void XMLDocumentParser::exitText()
     popCurrentNode();
 }
 
+void XMLDocumentParser::detach()
+{
+    clearCurrentNodeStack();
+    ScriptableDocumentParser::detach();
+}
+
 void XMLDocumentParser::end()
 {
     // XMLDocumentParserLibxml2 will do bad things to the document if doEnd() is called.
@@ -346,6 +352,9 @@ void XMLDocumentParser::notifyFinished(CachedResource* unusedResource)
     ScriptElement* scriptElement = toScriptElement(e.get());
     ASSERT(scriptElement);
 
+    // JavaScript can detach this parser, make sure it's kept alive even if detached.
+    RefPtr<XMLDocumentParser> protect(this);
+    
     if (errorOccurred)
         scriptElement->dispatchErrorEvent();
     else {
@@ -355,7 +364,7 @@ void XMLDocumentParser::notifyFinished(CachedResource* unusedResource)
 
     m_scriptElement = 0;
 
-    if (!m_requestingScript)
+    if (!isDetached() && !m_requestingScript)
         resumeParsing();
 }
 
