diff --git a/dec/decode.c b/dec/decode.c
index 920959c..6738977 100644
--- a/dec/decode.c
+++ b/dec/decode.c
@@ -1770,6 +1770,9 @@ postReadDistance:
   }
 postSelfintersecting:
   while (--i >= 0) {
+    if (pos < 0 || pos >= s->ringbuffer_size) {
+      return BROTLI_RESULT_ERROR;
+    }
     s->ringbuffer[pos] =
         s->ringbuffer[(pos - s->distance_code) & s->ringbuffer_mask];
     ++pos;