--- trunk/Source/core/dom/custom/CustomElementRegistrationContext.cpp	2014/04/09 08:09:05	171126
+++ trunk/Source/core/dom/custom/CustomElementRegistrationContext.cpp	2014/04/09 08:11:11	171127
@@ -127,6 +127,10 @@
     if (!element->isHTMLElement() && !element->isSVGElement())
         return;
 
+    CustomElementRegistrationContext* context = element->document().registrationContext();
+    if (!context)
+        return;
+
     if (element->isCustomElement()) {
         // This can happen if:
         // 1. The element has a custom tag, which takes precedence over
@@ -139,10 +143,11 @@
     // Custom tags take precedence over type extensions
     ASSERT(!CustomElement::isValidName(element->localName()));
 
-    element->setCustomElementState(Element::WaitingForUpgrade);
+    if (!CustomElement::isValidName(type))
+        return;
 
-    if (CustomElementRegistrationContext* context = element->document().registrationContext())
-        context->didGiveTypeExtension(element, type);
+    element->setCustomElementState(Element::WaitingForUpgrade);
+    context->didGiveTypeExtension(element, type);
 }
 
 } // namespace WebCore
