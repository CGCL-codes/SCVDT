--- trunk/Source/core/dom/StyleElement.cpp	2014/04/02 20:52:13	170701
+++ trunk/Source/core/dom/StyleElement.cpp	2014/04/02 21:00:10	170702
@@ -60,6 +60,7 @@
 {
     TRACE_EVENT0("webkit", "StyleElement::processStyleSheet");
     ASSERT(element);
+    ASSERT(element->inDocument());
 
     m_registeredAsCandidate = true;
     document.styleEngine()->addStyleSheetCandidateNode(element, m_createdByParser);
@@ -78,20 +79,17 @@
 {
     ASSERT(element);
 
-    if (!m_registeredAsCandidate) {
-        ASSERT(!m_sheet);
-        return;
+    if (m_registeredAsCandidate) {
+        document.styleEngine()->removeStyleSheetCandidateNode(element, scopingNode, treeScope);
+        m_registeredAsCandidate = false;
     }
 
-    document.styleEngine()->removeStyleSheetCandidateNode(element, scopingNode, treeScope);
-    m_registeredAsCandidate = false;
-
     RefPtrWillBeRawPtr<StyleSheet> removedSheet = m_sheet.get();
 
     if (m_sheet)
         clearSheet(element);
-
-    document.removedStyleSheet(removedSheet.get(), RecalcStyleDeferred, AnalyzedStyleUpdate);
+    if (removedSheet)
+        document.removedStyleSheet(removedSheet.get(), RecalcStyleDeferred, AnalyzedStyleUpdate);
 }
 
 void StyleElement::clearDocumentData(Document& document, Element* element)
