Index: /trunk/Source/WebCore/rendering/svg/RenderSVGResourceFilter.cpp

===================================================================

--- /trunk/Source/WebCore/rendering/svg/RenderSVGResourceFilter.cpp	(revision 85405)

+++ /trunk/Source/WebCore/rendering/svg/RenderSVGResourceFilter.cpp	(revision 85406)

@@ -85,6 +85,10 @@

     ASSERT(client);

 

-    if (m_filter.contains(client))

-        delete m_filter.take(client);

+    if (FilterData* filterData = m_filter.get(client)) {

+        if (filterData->savedContext)

+            filterData->markedForRemoval = true;

+        else

+            delete m_filter.take(client);

+    }

 

     markClientForInvalidation(client, markForInvalidation ? BoundariesInvalidation : ParentOnlyInvalidation);

@@ -267,8 +271,13 @@

 #endif

 

-    if (!m_filter.contains(object))

+    FilterData* filterData = m_filter.get(object);

+    if (!filterData)

         return;

 

-    FilterData* filterData = m_filter.get(object);

+    if (filterData->markedForRemoval) {

+        delete m_filter.take(object);

+        return;

+    }

+

     if (!filterData->builded) {

         if (!filterData->savedContext) {

