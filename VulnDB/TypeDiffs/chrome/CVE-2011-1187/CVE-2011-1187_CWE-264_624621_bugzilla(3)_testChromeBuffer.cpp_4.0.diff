diff --git a/js/src/jsapi-tests/testChromeBuffer.cpp b/js/src/jsapi-tests/testChromeBuffer.cpp
--- a/js/src/jsapi-tests/testChromeBuffer.cpp
+++ b/js/src/jsapi-tests/testChromeBuffer.cpp
@@ -1,14 +1,23 @@
 #include "tests.h"
 
+static void
+Destroy(JSContext *cx, JSPrincipals *prin);
+
 JSPrincipals system_principals = {
-    (char *)"", NULL, NULL, 1, NULL, NULL
+    (char *)"", NULL, NULL, 1, Destroy, NULL
 };
 
+static void
+Destroy(JSContext *cx, JSPrincipals *prin)
+{
+    JS_ASSERT(prin == &system_principals);
+}
+
 JSClass global_class = {
     "global",
     JSCLASS_IS_GLOBAL | JSCLASS_GLOBAL_FLAGS,
     JS_PropertyStub,
     JS_PropertyStub,
     JS_PropertyStub,
     JS_StrictPropertyStub,
     JS_EnumerateStub,
