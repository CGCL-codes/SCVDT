diff --git a/js/src/jsobj.cpp b/js/src/jsobj.cpp
--- a/js/src/jsobj.cpp
+++ b/js/src/jsobj.cpp
@@ -1264,22 +1264,24 @@ EvalKernel(JSContext *cx, const CallArgs
 
     JSPrincipals *principals = PrincipalsForCompiledCode(args, cx);
 
     if (evalType == DIRECT_EVAL && caller->isNonEvalFunctionFrame())
         esg.lookupInEvalCache(caller, staticLevel, principals, scopeobj);
 
     if (!esg.foundScript()) {
         uintN lineno;
-        const char *filename = CurrentScriptFileAndLine(cx, &lineno,
-                                                        evalType == DIRECT_EVAL
-                                                        ? CALLED_FROM_JSOP_EVAL
-                                                        : NOT_CALLED_FROM_JSOP_EVAL);
+        const char *filename;
+        JSPrincipals *originPrincipals;
+        CurrentScriptFileLineOrigin(cx, &filename, &lineno, &originPrincipals,
+                                    evalType == DIRECT_EVAL ? CALLED_FROM_JSOP_EVAL
+                                                            : NOT_CALLED_FROM_JSOP_EVAL);
         uint32 tcflags = TCF_COMPILE_N_GO | TCF_NEED_MUTABLE_SCRIPT | TCF_COMPILE_FOR_EVAL;
-        JSScript *compiled = BytecodeCompiler::compileScript(cx, &scopeobj, caller, principals,
+        JSScript *compiled = BytecodeCompiler::compileScript(cx, &scopeobj, caller,
+                                                             principals, originPrincipals,
                                                              tcflags, chars, length, filename,
                                                              lineno, cx->findVersion(), linearStr,
                                                              staticLevel);
         if (!compiled)
             return false;
 
         esg.setNewScript(compiled);
     }
