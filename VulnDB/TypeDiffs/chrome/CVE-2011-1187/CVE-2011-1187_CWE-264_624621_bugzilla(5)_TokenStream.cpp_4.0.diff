diff --git a/js/src/frontend/TokenStream.cpp b/js/src/frontend/TokenStream.cpp
--- a/js/src/frontend/TokenStream.cpp
+++ b/js/src/frontend/TokenStream.cpp
@@ -149,19 +149,23 @@ js::IsIdentifier(JSLinearString *str)
 }
 
 #ifdef _MSC_VER
 #pragma warning(push)
 #pragma warning(disable:4351)
 #endif
 
 /* Initialize members that aren't initialized in |init|. */
-TokenStream::TokenStream(JSContext *cx)
-  : cx(cx), tokens(), cursor(), lookahead(), flags(), listenerTSData(), tokenbuf(cx)
-{}
+TokenStream::TokenStream(JSContext *cx, JSPrincipals *prin, JSPrincipals *originPrin)
+  : tokens(), cursor(), lookahead(), flags(), listenerTSData(), tokenbuf(cx),
+    cx(cx), originPrincipals(originPrin ? originPrin : prin)
+{
+    if (originPrincipals)
+        JSPRINCIPALS_HOLD(cx, originPrincipals);
+}
 
 #ifdef _MSC_VER
 #pragma warning(pop)
 #endif
 
 bool
 TokenStream::init(const jschar *base, size_t length, const char *fn, uintN ln, JSVersion v)
 {
@@ -239,16 +243,18 @@ TokenStream::init(const jschar *base, si
 }
 
 TokenStream::~TokenStream()
 {
     if (flags & TSF_OWNFILENAME)
         cx->free_((void *) filename);
     if (sourceMap)
         cx->free_(sourceMap);
+    if (originPrincipals)
+        JSPRINCIPALS_DROP(cx, originPrincipals);
 }
 
 /* Use the fastest available getc. */
 #if defined(HAVE_GETC_UNLOCKED)
 # define fast_getc getc_unlocked
 #elif defined(HAVE__GETC_NOLOCK)
 # define fast_getc _getc_nolock
 #else
@@ -451,16 +457,17 @@ TokenStream::reportCompileErrorNumberVA(
                                  errorNumber, &message, &report,
                                  !(flags & JSREPORT_UC), ap);
     if (!ok) {
         warning = false;
         goto out;
     }
 
     report.filename = filename;
+    report.originPrincipals = originPrincipals;
 
     tp = pn ? &pn->pn_pos : &currentToken().pos;
     report.lineno = tp->begin.lineno;
 
     /*
      * Given a token, T, that we want to complain about: if T's (starting)
      * lineno doesn't match TokenStream's lineno, that means we've scanned past
      * the line that T starts on, which makes it hard to print some or all of
