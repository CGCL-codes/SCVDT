diff -r 26383c993190 -r c5bcd3213da6 third_party/prio/prio/client.c
--- a/third_party/prio/prio/client.c	Tue Feb 12 10:39:23 2019 +0100
+++ b/third_party/prio/prio/client.c	Fri Feb 08 22:52:56 2019 +0000
@@ -287,9 +287,6 @@
   *for_server_a = NULL;
   *for_server_b = NULL;
 
-  P_CHECKA(pA = PrioPacketClient_new(cfg, PRIO_SERVER_A));
-  P_CHECKA(pB = PrioPacketClient_new(cfg, PRIO_SERVER_B));
-
   msgpack_sbuffer sbufA, sbufB;
   msgpack_packer packerA, packerB;
 
@@ -298,6 +295,9 @@
   msgpack_packer_init(&packerA, &sbufA, msgpack_sbuffer_write);
   msgpack_packer_init(&packerB, &sbufB, msgpack_sbuffer_write);
 
+  P_CHECKA(pA = PrioPacketClient_new(cfg, PRIO_SERVER_A));
+  P_CHECKA(pB = PrioPacketClient_new(cfg, PRIO_SERVER_B));
+
   P_CHECKC(PrioPacketClient_set_data(cfg, data_in, pA, pB));
   P_CHECKC(serial_write_packet_client(&packerA, pA, cfg));
   P_CHECKC(serial_write_packet_client(&packerB, pB, cfg));
@@ -343,7 +343,9 @@
 {
   SECStatus rv = SECSuccess;
   msgpack_unpacker upk;
-  P_CHECKCB(msgpack_unpacker_init(&upk, data_len));
+  if (!msgpack_unpacker_init(&upk, data_len)) {
+    return SECFailure;
+  }
 
   // Decrypt the ciphertext into dec_buf
   unsigned int bytes_decrypted;
