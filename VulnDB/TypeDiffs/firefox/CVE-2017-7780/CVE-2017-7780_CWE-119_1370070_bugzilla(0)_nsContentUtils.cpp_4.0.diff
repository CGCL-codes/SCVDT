diff -r 9bd1aecf586b -r b18762d91f3f dom/base/nsContentUtils.cpp
--- a/dom/base/nsContentUtils.cpp	Sun Jun 11 09:20:20 2017 -0400
+++ b/dom/base/nsContentUtils.cpp	Fri Jun 09 15:56:35 2017 -0700
@@ -4493,9 +4493,15 @@
 /* static */
 nsresult
 nsContentUtils::ConvertStringFromEncoding(const nsACString& aEncoding,
-                                          const nsACString& aInput,
+                                          const char* aInput,
+                                          uint32_t aInputLen,
                                           nsAString& aOutput)
 {
+  CheckedInt32 len = aInputLen;
+  if (!len.isValid()) {
+    return NS_ERROR_OUT_OF_MEMORY;
+  }
+
   nsAutoCString encoding;
   if (aEncoding.IsEmpty()) {
     encoding.AssignLiteral("UTF-8");
@@ -4507,7 +4513,7 @@
   nsAutoPtr<TextDecoder> decoder(new TextDecoder());
   decoder->InitWithEncoding(encoding, false);
 
-  decoder->Decode(aInput.BeginReading(), aInput.Length(), false,
+  decoder->Decode(aInput, len.value(), false,
                   aOutput, rv);
   return rv.StealNSResult();
 }
