diff -r 75b746a5d92c -r 39b39fc61d53 js/src/jit/CodeGenerator.cpp
--- a/js/src/jit/CodeGenerator.cpp	Mon Feb 12 17:41:34 2018 +0100
+++ b/js/src/jit/CodeGenerator.cpp	Mon Feb 12 10:34:21 2018 +0000
@@ -9838,6 +9838,11 @@
 bool
 CodeGenerator::link(JSContext* cx, CompilerConstraintList* constraints)
 {
+    // We cancel off-thread Ion compilations in a few places during GC, but if
+    // this compilation was performed off-thread it will already have been
+    // removed from the relevant lists by this point. Don't allow GC here.
+    JS::AutoAssertNoGC nogc(cx);
+
     RootedScript script(cx, gen->info().script());
     OptimizationLevel optimizationLevel = gen->optimizationInfo().level();
 
@@ -9918,7 +9923,7 @@
     // read barriers which were skipped while compiling the script off thread.
     Linker linker(masm);
     AutoFlushICache afc("IonLink");
-    JitCode* code = linker.newCode<CanGC>(cx, ION_CODE, !patchableBackedges_.empty());
+    JitCode* code = linker.newCode<NoGC>(cx, ION_CODE, !patchableBackedges_.empty());
     if (!code)
         return false;
 
