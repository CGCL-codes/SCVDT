diff -r 492cf5f6c198 -r 6965bf2d3c5a netwerk/streamconv/converters/nsIndexedToHTML.cpp
--- a/netwerk/streamconv/converters/nsIndexedToHTML.cpp	Mon Sep 17 12:03:44 2018 +0000
+++ b/netwerk/streamconv/converters/nsIndexedToHTML.cpp	Tue Sep 11 14:33:34 2018 +0300
@@ -163,7 +163,15 @@
     nsAutoCString baseUri, titleUri;
     rv = uri->GetAsciiSpec(baseUri);
     if (NS_FAILED(rv)) return rv;
-    titleUri = baseUri;
+
+    nsCOMPtr<nsIURI> titleURL;
+    rv = NS_MutateURI(uri)
+           .SetQuery(EmptyCString())
+           .SetRef(EmptyCString())
+           .Finalize(titleURL);
+    if (NS_FAILED(rv)) {
+        titleURL = uri;
+    }
 
     nsCString parentStr;
 
@@ -187,15 +195,13 @@
         // that - see above
 
         nsAutoCString pw;
-        rv = uri->GetPassword(pw);
+        rv = titleURL->GetPassword(pw);
         if (NS_FAILED(rv)) return rv;
         if (!pw.IsEmpty()) {
              nsCOMPtr<nsIURI> newUri;
-             rv = NS_MutateURI(uri)
+             rv = NS_MutateURI(titleURL)
                     .SetPassword(EmptyCString())
-                    .Finalize(newUri);
-             if (NS_FAILED(rv)) return rv;
-             rv = newUri->GetAsciiSpec(titleUri);
+                    .Finalize(titleURL);
              if (NS_FAILED(rv)) return rv;
         }
 
@@ -266,6 +272,11 @@
         }
     }
 
+    rv = titleURL->GetAsciiSpec(titleUri);
+    if (NS_FAILED(rv)) {
+        return rv;
+    }
+
     buffer.AppendLiteral("<style type=\"text/css\">\n"
                          ":root {\n"
                          "  font-family: sans-serif;\n"
