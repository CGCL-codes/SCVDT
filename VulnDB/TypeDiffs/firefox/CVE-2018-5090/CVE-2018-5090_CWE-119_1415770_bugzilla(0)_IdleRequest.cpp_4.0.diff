diff -r b6d37f26c25b -r aeba27461376 dom/base/IdleRequest.cpp
--- a/dom/base/IdleRequest.cpp	Tue Nov 28 14:56:55 2017 -0500
+++ b/dom/base/IdleRequest.cpp	Thu Nov 30 08:44:11 2017 -0500
@@ -31,13 +31,21 @@
 {
 }
 
-NS_IMPL_CYCLE_COLLECTION(IdleRequest, mCallback)
+NS_IMPL_CYCLE_COLLECTION_CLASS(IdleRequest)
 
-NS_IMPL_CYCLE_COLLECTING_ADDREF(IdleRequest)
-NS_IMPL_CYCLE_COLLECTING_RELEASE(IdleRequest)
+NS_IMPL_CYCLE_COLLECTION_UNLINK_BEGIN(IdleRequest)
+  NS_IMPL_CYCLE_COLLECTION_UNLINK(mCallback)
+  if (tmp->isInList()) {
+    tmp->remove();
+  }
+NS_IMPL_CYCLE_COLLECTION_UNLINK_END
 
-NS_INTERFACE_MAP_BEGIN_CYCLE_COLLECTION(IdleRequest)
-NS_INTERFACE_MAP_END
+NS_IMPL_CYCLE_COLLECTION_TRAVERSE_BEGIN(IdleRequest)
+  NS_IMPL_CYCLE_COLLECTION_TRAVERSE(mCallback)
+NS_IMPL_CYCLE_COLLECTION_TRAVERSE_END
+
+NS_IMPL_CYCLE_COLLECTION_ROOT_NATIVE(IdleRequest, AddRef)
+NS_IMPL_CYCLE_COLLECTION_UNROOT_NATIVE(IdleRequest, Release)
 
 void
 IdleRequest::SetTimeoutHandle(int32_t aHandle)
