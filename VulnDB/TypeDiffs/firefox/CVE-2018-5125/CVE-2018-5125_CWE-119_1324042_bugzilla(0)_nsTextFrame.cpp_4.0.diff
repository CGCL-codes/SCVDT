diff -r b76b1af27cc1 -r bec50ba1fb12 layout/generic/nsTextFrame.cpp
--- a/layout/generic/nsTextFrame.cpp	Wed Feb 07 14:44:09 2018 +0900
+++ b/layout/generic/nsTextFrame.cpp	Sat Feb 10 08:46:49 2018 -0800
@@ -10116,9 +10116,13 @@
       startOffset = aStartOffset;
       endOffset = std::min<uint32_t>(INT32_MAX, aEndOffset);
     }
+
+    // If startOffset and/or endOffset are inside of trimmedOffsets' range,
+    // then clamp the edges of trimmedOffsets accordingly.
+    int32_t origTrimmedOffsetsEnd = trimmedOffsets.GetEnd();
     trimmedOffsets.mStart = std::max<uint32_t>(trimmedOffsets.mStart,
         startOffset);
-    trimmedOffsets.mLength = std::min<uint32_t>(trimmedOffsets.GetEnd(),
+    trimmedOffsets.mLength = std::min<uint32_t>(origTrimmedOffsetsEnd,
         endOffset) - trimmedOffsets.mStart;
     if (trimmedOffsets.mLength <= 0) {
       offsetInRenderedString = nextOffsetInRenderedString;
