diff -r 90cac1d73acc -r 879a566e2a14 dom/base/nsDocument.cpp
--- a/dom/base/nsDocument.cpp	Thu Sep 07 12:51:45 2017 +0200
+++ b/dom/base/nsDocument.cpp	Thu Sep 07 09:11:38 2017 +0200
@@ -2795,13 +2795,14 @@
   rv = csp->GetCSPSandboxFlags(&cspSandboxFlags);
   NS_ENSURE_SUCCESS(rv, rv);
 
-  mSandboxFlags |= cspSandboxFlags;
-
   // Probably the iframe sandbox attribute already caused the creation of a
   // new NullPrincipal. Only create a new NullPrincipal if CSP requires so
   // and no one has been created yet.
   bool needNewNullPrincipal =
     (cspSandboxFlags & SANDBOXED_ORIGIN) && !(mSandboxFlags & SANDBOXED_ORIGIN);
+
+  mSandboxFlags |= cspSandboxFlags;
+  
   if (needNewNullPrincipal) {
     principal = NullPrincipal::CreateWithInheritedAttributes(principal);
     principal->SetCsp(csp);
