diff -r 81169a90162b -r 583d168dbe90 js/src/vm/TypeInference.cpp
--- a/js/src/vm/TypeInference.cpp	Thu Jun 29 08:36:28 2017 -0400
+++ b/js/src/vm/TypeInference.cpp	Mon Jul 10 12:21:04 2017 +0200
@@ -1489,7 +1489,6 @@
         // after any future changes to the stack type sets.
         if (entry.script->hasFreezeConstraints())
             continue;
-        entry.script->setHasFreezeConstraints();
 
         size_t count = TypeScript::NumTypeSets(entry.script);
 
@@ -1498,6 +1497,9 @@
             if (!array[i].addConstraint(cx, cx->typeLifoAlloc().new_<TypeConstraintFreezeStack>(entry.script), false))
                 succeeded = false;
         }
+
+        if (succeeded)
+            entry.script->setHasFreezeConstraints();
     }
 
     if (!succeeded || types.compilerOutputs->back().pendingInvalidation()) {
