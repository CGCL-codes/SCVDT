diff -r f96e8d3c0225 -r 39e131181d44 toolkit/components/extensions/webrequest/ChannelWrapper.cpp
--- a/toolkit/components/extensions/webrequest/ChannelWrapper.cpp	Mon Feb 26 12:03:55 2018 -0800
+++ b/toolkit/components/extensions/webrequest/ChannelWrapper.cpp	Sat Mar 03 16:28:18 2018 -0800
@@ -375,14 +375,9 @@
 }
 
 bool
-ChannelWrapper::GetCanModify(ErrorResult& aRv) const
+ChannelWrapper::CanModify() const
 {
-  nsCOMPtr<nsIURI> uri = FinalURI();
-  nsAutoCString spec;
-  if (uri) {
-    uri->GetSpec(spec);
-  }
-  if (!uri || AddonManagerWebAPI::IsValidSite(uri)) {
+  if (WebExtensionPolicy::IsRestrictedURI(FinalURLInfo())) {
     return false;
   }
 
@@ -392,10 +387,9 @@
         return false;
       }
 
-      if (prin->GetIsCodebasePrincipal() &&
-          (NS_FAILED(prin->GetURI(getter_AddRefs(uri))) ||
-           AddonManagerWebAPI::IsValidSite(uri))) {
-          return false;
+      auto* docURI = DocumentURLInfo();
+      if (docURI && WebExtensionPolicy::IsRestrictedURI(*docURI)) {
+        return false;
       }
     }
   }
@@ -647,7 +641,7 @@
 {
   // We can't attach new listeners after the response has started, so don't
   // bother registering anything.
-  if (mResponseStarted) {
+  if (mResponseStarted || !CanModify()) {
     return;
   }
 
