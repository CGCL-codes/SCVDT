diff -r 5c38100787fc -r 9ba48fdeecd5 docshell/base/nsDocShellTreeOwner.cpp
--- a/docshell/base/nsDocShellTreeOwner.cpp	Wed Feb 28 10:36:44 2018 +0900
+++ b/docshell/base/nsDocShellTreeOwner.cpp	Wed Feb 28 10:36:44 2018 +0900
@@ -939,23 +939,30 @@
 
   nsCOMPtr<nsIDroppedLinkHandler> handler =
     do_GetService("@mozilla.org/content/dropped-link-handler;1");
-  if (handler) {
-    nsAutoString eventType;
-    aEvent->GetType(eventType);
-    if (eventType.EqualsLiteral("dragover")) {
-      bool canDropLink = false;
-      handler->CanDropLink(dragEvent, false, &canDropLink);
-      if (canDropLink) {
-        aEvent->PreventDefault();
-      }
-    } else if (eventType.EqualsLiteral("drop")) {
-      nsIWebNavigation* webnav = static_cast<nsIWebNavigation*>(mWebBrowser);
+  if (!handler) {
+    return NS_OK;
+  }
 
-      uint32_t linksCount;
-      nsIDroppedLinkItem** links;
-      if (webnav &&
-          NS_SUCCEEDED(handler->DropLinks(dragEvent, true, &linksCount, &links))) {
-        if (linksCount >= 1) {
+  nsAutoString eventType;
+  aEvent->GetType(eventType);
+  if (eventType.EqualsLiteral("dragover")) {
+    bool canDropLink = false;
+    handler->CanDropLink(dragEvent, false, &canDropLink);
+    if (canDropLink) {
+      aEvent->PreventDefault();
+    }
+  } else if (eventType.EqualsLiteral("drop")) {
+    nsIWebNavigation* webnav = static_cast<nsIWebNavigation*>(mWebBrowser);
+
+    uint32_t linksCount;
+    nsIDroppedLinkItem** links;
+    if (webnav &&
+        NS_SUCCEEDED(handler->DropLinks(dragEvent, true, &linksCount, &links))) {
+      if (linksCount >= 1) {
+        nsCOMPtr<nsIPrincipal> triggeringPrincipal;
+        handler->GetTriggeringPrincipal(dragEvent,
+                                        getter_AddRefs(triggeringPrincipal));
+        if (triggeringPrincipal) {
           nsCOMPtr<nsIWebBrowserChrome> webBrowserChrome = GetWebBrowserChrome();
           if (webBrowserChrome) {
             nsCOMPtr<nsITabChild> tabChild = do_QueryInterface(webBrowserChrome);
@@ -972,7 +979,7 @@
           if (NS_SUCCEEDED(links[0]->GetUrl(url))) {
             if (!url.IsEmpty()) {
               webnav->LoadURI(url.get(), 0, nullptr, nullptr, nullptr,
-                              nsContentUtils::GetSystemPrincipal());
+                              triggeringPrincipal);
             }
           }
 
@@ -981,10 +988,10 @@
           }
           free(links);
         }
-      } else {
-        aEvent->StopPropagation();
-        aEvent->PreventDefault();
       }
+    } else {
+      aEvent->StopPropagation();
+      aEvent->PreventDefault();
     }
   }
 
