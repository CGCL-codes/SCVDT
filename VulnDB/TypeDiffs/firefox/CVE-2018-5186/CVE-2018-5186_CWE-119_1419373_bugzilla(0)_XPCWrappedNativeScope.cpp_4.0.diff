diff -r dcfb7f0bb6a9 -r d1c67d1afe26 js/xpconnect/src/XPCWrappedNativeScope.cpp
--- a/js/xpconnect/src/XPCWrappedNativeScope.cpp	Fri Apr 20 16:41:07 2018 +0900
+++ b/js/xpconnect/src/XPCWrappedNativeScope.cpp	Mon Apr 23 10:51:33 2018 +0100
@@ -549,6 +549,9 @@
             }
             i.Remove();
         }
+
+        CompartmentPrivate* priv = CompartmentPrivate::Get(cur->Compartment());
+        priv->SystemIsBeingShutDown();
     }
 
     // Now it is safe to kill all the scopes.
