diff -r d96335858456 -r 640c972a31a3 dom/base/nsContentUtils.cpp
--- a/dom/base/nsContentUtils.cpp	Tue Oct 23 10:53:34 2018 +0300
+++ b/dom/base/nsContentUtils.cpp	Thu Oct 18 16:20:03 2018 -0400
@@ -7868,11 +7868,16 @@
 {
   CheckedInt32 requiredBytes =
     CheckedInt32(aStride) * CheckedInt32(aImageSize.height);
-  if (!requiredBytes.isValid()) {
+
+  CheckedInt32 usedBytes = requiredBytes - aStride +
+    (CheckedInt32(aImageSize.width) * BytesPerPixel(aFormat));
+  if (!usedBytes.isValid()) {
     return NS_ERROR_FAILURE;
   }
+
+  MOZ_ASSERT(requiredBytes.isValid(), "usedBytes valid but not required?");
   *aMaxBufferSize = requiredBytes.value();
-  *aUsedBufferSize = *aMaxBufferSize - aStride + (aImageSize.width * BytesPerPixel(aFormat));
+  *aUsedBufferSize = usedBytes.value();
   return NS_OK;
 }
 
