diff -r 31fb2dec46ba -r 8fdd1dda7efc security/sandbox/chromium/sandbox/win/src/target_process.cc
--- a/security/sandbox/chromium/sandbox/win/src/target_process.cc	Mon Jan 08 10:47:06 2018 -0500
+++ b/security/sandbox/chromium/sandbox/win/src/target_process.cc	Mon Jan 08 10:07:16 2018 +0100
@@ -89,6 +89,7 @@
     bool inherit_handles,
     const base::win::StartupInformation& startup_info,
     base::win::ScopedProcessInformation* target_info,
+    base::EnvironmentMap& env_changes,
     DWORD* win_error) {
   exe_name_.reset(_wcsdup(exe_path));
 
@@ -108,12 +109,19 @@
     flags |= CREATE_BREAKAWAY_FROM_JOB;
   }
 
+  LPTCH original_environment = GetEnvironmentStrings();
+  base::NativeEnvironmentString new_environment =
+    base::AlterEnvironment(original_environment, env_changes);
+  // Ignore return value? What can we do?
+  FreeEnvironmentStrings(original_environment);
+  LPVOID new_env_ptr = (void*)new_environment.data();
+
   PROCESS_INFORMATION temp_process_info = {};
   if (!::CreateProcessAsUserW(lockdown_token_.Get(), exe_path, cmd_line.get(),
                               NULL,  // No security attribute.
                               NULL,  // No thread attribute.
                               inherit_handles, flags,
-                              NULL,  // Use the environment of the caller.
+                              new_env_ptr,
                               NULL,  // Use current directory of the caller.
                               startup_info.startup_info(),
                               &temp_process_info)) {
