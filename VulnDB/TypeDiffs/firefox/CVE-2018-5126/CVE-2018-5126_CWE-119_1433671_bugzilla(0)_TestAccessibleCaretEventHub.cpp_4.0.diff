diff -r 1ec0f839a905 -r 69a882fbd02a layout/base/gtest/TestAccessibleCaretEventHub.cpp
--- a/layout/base/gtest/TestAccessibleCaretEventHub.cpp	Wed Mar 14 18:18:32 2018 -0400
+++ b/layout/base/gtest/TestAccessibleCaretEventHub.cpp	Mon Jan 29 20:35:17 2018 +0100
@@ -195,6 +195,9 @@
     return Move(event);
   }
 
+  MOZ_CAN_RUN_SCRIPT_BOUNDARY void TestAsyncPanZoomScroll();
+
+  MOZ_CAN_RUN_SCRIPT_BOUNDARY
   void HandleEventAndCheckState(UniquePtr<WidgetEvent> aEvent,
                                 MockAccessibleCaretEventHub::State* aExpectedState,
                                 nsEventStatus aExpectedEventStatus)
@@ -209,40 +212,48 @@
     EXPECT_EQ(mHub->GetState(), aExpectedState);
   }
 
-  template <typename PressEventCreator, typename ReleaseEventCreator>
-  void TestPressReleaseOnNoCaret(PressEventCreator aPressEventCreator,
-                                 ReleaseEventCreator aReleaseEventCreator);
-
-  template <typename PressEventCreator, typename ReleaseEventCreator>
-  void TestPressReleaseOnCaret(PressEventCreator aPressEventCreator,
-                               ReleaseEventCreator aReleaseEventCreator);
+  template<typename PressEventCreator, typename ReleaseEventCreator>
+  MOZ_CAN_RUN_SCRIPT_BOUNDARY void TestPressReleaseOnNoCaret(
+    PressEventCreator aPressEventCreator,
+    ReleaseEventCreator aReleaseEventCreator);
 
-  template <typename PressEventCreator, typename MoveEventCreator,
-            typename ReleaseEventCreator>
-  void TestPressMoveReleaseOnNoCaret(PressEventCreator aPressEventCreator,
-                                     MoveEventCreator aMoveEventCreator,
-                                     ReleaseEventCreator aReleaseEventCreator);
-
-  template <typename PressEventCreator, typename MoveEventCreator,
-            typename ReleaseEventCreator>
-  void TestPressMoveReleaseOnCaret(PressEventCreator aPressEventCreator,
-                                   MoveEventCreator aMoveEventCreator,
-                                   ReleaseEventCreator aReleaseEventCreator);
-
-  template <typename PressEventCreator, typename ReleaseEventCreator>
-  void TestLongTapWithSelectWordSuccessful(
+  template<typename PressEventCreator, typename ReleaseEventCreator>
+  MOZ_CAN_RUN_SCRIPT_BOUNDARY void TestPressReleaseOnCaret(
     PressEventCreator aPressEventCreator,
     ReleaseEventCreator aReleaseEventCreator);
 
-  template <typename PressEventCreator, typename ReleaseEventCreator>
-  void TestLongTapWithSelectWordFailed(
+  template<typename PressEventCreator,
+           typename MoveEventCreator,
+           typename ReleaseEventCreator>
+  MOZ_CAN_RUN_SCRIPT_BOUNDARY void TestPressMoveReleaseOnNoCaret(
+    PressEventCreator aPressEventCreator,
+    MoveEventCreator aMoveEventCreator,
+    ReleaseEventCreator aReleaseEventCreator);
+
+  template<typename PressEventCreator,
+           typename MoveEventCreator,
+           typename ReleaseEventCreator>
+  MOZ_CAN_RUN_SCRIPT_BOUNDARY void TestPressMoveReleaseOnCaret(
+    PressEventCreator aPressEventCreator,
+    MoveEventCreator aMoveEventCreator,
+    ReleaseEventCreator aReleaseEventCreator);
+
+  template<typename PressEventCreator, typename ReleaseEventCreator>
+  MOZ_CAN_RUN_SCRIPT_BOUNDARY void TestLongTapWithSelectWordSuccessful(
     PressEventCreator aPressEventCreator,
     ReleaseEventCreator aReleaseEventCreator);
 
-  template <typename PressEventCreator, typename MoveEventCreator,
-            typename ReleaseEventCreator>
-  void TestEventDrivenAsyncPanZoomScroll(
-    PressEventCreator aPressEventCreator, MoveEventCreator aMoveEventCreator,
+  template<typename PressEventCreator, typename ReleaseEventCreator>
+  MOZ_CAN_RUN_SCRIPT_BOUNDARY void TestLongTapWithSelectWordFailed(
+    PressEventCreator aPressEventCreator,
+    ReleaseEventCreator aReleaseEventCreator);
+
+  template<typename PressEventCreator,
+           typename MoveEventCreator,
+           typename ReleaseEventCreator>
+  MOZ_CAN_RUN_SCRIPT_BOUNDARY void TestEventDrivenAsyncPanZoomScroll(
+    PressEventCreator aPressEventCreator,
+    MoveEventCreator aMoveEventCreator,
     ReleaseEventCreator aReleaseEventCreator);
 
   // Member variables
@@ -251,11 +262,13 @@
 }; // class AccessibleCaretEventHubTester
 
 TEST_F(AccessibleCaretEventHubTester, TestMousePressReleaseOnNoCaret)
+MOZ_CAN_RUN_SCRIPT
 {
   TestPressReleaseOnNoCaret(CreateMousePressEvent, CreateMouseReleaseEvent);
 }
 
 TEST_F(AccessibleCaretEventHubTester, TestTouchPressReleaseOnNoCaret)
+MOZ_CAN_RUN_SCRIPT
 {
   TestPressReleaseOnNoCaret(CreateTouchStartEvent, CreateTouchEndEvent);
 }
@@ -283,11 +296,13 @@
 }
 
 TEST_F(AccessibleCaretEventHubTester, TestMousePressReleaseOnCaret)
+MOZ_CAN_RUN_SCRIPT
 {
   TestPressReleaseOnCaret(CreateMousePressEvent, CreateMouseReleaseEvent);
 }
 
 TEST_F(AccessibleCaretEventHubTester, TestTouchPressReleaseOnCaret)
+MOZ_CAN_RUN_SCRIPT
 {
   TestPressReleaseOnCaret(CreateTouchStartEvent, CreateTouchEndEvent);
 }
@@ -325,12 +340,14 @@
 }
 
 TEST_F(AccessibleCaretEventHubTester, TestMousePressMoveReleaseOnNoCaret)
+MOZ_CAN_RUN_SCRIPT
 {
   TestPressMoveReleaseOnNoCaret(CreateMousePressEvent, CreateMouseMoveEvent,
                                 CreateMouseReleaseEvent);
 }
 
 TEST_F(AccessibleCaretEventHubTester, TestTouchPressMoveReleaseOnNoCaret)
+MOZ_CAN_RUN_SCRIPT
 {
   TestPressMoveReleaseOnNoCaret(CreateTouchStartEvent, CreateTouchMoveEvent,
                                 CreateTouchEndEvent);
@@ -379,12 +396,14 @@
 }
 
 TEST_F(AccessibleCaretEventHubTester, TestMousePressMoveReleaseOnCaret)
+MOZ_CAN_RUN_SCRIPT
 {
   TestPressMoveReleaseOnCaret(CreateMousePressEvent, CreateMouseMoveEvent,
                               CreateMouseReleaseEvent);
 }
 
 TEST_F(AccessibleCaretEventHubTester, TestTouchPressMoveReleaseOnCaret)
+MOZ_CAN_RUN_SCRIPT
 {
   TestPressMoveReleaseOnCaret(CreateTouchStartEvent, CreateTouchMoveEvent,
                               CreateTouchEndEvent);
@@ -446,6 +465,7 @@
 
 TEST_F(AccessibleCaretEventHubTester,
        TestTouchStartMoveEndOnCaretWithTouchCancelIgnored)
+MOZ_CAN_RUN_SCRIPT
 {
   nscoord x0 = 0, y0 = 0;
   nscoord x1 = 100, y1 = 100;
@@ -504,12 +524,14 @@
                            nsEventStatus_eIgnore);}
 
 TEST_F(AccessibleCaretEventHubTester, TestMouseLongTapWithSelectWordSuccessful)
+MOZ_CAN_RUN_SCRIPT
 {
   TestLongTapWithSelectWordSuccessful(CreateMousePressEvent,
                                       CreateMouseReleaseEvent);
 }
 
 TEST_F(AccessibleCaretEventHubTester, TestTouchLongTapWithSelectWordSuccessful)
+MOZ_CAN_RUN_SCRIPT
 {
   TestLongTapWithSelectWordSuccessful(CreateTouchStartEvent,
                                       CreateTouchEndEvent);
@@ -584,12 +606,14 @@
 }
 
 TEST_F(AccessibleCaretEventHubTester, TestMouseLongTapWithSelectWordFailed)
+MOZ_CAN_RUN_SCRIPT
 {
   TestLongTapWithSelectWordFailed(CreateMousePressEvent,
                                   CreateMouseReleaseEvent);
 }
 
 TEST_F(AccessibleCaretEventHubTester, TestTouchLongTapWithSelectWordFailed)
+MOZ_CAN_RUN_SCRIPT
 {
   TestLongTapWithSelectWordFailed(CreateTouchStartEvent,
                                   CreateTouchEndEvent);
@@ -625,12 +649,14 @@
 }
 
 TEST_F(AccessibleCaretEventHubTester, TestTouchEventDrivenAsyncPanZoomScroll)
+MOZ_CAN_RUN_SCRIPT
 {
   TestEventDrivenAsyncPanZoomScroll(CreateTouchStartEvent, CreateTouchMoveEvent,
                                     CreateTouchEndEvent);
 }
 
 TEST_F(AccessibleCaretEventHubTester, TestMouseEventDrivenAsyncPanZoomScroll)
+MOZ_CAN_RUN_SCRIPT
 {
   TestEventDrivenAsyncPanZoomScroll(CreateMousePressEvent, CreateMouseMoveEvent,
                                     CreateMouseReleaseEvent);
@@ -724,7 +750,13 @@
                            nsEventStatus_eIgnore);
 }
 
-TEST_F(AccessibleCaretEventHubTester, TestAsyncPanZoomScroll)
+TEST_F(AccessibleCaretEventHubTester, TestAsyncPanZoomScroll) MOZ_CAN_RUN_SCRIPT
+{
+  TestAsyncPanZoomScroll();
+}
+
+void
+AccessibleCaretEventHubTester::TestAsyncPanZoomScroll()
 {
   MockFunction<void(::std::string aCheckPointName)> check;
   {
@@ -769,6 +801,7 @@
 }
 
 TEST_F(AccessibleCaretEventHubTester, TestAsyncPanZoomScrollStartedThenBlur)
+MOZ_CAN_RUN_SCRIPT
 {
   {
     InSequence dummy;
@@ -789,6 +822,7 @@
 }
 
 TEST_F(AccessibleCaretEventHubTester, TestAsyncPanZoomScrollEndedThenBlur)
+MOZ_CAN_RUN_SCRIPT
 {
   {
     InSequence dummy;
