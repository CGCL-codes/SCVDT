diff -r aae715e5060b -r a9897f5c997e dom/base/WebSocket.cpp
--- a/dom/base/WebSocket.cpp	Mon Jun 26 20:20:40 2017 -0400
+++ b/dom/base/WebSocket.cpp	Wed Jul 12 17:12:40 2017 -0400
@@ -615,6 +615,10 @@
 
   AssertIsOnTargetThread();
 
+  // DontKeepAliveAnyMore() and DisconnectInternal() can release the object. So
+  // hold a reference to this until the end of the method.
+  RefPtr<WebSocketImpl> kungfuDeathGrip = this;
+
   // Disconnect can be called from some control event (such as Notify() of
   // WorkerHolder). This will be schedulated before any other sync/async
   // runnable. In order to prevent some double Disconnect() calls, we use this
@@ -636,10 +640,6 @@
     rv.SuppressException();
   }
 
-  // DontKeepAliveAnyMore() can release the object. So hold a reference to this
-  // until the end of the method.
-  RefPtr<WebSocketImpl> kungfuDeathGrip = this;
-
   NS_ReleaseOnMainThread(mChannel.forget());
   NS_ReleaseOnMainThread(mService.forget());
 
