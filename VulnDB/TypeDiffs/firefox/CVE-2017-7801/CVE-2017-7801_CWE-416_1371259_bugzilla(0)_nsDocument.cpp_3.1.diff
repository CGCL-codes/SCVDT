diff -r d44b343011f7 -r e3d205dc31f3 dom/base/nsDocument.cpp
--- a/dom/base/nsDocument.cpp	Tue Jul 11 05:55:27 2017 -0700
+++ b/dom/base/nsDocument.cpp	Mon Jul 10 18:06:18 2017 -0400
@@ -6015,7 +6015,8 @@
 
   JS::Rooted<JSObject*> global(aCx,
     JS_GetGlobalForObject(aCx, &args.callee()));
-  nsCOMPtr<nsPIDOMWindowInner> window = do_QueryWrapper(aCx, global);
+  RefPtr<nsGlobalWindow> window;
+  UNWRAP_OBJECT(Window, global, window);
   MOZ_ASSERT(window, "Should have a non-null window");
 
   nsDocument* document = static_cast<nsDocument*>(window->GetDoc());
