diff -r d44b343011f7 -r e3d205dc31f3 js/xpconnect/src/Sandbox.cpp
--- a/js/xpconnect/src/Sandbox.cpp	Tue Jul 11 05:55:27 2017 -0700
+++ b/js/xpconnect/src/Sandbox.cpp	Mon Jul 10 18:06:18 2017 -0400
@@ -1297,8 +1297,7 @@
     MOZ_ASSERT(out);
     *out = nullptr;
 
-    nsXPConnect* xpc = nsXPConnect::XPConnect();
-    nsISupports* native = xpc->GetNativeOfWrapper(cx, from);
+    nsCOMPtr<nsISupports> native = xpc::UnwrapReflectorToISupports(from);
 
     if (nsCOMPtr<nsIScriptObjectPrincipal> sop = do_QueryInterface(native)) {
         sop.forget(out);
