diff -r d44b343011f7 -r e3d205dc31f3 js/xpconnect/src/XPCJSWeakReference.cpp
--- a/js/xpconnect/src/XPCJSWeakReference.cpp	Tue Jul 11 05:55:27 2017 -0700
+++ b/js/xpconnect/src/XPCJSWeakReference.cpp	Mon Jul 10 18:06:18 2017 -0400
@@ -27,8 +27,7 @@
     XPCCallContext ccx(cx);
 
     // See if the object is a wrapped native that supports weak references.
-    nsISupports* supports =
-        nsXPConnect::XPConnect()->GetNativeOfWrapper(cx, obj);
+    nsCOMPtr<nsISupports> supports = xpc::UnwrapReflectorToISupports(obj);
     nsCOMPtr<nsISupportsWeakReference> supportsWeakRef =
         do_QueryInterface(supports);
     if (supportsWeakRef) {
