diff -r d44b343011f7 -r e3d205dc31f3 js/xpconnect/src/XPCWrappedNativeJSOps.cpp
--- a/js/xpconnect/src/XPCWrappedNativeJSOps.cpp	Tue Jul 11 05:55:27 2017 -0700
+++ b/js/xpconnect/src/XPCWrappedNativeJSOps.cpp	Mon Jul 10 18:06:18 2017 -0400
@@ -691,7 +691,8 @@
 
 // macro fun!
 #define PRE_HELPER_STUB                                                       \
-    JSObject* unwrapped = js::CheckedUnwrap(obj, false);                      \
+    /* It's very important for "unwrapped" to be rooted here.  */             \
+    RootedObject unwrapped(cx, js::CheckedUnwrap(obj, false));                \
     if (!unwrapped) {                                                         \
         JS_ReportErrorASCII(cx, "Permission denied to operate on object.");   \
         return false;                                                         \
