diff -r 041e2b51e5bf -r f5ad8dcc3ee8 js/src/vm/TypeInference.cpp
--- a/js/src/vm/TypeInference.cpp	Tue Nov 13 16:43:22 2018 +0000
+++ b/js/src/vm/TypeInference.cpp	Wed Nov 07 21:12:45 2018 +0100
@@ -4025,6 +4025,10 @@
     MOZ_ASSERT(!group->newScript(sweep));
     MOZ_ASSERT(!group->maybeUnboxedLayout(sweep));
 
+    // rollbackPartiallyInitializedObjects expects function_ to be
+    // canonicalized.
+    MOZ_ASSERT(fun->maybeCanonicalFunction() == fun);
+
     if (group->unknownProperties(sweep)) {
         return true;
     }
@@ -4404,7 +4408,13 @@
             }
         }
 
-        if (!iter.isConstructing() || !iter.matchCallee(cx, function)) {
+        if (!iter.isConstructing()) {
+            continue;
+        }
+
+        MOZ_ASSERT(iter.calleeTemplate()->maybeCanonicalFunction());
+
+        if (iter.calleeTemplate()->maybeCanonicalFunction() != function) {
             continue;
         }
 
