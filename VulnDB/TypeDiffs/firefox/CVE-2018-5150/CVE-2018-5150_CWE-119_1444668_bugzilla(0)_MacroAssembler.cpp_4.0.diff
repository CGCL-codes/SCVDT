diff -r 8364f4c4f877 -r 29b2342e2a32 js/src/jit/MacroAssembler.cpp
--- a/js/src/jit/MacroAssembler.cpp	Tue Apr 10 15:36:26 2018 +0100
+++ b/js/src/jit/MacroAssembler.cpp	Tue Apr 10 15:00:49 2018 +0200
@@ -2677,6 +2677,12 @@
     }
 
     MacroAssemblerSpecific::finish();
+
+    MOZ_RELEASE_ASSERT(size() <= MaxCodeBytesPerProcess,
+                       "AssemblerBuffer should ensure we don't exceed MaxCodeBytesPerProcess");
+
+    if (bytesNeeded() > MaxCodeBytesPerProcess)
+        setOOM();
 }
 
 void
