diff --git a/qga/commands.c b/qga/commands.c
index 0c7d1385c2..425a4c405f 100644
--- a/qga/commands.c
+++ b/qga/commands.c
@@ -231,17 +231,21 @@ static char **guest_exec_get_args(const strList *entry, 
bool log)
      int count = 1, i = 0;  /* reserve for NULL terminator */
      char **args;
      char *str; /* for logging array of arguments */
-    size_t str_size = 1;
+    size_t str_size = 1, arg_max;
+ arg_max = ga_get_arg_max();
      for (it = entry; it != NULL; it = it->next) {
          count++;
          str_size += 1 + strlen(it->value);
+        if (str_size >= arg_max || count >= arg_max / 2) {
+            break;
+        }
      }
str = g_malloc(str_size);
      *str = 0;
      args = g_malloc(count * sizeof(char *));
-    for (it = entry; it != NULL; it = it->next) {
+    for (it = entry; it != NULL && i < count; it = it->next) {
          args[i++] = it->value;
          pstrcat(str, str_size, it->value);
          if (it->next) {
