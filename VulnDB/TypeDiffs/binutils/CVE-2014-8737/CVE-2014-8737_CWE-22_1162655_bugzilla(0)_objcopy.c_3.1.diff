diff -rcp binutils-2.23.52.0.1.orig/binutils/objcopy.c binutils-2.23.52.0.1/binutils/objcopy.c
*** binutils-2.23.52.0.1.orig/binutils/objcopy.c	2014-11-11 20:51:37.030244866 +0000
--- binutils-2.23.52.0.1/binutils/objcopy.c	2014-11-11 20:55:30.431307076 +0000
*************** copy_archive (bfd *ibfd, bfd *obfd, cons
*** 2182,2187 ****
--- 2182,2197 ----
        bfd_boolean del = TRUE;
        bfd_boolean ok_object;
  
+       /* PR binutils/17533: Do not allow directory traversal
+ 	 outside of the current directory tree by archive members.  */
+       if (! is_valid_archive_path (bfd_get_filename (this_element)))
+ 	{
+ 	  non_fatal (_("illegal pathname found in archive member: %s"),
+ 		     bfd_get_filename (this_element));
+ 	  status = 1;
+ 	  goto cleanup_and_exit;
+ 	}
+ 
        /* Create an output file for this member.  */
        output_name = concat (dir, "/",
  			    bfd_get_filename (this_element), (char *) 0);
*************** copy_archive (bfd *ibfd, bfd *obfd, cons
*** 2191,2198 ****
  	{
  	  output_name = make_tempdir (output_name);
  	  if (output_name == NULL)
! 	    fatal (_("cannot create tempdir for archive copying (error: %s)"),
! 		   strerror (errno));
  
  	  l = (struct name_list *) xmalloc (sizeof (struct name_list));
  	  l->name = output_name;
--- 2201,2212 ----
  	{
  	  output_name = make_tempdir (output_name);
  	  if (output_name == NULL)
! 	    {
! 	      non_fatal (_("cannot create tempdir for archive copying (error: %s)"),
! 			 strerror (errno));
! 	      status = 1;
! 	      goto cleanup_and_exit;
! 	    }
  
  	  l = (struct name_list *) xmalloc (sizeof (struct name_list));
  	  l->name = output_name;
*************** copy_archive (bfd *ibfd, bfd *obfd, cons
*** 2234,2240 ****
  	{
  	  bfd_nonfatal_message (output_name, NULL, NULL, NULL);
  	  status = 1;
! 	  return;
  	}
  
        if (ok_object)
--- 2248,2254 ----
  	{
  	  bfd_nonfatal_message (output_name, NULL, NULL, NULL);
  	  status = 1;
! 	  goto cleanup_and_exit;
  	}
  
        if (ok_object)
*************** copy_archive (bfd *ibfd, bfd *obfd, cons
*** 2295,2301 ****
      {
        status = 1;
        bfd_nonfatal_message (filename, NULL, NULL, NULL);
-       return;
      }
  
    filename = bfd_get_filename (ibfd);
--- 2309,2314 ----
*************** copy_archive (bfd *ibfd, bfd *obfd, cons
*** 2303,2311 ****
      {
        status = 1;
        bfd_nonfatal_message (filename, NULL, NULL, NULL);
-       return;
      }
  
    /* Delete all the files that we opened.  */
    for (l = list; l != NULL; l = l->next)
      {
--- 2316,2324 ----
      {
        status = 1;
        bfd_nonfatal_message (filename, NULL, NULL, NULL);
      }
  
+  cleanup_and_exit:
    /* Delete all the files that we opened.  */
    for (l = list; l != NULL; l = l->next)
      {
